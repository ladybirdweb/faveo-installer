(function(g,j,b){var d=g.navigator.msPointerEnabled;function f(n){this.support=(typeof File!=="undefined"&&typeof Blob!=="undefined"&&typeof FileList!=="undefined"&&(!!Blob.prototype.slice||!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!1));if(!this.support){return}this.supportDirectory=/Chrome/.test(g.navigator.userAgent);this.files=[];this.defaults={chunkSize:1024*1024,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:0.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,allowDuplicateUploads:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,413,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1,initFileFn:null,readFileFn:m};this.opts={};this.events={};var o=this;this.onDrop=function(p){if(o.opts.onDropStopPropagation){p.stopPropagation()}p.preventDefault();var q=p.dataTransfer;if(q.items&&q.items[0]&&q.items[0].webkitGetAsEntry){o.webkitReadDataTransfer(p)}else{o.addFiles(q.files,p)}};this.preventEvent=function(p){p.preventDefault()};this.opts=f.extend({},this.defaults,n||{})}f.prototype={on:function(n,o){n=n.toLowerCase();if(!this.events.hasOwnProperty(n)){this.events[n]=[]}this.events[n].push(o)},off:function(o,n){if(o!==b){o=o.toLowerCase();if(n!==b){if(this.events.hasOwnProperty(o)){i(this.events[o],n)}}else{delete this.events[o]}}else{this.events={}}},fire:function(p,o){o=Array.prototype.slice.call(arguments);p=p.toLowerCase();var n=!1;if(this.events.hasOwnProperty(p)){l(this.events[p],function(q){n=q.apply(this,o.slice(1))===!1||n},this)}if(p!="catchall"){o.unshift("catchAll");n=this.fire.apply(this,o)===!1||n}return !n},webkitReadDataTransfer:function(s){var u=this;var n=s.dataTransfer.items.length;var r=[];l(s.dataTransfer.items,function(w){var v=w.webkitGetAsEntry();if(!v){t();return}if(v.isFile){p(w.getAsFile(),v.fullPath)}else{q(v.createReader())}});function q(v){v.readEntries(function(w){if(w.length){n+=w.length;l(w,function(y){if(y.isFile){var x=y.fullPath;y.file(function(z){p(z,x)},o)}else{if(y.isDirectory){q(y.createReader())}}});q(v)}else{t()}},o)}function p(w,v){w.relativePath=v.substring(1);r.push(w);t()}function o(v){throw v}function t(){if(--n==0){u.addFiles(r,s)}}},generateUniqueIdentifier:function(o){var p=this.opts.generateUniqueIdentifier;if(typeof p==="function"){return p(o)}var n=o.relativePath||o.webkitRelativePath||o.fileName||o.name;return o.size+"-"+n.replace(/[^0-9a-zA-Z_-]/img,"")},uploadNextChunk:function(o){var p=!1;if(this.opts.prioritizeFirstAndLastChunk){l(this.files,function(q){if(!q.paused&&q.chunks.length&&q.chunks[0].status()==="pending"){q.chunks[0].send();p=!0;return !1}if(!q.paused&&q.chunks.length>1&&q.chunks[q.chunks.length-1].status()==="pending"){q.chunks[q.chunks.length-1].send();p=!0;return !1}});if(p){return p}}l(this.files,function(q){if(!q.paused){l(q.chunks,function(r){if(r.status()==="pending"){r.send();p=!0;return !1}})}if(p){return !1}});if(p){return !0}var n=!1;l(this.files,function(q){if(!q.isComplete()){n=!0;return !1}});if(!n&&!o){e(function(){this.fire("complete")},this)}return !1},assignBrowse:function(n,q,p,o){if(n instanceof Element){n=[n]}l(n,function(s){var r;if(s.tagName==="INPUT"&&s.type==="file"){r=s}else{r=j.createElement("input");r.setAttribute("type","file");h(r.style,{visibility:"hidden",position:"absolute",width:"1px",height:"1px"});s.appendChild(r);s.addEventListener("click",function(){r.click()},!1)}if(!this.opts.singleFile&&!p){r.setAttribute("multiple","multiple")}if(q){r.setAttribute("webkitdirectory","webkitdirectory")}l(o,function(v,u){r.setAttribute(u,v)});var t=this;r.addEventListener("change",function(u){if(u.target.value){t.addFiles(u.target.files,u);u.target.value=""}},!1)},this)},assignDrop:function(n){if(typeof n.length==="undefined"){n=[n]}l(n,function(o){o.addEventListener("dragover",this.preventEvent,!1);o.addEventListener("dragenter",this.preventEvent,!1);o.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(n){if(typeof n.length==="undefined"){n=[n]}l(n,function(o){o.removeEventListener("dragover",this.preventEvent);o.removeEventListener("dragenter",this.preventEvent);o.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var n=!1;l(this.files,function(o){if(o.isUploading()){n=!0;return !1}});return n},_shouldUploadNext:function(){var p=0;var n=!0;var o=this.opts.simultaneousUploads;l(this.files,function(q){l(q.chunks,function(r){if(r.status()==="uploading"){p++;if(p>=o){n=!1;return !1}}})});return n&&p},upload:function(){var p=this._shouldUploadNext();if(p===!1){return}this.fire("uploadStart");var n=!1;for(var o=1;o<=this.opts.simultaneousUploads-p;o++){n=this.uploadNextChunk(!0)||n}if(!n){e(function(){this.fire("complete")},this)}},resume:function(){l(this.files,function(n){n.resume()})},pause:function(){l(this.files,function(n){n.pause()})},cancel:function(){for(var n=this.files.length-1;n>=0;n--){this.files[n].cancel()}},progress:function(){var o=0;var n=0;l(this.files,function(p){o+=p.progress()*p.size;n+=p.size});return n>0?o/n:0},addFile:function(n,o){this.addFiles([n],o)},addFiles:function(n,p){var o=[];l(n,function(q){if((!d||d&&q.size>0)&&!(q.size%4096===0&&(q.name==="."||q.fileName==="."))&&(this.opts.allowDuplicateUploads||!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(q)))){var r=new a(this,q);if(this.fire("fileAdded",r,p)){o.push(r)}}},this);if(this.fire("filesAdded",o,p)){l(o,function(q){if(this.opts.singleFile&&this.files.length>0){this.removeFile(this.files[0])}this.files.push(q)},this);this.fire("filesSubmitted",o,p)}},removeFile:function(o){for(var n=this.files.length-1;n>=0;n--){if(this.files[n]===o){this.files.splice(n,1);o.abort();this.fire("fileRemoved",o)}}},getFromUniqueIdentifier:function(n){var o=!1;l(this.files,function(p){if(p.uniqueIdentifier===n){o=p}});return o},getSize:function(){var n=0;l(this.files,function(o){n+=o.size});return n},sizeUploaded:function(){var n=0;l(this.files,function(o){n+=o.sizeUploaded()});return n},timeRemaining:function(){var n=0;var o=0;l(this.files,function(p){if(!p.paused&&!p.error){n+=p.size-p.sizeUploaded();o+=p.averageSpeed}});if(n&&!o){return Number.POSITIVE_INFINITY}if(!n&&!o){return 0}return Math.floor(n/o)}};function a(n,o){this.flowObj=n;this.bytes=null;this.file=o;this.name=o.fileName||o.name;this.size=o.size;this.relativePath=o.relativePath||o.webkitRelativePath||this.name;this.uniqueIdentifier=n.generateUniqueIdentifier(o);this.chunks=[];this.paused=!1;this.error=!1;this.averageSpeed=0;this.currentSpeed=0;this._lastProgressCallback=Date.now();this._prevUploadedSize=0;this._prevProgress=0;this.bootstrap()}a.prototype={measureSpeed:function(){var p=Date.now()-this._lastProgressCallback;if(!p){return}var o=this.flowObj.opts.speedSmoothingFactor;var n=this.sizeUploaded();this.currentSpeed=Math.max((n-this._prevUploadedSize)/p*1000,0);this.averageSpeed=o*this.currentSpeed+(1-o)*this.averageSpeed;this._prevUploadedSize=n},chunkEvent:function(n,p,o){switch(p){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval){break}this.measureSpeed();this.flowObj.fire("fileProgress",this,n);this.flowObj.fire("progress");this._lastProgressCallback=Date.now();break;case"error":this.error=!0;this.abort(!0);this.flowObj.fire("fileError",this,o,n);this.flowObj.fire("error",o,this,n);break;case"success":if(this.error){return}this.measureSpeed();this.flowObj.fire("fileProgress",this,n);this.flowObj.fire("progress");this._lastProgressCallback=Date.now();if(this.isComplete()){this.currentSpeed=0;this.averageSpeed=0;this.flowObj.fire("fileSuccess",this,o,n)}break;case"retry":this.flowObj.fire("fileRetry",this,n);break}},pause:function(){this.paused=!0;this.abort()},resume:function(){this.paused=!1;this.flowObj.upload()},abort:function(n){this.currentSpeed=0;this.averageSpeed=0;var o=this.chunks;if(n){this.chunks=[]}l(o,function(p){if(p.status()==="uploading"){p.abort();this.flowObj.uploadNextChunk()}},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap();this.flowObj.upload()},bootstrap:function(){if(typeof this.flowObj.opts.initFileFn==="function"){this.flowObj.opts.initFileFn(this)}this.abort(!0);this.error=!1;this._prevProgress=0;var n=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor;var p=Math.max(n(this.size/this.flowObj.opts.chunkSize),1);for(var o=0;o<p;o++){this.chunks.push(new c(this.flowObj,this,o))}},progress:function(){if(this.error){return 1}if(this.chunks.length===1){this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress());return this._prevProgress}var o=0;l(this.chunks,function(p){o+=p.progress()*(p.endByte-p.startByte)});var n=o/this.size;this._prevProgress=Math.max(this._prevProgress,n>0.9999?1:n);return this._prevProgress},isUploading:function(){var n=!1;l(this.chunks,function(o){if(o.status()==="uploading"){n=!0;return !1}});return n},isComplete:function(){var n=!1;l(this.chunks,function(p){var o=p.status();if(o==="pending"||o==="uploading"||o==="reading"||p.preprocessState===1||p.readState===1){n=!0;return !1}});return !n},sizeUploaded:function(){var n=0;l(this.chunks,function(o){n+=o.sizeUploaded()});return n},timeRemaining:function(){if(this.paused||this.error){return 0}var n=this.size-this.sizeUploaded();if(n&&!this.averageSpeed){return Number.POSITIVE_INFINITY}if(!n&&!this.averageSpeed){return 0}return Math.floor(n/this.averageSpeed)},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}};function m(q,s,p,n,o){var r="slice";if(q.file.slice){r="slice"}else{if(q.file.mozSlice){r="mozSlice"}else{if(q.file.webkitSlice){r="webkitSlice"}}}o.readFinished(q.file[r](s,p,n))}function c(n,o,q){this.flowObj=n;this.fileObj=o;this.offset=q;this.tested=!1;this.retries=0;this.pendingRetry=!1;this.preprocessState=0;this.readState=0;this.loaded=0;this.total=0;this.chunkSize=this.flowObj.opts.chunkSize;this.startByte=this.offset*this.chunkSize;this.computeEndByte=function(){var r=Math.min(this.fileObj.size,(this.offset+1)*this.chunkSize);if(this.fileObj.size-r<this.chunkSize&&!this.flowObj.opts.forceChunkSize){r=this.fileObj.size}return r};this.endByte=this.computeEndByte();this.xhr=null;var p=this;this.event=function(s,r){r=Array.prototype.slice.call(arguments);r.unshift(p);p.fileObj.chunkEvent.apply(p.fileObj,r)};this.progressHandler=function(r){if(r.lengthComputable){p.loaded=r.loaded;p.total=r.total}p.event("progress",r)};this.testHandler=function(s){var r=p.status(!0);if(r==="error"){p.event(r,p.message());p.flowObj.uploadNextChunk()}else{if(r==="success"){p.tested=!0;p.event(r,p.message());p.flowObj.uploadNextChunk()}else{if(!p.fileObj.paused){p.tested=!0;p.send()}}}};this.doneHandler=function(s){var r=p.status();if(r==="success"||r==="error"){delete this.data;p.event(r,p.message());p.flowObj.uploadNextChunk()}else{p.event("retry",p.message());p.pendingRetry=!0;p.abort();p.retries++;var t=p.flowObj.opts.chunkRetryInterval;if(t!==null){setTimeout(function(){p.send()},t)}else{p.send()}}}}c.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObj.size,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(n,o){if(n.indexOf("?")<0){n+="?"}else{n+="&"}return n+o.join("&")},test:function(){this.xhr=new XMLHttpRequest();this.xhr.addEventListener("load",this.testHandler,!1);this.xhr.addEventListener("error",this.testHandler,!1);var o=k(this.flowObj.opts.testMethod,this.fileObj,this);var n=this.prepareXhrRequest(o,!0);this.xhr.send(n)},preprocessFinished:function(){this.endByte=this.computeEndByte();this.preprocessState=2;this.send()},readFinished:function(n){this.readState=2;this.bytes=n;this.send()},send:function(){var o=this.flowObj.opts.preprocess;var q=this.flowObj.opts.readFileFn;if(typeof o==="function"){switch(this.preprocessState){case 0:this.preprocessState=1;o(this);return;case 1:return}}switch(this.readState){case 0:this.readState=1;q(this.fileObj,this.startByte,this.endByte,this.fileObj.file.type,this);return;case 1:return}if(this.flowObj.opts.testChunks&&!this.tested){this.test();return}this.loaded=0;this.total=0;this.pendingRetry=!1;this.xhr=new XMLHttpRequest();this.xhr.upload.addEventListener("progress",this.progressHandler,!1);this.xhr.addEventListener("load",this.doneHandler,!1);this.xhr.addEventListener("error",this.doneHandler,!1);var n=k(this.flowObj.opts.uploadMethod,this.fileObj,this);var p=this.prepareXhrRequest(n,!1,this.flowObj.opts.method,this.bytes);this.xhr.send(p)},abort:function(){var n=this.xhr;this.xhr=null;if(n){n.abort()}},status:function(n){if(this.readState===1){return"reading"}else{if(this.pendingRetry||this.preprocessState===1){return"uploading"}else{if(!this.xhr){return"pending"}else{if(this.xhr.readyState<4){return"uploading"}else{if(this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1){return"success"}else{if(this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!n&&this.retries>=this.flowObj.opts.maxChunkRetries){return"error"}else{this.abort();return"pending"}}}}}}},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry){return 0}var n=this.status();if(n==="success"||n==="error"){return 1}else{if(n==="pending"){return 0}else{return this.total>0?this.loaded/this.total:0}}},sizeUploaded:function(){var n=this.endByte-this.startByte;if(this.status()!=="success"){n=this.progress()*n}return n},prepareXhrRequest:function(u,n,p,o){var r=k(this.flowObj.opts.query,this.fileObj,this,n);r=h(r,this.getParams());var s=k(this.flowObj.opts.target,this.fileObj,this,n);var q=null;if(u==="GET"||p==="octet"){var t=[];l(r,function(x,w){t.push([encodeURIComponent(w),encodeURIComponent(x)].join("="))});s=this.getTarget(s,t);q=o||null}else{q=new FormData();l(r,function(x,w){q.append(w,x)});q.append(this.flowObj.opts.fileParameterName,o,this.fileObj.file.name)}this.xhr.open(u,s,!0);this.xhr.withCredentials=this.flowObj.opts.withCredentials;l(k(this.flowObj.opts.headers,this.fileObj,this,n),function(x,w){this.xhr.setRequestHeader(w,x)},this);return q}};function i(p,o){var n=p.indexOf(o);if(n>-1){p.splice(n,1)}}function k(o,n){if(typeof o==="function"){n=Array.prototype.slice.call(arguments);o=o.apply(null,n.slice(1))}return o}f.evalOpts=k;function e(o,n){setTimeout(o.bind(n),0)}function h(o,n){l(arguments,function(p){if(p!==o){l(p,function(r,q){o[q]=r})}});return o}f.extend=h;function l(p,q,o){if(!p){return}var n;if(typeof(p.length)!=="undefined"){for(n=0;n<p.length;n++){if(q.call(o,p[n],n)===!1){return}}}else{for(n in p){if(p.hasOwnProperty(n)&&q.call(o,p[n],n)===!1){return}}}}f.each=l;f.FlowFile=a;f.FlowChunk=c;f.version="2.11.2";if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=f}else{g.Flow=f;if(typeof define==="function"&&define.amd){define("flow",[],function(){return f})}}})(window,document);angular.module("flow.provider",[]).provider("flowFactory",function(){this.defaults={};this.factory=function(a){return new Flow(a)};this.events=[];this.on=function(a,b){this.events.push([a,b])};this.$get=function(){var b=this.factory;var c=this.defaults;var a=this.events;return{create:function(e){var d=b(angular.extend({},c,e));angular.forEach(a,function(f){d.on(f[0],f[1])});return d}}}});angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(c,a,f,g){var d=angular.extend({},c.$eval(a.flowInit));var b=c.$eval(a.flowObject)||g.create(d);var e=function(h){var i=Array.prototype.slice.call(arguments);i.shift();var j=c.$broadcast.apply(c,["flow::"+h,b].concat(i));if({progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[h]){c.$apply()}if(j.defaultPrevented){return !1}};b.on("catchAll",e);c.$on("$destroy",function(){b.off("catchAll",e)});c.$flow=b;if(a.hasOwnProperty("flowName")){f(a.flowName).assign(c,b);c.$on("$destroy",function(){f(a.flowName).assign(c)})}}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]);angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(e,c,b){var d=b.hasOwnProperty("flowDirectory");var a=b.hasOwnProperty("flowSingleFile");var f=b.hasOwnProperty("flowAttrs")&&e.$eval(b.flowAttrs);e.$flow.assignBrowse(c,d,a,f)}}}]);angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(c,b,a){b.bind("drop dragover",function(d){d.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(a){return{scope:!1,link:function(d,c,b){var f;var e=!1;c.bind("dragover",function(h){if(!g(h)){return}if(!e){d.$apply(b.flowDragEnter);e=!0}a.cancel(f);h.preventDefault()});c.bind("dragleave drop",function(h){a.cancel(f);f=a(function(){d.$eval(b.flowDragLeave);f=null;e=!1},100)});function g(j){var h=!1;var i=j.dataTransfer||j.originalEvent.dataTransfer;angular.forEach(i&&i.types,function(k){if(k==="Files"){h=!0}});return h}}}}]);angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(c,b,a){if(a.flowDropEnabled){c.$watch(a.flowDropEnabled,function(f){if(f){e()}else{d()}})}else{e()}function e(){c.$flow.assignDrop(b)}function d(){c.$flow.unAssignDrop(b)}}}});!function(a){var c=a.module("flow.events",["flow.init"]);var b={fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]};a.forEach(b,function(f,e){var g="flow"+d(e);if(g=="flowUploadStart"){g="flowUploadStarted"}c.directive(g,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(i,h){i.$on("flow::"+e,function(){var l=Array.prototype.slice.call(arguments);var k=l.shift();if(i.$flow!==l.shift()){return}var j={};a.forEach(f,function(n,m){j[n]=l[m]});if(i.$eval(h[g],j)===!1){k.preventDefault()}})}]}}])});function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}}(angular);angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(d,c,a){var b=a.flowImg;d.$watch(b,function(f){if(!f){return}var e=new FileReader();e.readAsDataURL(f.file);e.onload=function(g){d.$apply(function(){a.$set("src",g.target.result)})}})}}}]);angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(a){a.transfers=a.$flow.files}}}]);angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]);