if(Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get){(function(){var b=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return b.get.call(this)},set:function(a){return b.set.call(this,a)}})})()}if(!Array.isArray){Array.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"}}var wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\uFEFF",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};(function(e,d){if(typeof define=="function"&&define.amd){define(e)}else{d.rangy=e()}})(function(){var ae="object",aj="function",N="undefined";var ad=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var ao=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var O=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var U=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function ag(a,b){var d=typeof a[b];return d==aj||(!!(d==ae&&a[b]))||d=="unknown"}function an(a,b){return !!(typeof a[b]==ae&&a[b])}function S(a,b){return typeof a[b]!=N}function ac(a){return function(e,b){var d=b.length;while(d--){if(!a(e,b[d])){return false}}return true}}var W=ac(ag);var Q=ac(an);var P=ac(S);function Y(a){return a&&W(a,U)&&P(a,O)}function M(a){return an(a,"body")?a.body:a.getElementsByTagName("body")[0]}var T={};var X={version:"1.3alpha.20140804",initialized:false,supported:true,util:{isHostMethod:ag,isHostObject:an,isHostProperty:S,areHostMethods:W,areHostObjects:Q,areHostProperties:P,isTextRange:Y,getBody:M},features:{},modules:T,config:{alertOnFail:true,alertOnWarn:false,preferTextRange:false,autoInitialize:(typeof rangyAutoInitialize==N)?true:rangyAutoInitialize}};function aa(a){if(an(window,"console")&&ag(window.console,"log")){window.console.log(a)}}function ak(a,b){if(b){window.alert(a)}else{aa(a)}}function al(a){X.initialized=true;X.supported=false;ak("Rangy is not supported on this page in your browser. Reason: "+a,X.config.alertOnFail)}X.fail=al;function ab(a){ak("Rangy warning: "+a,X.config.alertOnWarn)}X.warn=ab;if({}.hasOwnProperty){X.util.extend=function(f,a,d){var e,g;for(var b in a){if(a.hasOwnProperty(b)){e=f[b];g=a[b];if(d&&e!==null&&typeof e=="object"&&g!==null&&typeof g=="object"){X.util.extend(e,g,true)}f[b]=g}}if(a.hasOwnProperty("toString")){f.toString=a.toString}return f}}else{al("hasOwnProperty not supported")}(function(){var b=document.createElement("div");b.appendChild(document.createElement("span"));var e=[].slice;var d;try{if(e.call(b.childNodes,0)[0].nodeType==1){d=function(f){return e.call(f,0)}}}catch(a){}if(!d){d=function(g){var h=[];for(var f=0,i=g.length;f<i;++f){h[f]=g[f]}return h}}X.util.toArray=d})();var af;if(ag(document,"addEventListener")){af=function(a,d,b){a.addEventListener(d,b,false)}}else{if(ag(document,"attachEvent")){af=function(a,d,b){a.attachEvent("on"+d,b)}}else{al("Document does not have required addEventListener or attachEvent method")}}X.util.addListener=af;var V=[];function ai(a){return a.message||a.description||String(a)}function K(){if(X.initialized){return}var i;var a=false,h=false;if(ag(document,"createRange")){i=document.createRange();if(W(i,ao)&&P(i,ad)){a=true}}var f=M(document);if(!f||f.nodeName.toLowerCase()!="body"){al("No body element found");return}if(f&&ag(f,"createTextRange")){i=f.createTextRange();if(Y(i)){h=true}}if(!a&&!h){al("Neither Range nor TextRange are available");return}X.initialized=true;X.features={implementsDomRange:a,implementsTextRange:h};var j,d;for(var k in T){if((j=T[k]) instanceof R){j.init(j,X)}}for(var g=0,e=V.length;g<e;++g){try{V[g](X)}catch(b){d="Rangy init listener threw an exception. Continuing. Detail: "+ai(b);aa(d)}}}X.init=K;X.addInitListener=function(a){if(X.initialized){a(X)}else{V.push(a)}};var am=[];X.addShimListener=function(a){am.push(a)};function aq(a){a=a||window;K();for(var b=0,d=am.length;b<d;++b){am[b](a)}}X.shim=X.createMissingNativeApi=aq;function R(d,a,b){this.name=d;this.dependencies=a;this.initialized=false;this.supported=false;this.initializer=b}R.prototype={init:function(){var f=this.dependencies||[];for(var a=0,d=f.length,e,b;a<d;++a){b=f[a];e=T[b];if(!e||!(e instanceof R)){throw new Error("required module '"+b+"' not found")}e.init();if(!e.supported){throw new Error("required module '"+b+"' not supported")}}this.initializer(this)},fail:function(a){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){X.warn("Module "+this.name+": "+a)},deprecationNotice:function(b,a){X.warn("DEPRECATED: "+b+" in module "+this.name+"is deprecated. Please use "+a+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}};function J(d,b,f,e){var a=new R(b,f,function(g){if(!g.initialized){g.initialized=true;try{e(X,g);g.supported=true}catch(h){var i="Module '"+b+"' failed to load: "+ai(h);aa(i)}}});T[b]=a}X.createModule=function(d){var e,a;if(arguments.length==2){e=arguments[1];a=[]}else{e=arguments[2];a=arguments[1]}var b=J(false,d,a,e);if(X.initialized){b.init()}};X.createCoreModule=function(d,b,a){J(true,d,b,a)};function Z(){}X.RangePrototype=Z;X.rangePrototype=new Z();function L(){}X.selectionPrototype=new L();var ap=false;var ah=function(a){if(!ap){ap=true;if(!X.initialized&&X.config.autoInitialize){K()}}};if(typeof window==N){al("No window found");return}if(typeof document==N){al("No document found");return}if(ag(document,"addEventListener")){document.addEventListener("DOMContentLoaded",ah,false)}af(window,"load",ah);X.createCoreModule("DomUtil",[],function(u,y){var ar="undefined";var q=u.util;if(!q.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){y.fail("document missing a Node creation method")}if(!q.isHostMethod(document,"getElementsByTagName")){y.fail("document missing getElementsByTagName method")}var t=document.createElement("div");if(!q.areHostMethods(t,["insertBefore","appendChild","cloneNode"]||!q.areHostObjects(t,["previousSibling","nextSibling","childNodes","parentNode"]))){y.fail("Incomplete Element implementation")}if(!q.isHostProperty(t,"innerHTML")){y.fail("Element is missing innerHTML property")}var p=document.createTextNode("test");if(!q.areHostMethods(p,["splitText","deleteData","insertData","appendData","cloneNode"]||!q.areHostObjects(t,["previousSibling","nextSibling","childNodes","parentNode"])||!q.areHostProperties(p,["data"]))){y.fail("Incomplete Text Node implementation")}var i=function(az,ax){var ay=az.length;while(ay--){if(az[ay]===ax){return true}}return false};function m(aw){var ax;return typeof aw.namespaceURI==ar||((ax=aw.namespaceURI)===null||ax=="http://www.w3.org/1999/xhtml")}function I(aw){var ax=aw.parentNode;return(ax.nodeType==1)?ax:null}function e(aw){var ax=0;while((aw=aw.previousSibling)){++ax}return ax}function G(av){switch(av.nodeType){case 7:case 10:return 0;case 3:case 8:return av.length;default:return av.childNodes.length}}function h(aA,aB){var az=[],ay;for(ay=aA;ay;ay=ay.parentNode){az.push(ay)}for(ay=aB;ay;ay=ay.parentNode){if(i(az,ay)){return ay}}return null}function j(aB,aA,ay){var az=ay?aA:aA.parentNode;while(az){if(az===aB){return true}else{az=az.parentNode}}return false}function x(ax,aw){return j(ax,aw,true)}function B(aC,aD,az){var aB,aA=az?aC:aC.parentNode;while(aA){aB=aA.parentNode;if(aB===aD){return aA}aA=aB}return null}function w(aw){var ax=aw.nodeType;return ax==3||ax==4||ax==8}function A(aw){if(!aw){return false}var ax=aw.nodeType;return ax==3||ax==8}function o(ay,aA){var aB=aA.nextSibling,az=aA.parentNode;if(aB){az.insertBefore(ay,aB)}else{az.appendChild(ay)}return ay}function H(aA,aD,aE){var aB=aA.cloneNode(false);aB.deleteData(0,aD);aA.deleteData(aD,aA.length-aD);o(aB,aA);if(aE){for(var aC=0,aF;aF=aE[aC++];){if(aF.node==aA&&aF.offset>aD){aF.node=aB;aF.offset-=aD}else{if(aF.node==aA.parentNode&&aF.offset>e(aA)){++aF.offset}}}}return aB}function n(av){if(av.nodeType==9){return av}else{if(typeof av.ownerDocument!=ar){return av.ownerDocument}else{if(typeof av.document!=ar){return av.document}else{if(av.parentNode){return n(av.parentNode)}else{throw y.createError("getDocument: no document found for node")}}}}}function f(ax){var aw=n(ax);if(typeof aw.defaultView!=ar){return aw.defaultView}else{if(typeof aw.parentWindow!=ar){return aw.parentWindow}else{throw y.createError("Cannot get a window object for node")}}}function l(av){if(typeof av.contentDocument!=ar){return av.contentDocument}else{if(typeof av.contentWindow!=ar){return av.contentWindow.document}else{throw y.createError("getIframeDocument: No Document object found for iframe element")}}}function r(av){if(typeof av.contentWindow!=ar){return av.contentWindow}else{if(typeof av.contentDocument!=ar){return av.contentDocument.defaultView}else{throw y.createError("getIframeWindow: No Window object found for iframe element")}}}function D(av){return av&&q.isHostMethod(av,"setTimeout")&&q.isHostObject(av,"document")}function E(ay,aA,aB){var az;if(!ay){az=document}else{if(q.isHostProperty(ay,"nodeType")){az=(ay.nodeType==1&&ay.tagName.toLowerCase()=="iframe")?l(ay):n(ay)}else{if(D(ay)){az=ay.document}}}if(!az){throw aA.createError(aB+"(): Parameter must be a Window object or DOM node")}return az}function k(aw){var ax;while((ax=aw.parentNode)){aw=ax}return aw}function z(aD,aK,aE,aL){var aG,aJ,aH,aI,aF;if(aD==aE){return aK===aL?0:(aK<aL)?-1:1}else{if((aG=B(aE,aD,true))){return aK<=e(aG)?-1:1}else{if((aG=B(aD,aE,true))){return e(aG)<aL?-1:1}else{aJ=h(aD,aE);if(!aJ){throw new Error("comparePoints error: nodes have no common ancestor")}aH=(aD===aJ)?aJ:B(aD,aJ,true);aI=(aE===aJ)?aJ:B(aE,aJ,true);if(aH===aI){throw y.createError("comparePoints got to case 4 and childA and childB are the same!")}else{aF=aJ.firstChild;while(aF){if(aF===aH){return -1}else{if(aF===aI){return 1}}aF=aF.nextSibling}}}}}}var a=false;function b(az){var ax;try{ax=az.parentNode;return false}catch(ay){return true}}(function(){var ax=document.createElement("b");ax.innerHTML="1";var aw=ax.firstChild;ax.innerHTML="<br>";a=b(aw);u.features.crashyTextNodes=a})();function at(ax){if(!ax){return"[No node]"}if(a&&b(ax)){return"[Broken node]"}if(w(ax)){return'"'+ax.data+'"'}if(ax.nodeType==1){var aw=ax.id?' id="'+ax.id+'"':"";return"<"+ax.nodeName+aw+">[index:"+e(ax)+",length:"+ax.childNodes.length+"]["+(ax.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return ax.nodeName}function C(ay){var az=n(ay).createDocumentFragment(),ax;while((ax=ay.firstChild)){az.appendChild(ax)}return az}var g;if(typeof window.getComputedStyle!=ar){g=function(ax,aw){return f(ax).getComputedStyle(ax,null)[aw]}}else{if(typeof document.documentElement.currentStyle!=ar){g=function(ax,aw){return ax.currentStyle[aw]}}else{y.fail("No means of obtaining computed style properties found")}}function s(av){this.root=av;this._next=av}s.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var ax=this._current=this._next;var ay,az;if(this._current){ay=ax.firstChild;if(ay){this._next=ay}else{az=null;while((ax!==this.root)&&!(az=ax.nextSibling)){ax=ax.parentNode}this._next=az}}return this._current},detach:function(){this._current=this._next=this.root=null}};function v(av){return new s(av)}function d(ax,aw){this.node=ax;this.offset=aw}d.prototype={equals:function(av){return !!av&&this.node===av.node&&this.offset==av.offset},inspect:function(){return"[DomPosition("+at(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function F(av){this.code=this[av];this.codeName=av;this.message="DOMException: "+this.codeName}F.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};F.prototype.toString=function(){return this.message};u.dom={arrayContains:i,isHtmlNamespace:m,parentElement:I,getNodeIndex:e,getNodeLength:G,getCommonAncestor:h,isAncestorOf:j,isOrIsAncestorOf:x,getClosestAncestorIn:B,isCharacterDataNode:w,isTextOrCommentNode:A,insertAfter:o,splitDataNode:H,getDocument:n,getWindow:f,getIframeWindow:r,getIframeDocument:l,getBody:q.getBody,isWindow:D,getContentDocument:E,getRootContainer:k,comparePoints:z,isBrokenNode:b,inspectNode:at,getComputedStyleProperty:g,fragmentFromNodeChildren:C,createIterator:v,DomPosition:d};u.DOMException=F});X.createCoreModule("DomRange",["DomUtil"],function(q,y){var C=q.dom;var a=q.util;var B=C.DomPosition;var bm=q.DOMException;var u=C.isCharacterDataNode;var H=C.getNodeIndex;var bc=C.isOrIsAncestorOf;var bu=C.getDocument;var bf=C.comparePoints;var bo=C.splitDataNode;var bg=C.getClosestAncestorIn;var bn=C.getNodeLength;var bt=C.arrayContains;var aw=C.getRootContainer;var n=q.features.crashyTextNodes;function au(aA,aB){return(aA.nodeType!=3)&&(bc(aA,aB.startContainer)||bc(aA,aB.endContainer))}function j(aA){return aA.document||bu(aA.startContainer)}function I(aA){return new B(aA.parentNode,H(aA))}function bj(aA){return new B(aA.parentNode,H(aA)+1)}function p(aC,aA,aB){var aD=aC.nodeType==11?aC.firstChild:aC;if(u(aA)){if(aB==aA.length){C.insertAfter(aC,aA)}else{aA.parentNode.insertBefore(aC,aB==0?aA:bo(aA,aB))}}else{if(aB>=aA.childNodes.length){aA.appendChild(aC)}else{aA.insertBefore(aC,aA.childNodes[aB])}}return aD}function bv(aB,aC,aE){r(aB);r(aC);if(j(aC)!=j(aB)){throw new bm("WRONG_DOCUMENT_ERR")}var aA=bf(aB.startContainer,aB.startOffset,aC.endContainer,aC.endOffset),aD=bf(aB.endContainer,aB.endOffset,aC.startContainer,aC.startOffset);return aE?aA<=0&&aD>=0:aA<0&&aD>0}function v(aC){var aD;for(var aB,aA=j(aC.range).createDocumentFragment(),aE;aB=aC.next();){aD=aC.isPartiallySelectedSubtree();aB=aB.cloneNode(!aD);if(aD){aE=aC.getSubtreeIterator();aB.appendChild(v(aE));aE.detach()}if(aB.nodeType==10){throw new bm("HIERARCHY_REQUEST_ERR")}aA.appendChild(aB)}return aA}function bk(aF,aC,aG){var aE,aA;aG=aG||{stop:false};for(var aD,aB;aD=aF.next();){if(aF.isPartiallySelectedSubtree()){if(aC(aD)===false){aG.stop=true;return}else{aB=aF.getSubtreeIterator();bk(aB,aC,aG);aB.detach();if(aG.stop){return}}}else{aE=C.createIterator(aD);while((aA=aE.next())){if(aC(aA)===false){aG.stop=true;return}}}}}function h(aA){var aB;while(aA.next()){if(aA.isPartiallySelectedSubtree()){aB=aA.getSubtreeIterator();h(aB);aB.detach()}else{aA.remove()}}}function br(aC){for(var aB,aA=j(aC.range).createDocumentFragment(),aD;aB=aC.next();){if(aC.isPartiallySelectedSubtree()){aB=aB.cloneNode(false);aD=aC.getSubtreeIterator();aB.appendChild(br(aD));aD.detach()}else{aC.remove()}if(aB.nodeType==10){throw new bm("HIERARCHY_REQUEST_ERR")}aA.appendChild(aB)}return aA}function d(aE,aG,aD){var aB=!!(aG&&aG.length),aC;var aA=!!aD;if(aB){aC=new RegExp("^("+aG.join("|")+")$")}var aF=[];bk(new w(aE,false),function(aI){if(aB&&!aC.test(aI.nodeType)){return}if(aA&&!aD(aI)){return}var aH=aE.startContainer;if(aI==aH&&u(aH)&&aE.startOffset==aH.length){return}var aJ=aE.endContainer;if(aI==aJ&&u(aJ)&&aE.endOffset==0){return}aF.push(aI)});return aF}function ar(aB){var aA=(typeof aB.getName=="undefined")?"Range":aB.getName();return"["+aA+"("+C.inspectNode(aB.startContainer)+":"+aB.startOffset+", "+C.inspectNode(aB.endContainer)+":"+aB.endOffset+")]"}function w(aA,aB){this.range=aA;this.clonePartiallySelectedTextNodes=aB;if(!aA.collapsed){this.sc=aA.startContainer;this.so=aA.startOffset;this.ec=aA.endContainer;this.eo=aA.endOffset;var aC=aA.commonAncestorContainer;if(this.sc===this.ec&&u(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===aC&&!u(this.sc))?this.sc.childNodes[this.so]:bg(this.sc,aC,true);this._last=(this.ec===aC&&!u(this.ec))?this.ec.childNodes[this.eo-1]:bg(this.ec,aC,true)}}}w.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var aA=this._current=this._next;if(aA){this._next=(aA!==this._last)?aA.nextSibling:null;if(u(aA)&&this.clonePartiallySelectedTextNodes){if(aA===this.ec){(aA=aA.cloneNode(true)).deleteData(this.eo,aA.length-this.eo)}if(this._current===this.sc){(aA=aA.cloneNode(true)).deleteData(0,this.so)}}}return aA},remove:function(){var aB=this._current,aA,aC;if(u(aB)&&(aB===this.sc||aB===this.ec)){aA=(aB===this.sc)?this.so:0;aC=(aB===this.ec)?this.eo:aB.length;if(aA!=aC){aB.deleteData(aA,aC-aA)}}else{if(aB.parentNode){aB.parentNode.removeChild(aB)}else{}}},isPartiallySelectedSubtree:function(){var aA=this._current;return au(aA,this.range)},getSubtreeIterator:function(){var aE;if(this.isSingleCharacterDataNode){aE=this.range.cloneRange();aE.collapse(false)}else{aE=new a4(j(this.range));var aA=this._current;var aC=aA,aF=0,aB=aA,aD=bn(aA);if(bc(aA,this.sc)){aC=this.sc;aF=this.so}if(bc(aA,this.ec)){aB=this.ec;aD=this.eo}D(aE,aC,aF,aB,aD)}return new w(aE,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var a9=[1,3,4,5,7,8,10];var bb=[2,9,11];var G=[5,6,10,12];var g=[1,3,4,5,7,8,10,11];var A=[1,3,4,5,7,8];function bh(aA){return function(aD,aB){var aE,aC=aB?aD:aD.parentNode;while(aC){aE=aC.nodeType;if(bt(aA,aE)){return aC}aC=aC.parentNode}return null}}var s=bh([9,11]);var l=bh(G);var E=bh([6,10,12]);function ay(aA,aB){if(E(aA,aB)){throw new bm("INVALID_NODE_TYPE_ERR")}}function bl(aB,aA){if(!bt(aA,aB.nodeType)){throw new bm("INVALID_NODE_TYPE_ERR")}}function ba(aB,aA){if(aA<0||aA>(u(aB)?aB.length:aB.childNodes.length)){throw new bm("INDEX_SIZE_ERR")}}function z(aA,aB){if(s(aA,true)!==s(aB,true)){throw new bm("WRONG_DOCUMENT_ERR")}}function bd(aA){if(l(aA,true)){throw new bm("NO_MODIFICATION_ALLOWED_ERR")}}function a6(aA,aB){if(!aA){throw new bm(aB)}}function f(aA){return(n&&C.isBrokenNode(aA))||!bt(bb,aA.nodeType)&&!s(aA,true)}function a3(aB,aA){return aA<=(u(aB)?aB.length:aB.childNodes.length)}function b(aA){return(!!aA.startContainer&&!!aA.endContainer&&!f(aA.startContainer)&&!f(aA.endContainer)&&a3(aA.startContainer,aA.startOffset)&&a3(aA.endContainer,aA.endOffset))}function r(aA){if(!b(aA)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+aA.inspect()+")")}}var F=document.createElement("style");var bs=false;try{F.innerHTML="<b>x</b>";bs=(F.firstChild.nodeType==3)}catch(a7){}q.features.htmlParsingConforms=bs;var bq=bs?function(aB){var aC=this.startContainer;var aA=bu(aC);if(!aC){throw new bm("INVALID_STATE_ERR")}var aD=null;if(aC.nodeType==1){aD=aC}else{if(u(aC)){aD=C.parentElement(aC)}}if(aD===null||(aD.nodeName=="HTML"&&C.isHtmlNamespace(bu(aD).documentElement)&&C.isHtmlNamespace(aD))){aD=aA.createElement("body")}else{aD=aD.cloneNode(false)}aD.innerHTML=aB;return C.fragmentFromNodeChildren(aD)}:function(aB){var aA=j(this);var aC=aA.createElement("body");aC.innerHTML=aB;return C.fragmentFromNodeChildren(aC)};function a5(aE,aG){r(aE);var aA=aE.startContainer,aB=aE.startOffset,aD=aE.endContainer,aF=aE.endOffset;var aC=(aA===aD);if(u(aD)&&aF>0&&aF<aD.length){bo(aD,aF,aG)}if(u(aA)&&aB>0&&aB<aA.length){aA=bo(aA,aB,aG);if(aC){aF-=aB;aD=aA}else{if(aD==aA.parentNode&&aF>=H(aA)){aF++}}aB=0}aE.setStartAndEnd(aA,aB,aD,aF)}function t(aA){r(aA);var aB=aA.commonAncestorContainer.parentNode.cloneNode(false);aB.appendChild(aA.cloneContents());return aB.innerHTML}var i=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var k=0,at=1,a8=2,be=3;var ax=0,av=1,o=2,m=3;a.extend(q.rangePrototype,{compareBoundaryPoints:function(aB,aE){r(this);z(this.startContainer,aE.startContainer);var aH,aF,aA,aG;var aC=(aB==be||aB==k)?"start":"end";var aD=(aB==at||aB==k)?"start":"end";aH=this[aC+"Container"];aF=this[aC+"Offset"];aA=aE[aD+"Container"];aG=aE[aD+"Offset"];return bf(aH,aF,aA,aG)},insertNode:function(aA){r(this);bl(aA,g);bd(this.startContainer);if(bc(aA,this.startContainer)){throw new bm("HIERARCHY_REQUEST_ERR")}var aB=p(aA,this.startContainer,this.startOffset);this.setStartBefore(aB)},cloneContents:function(){r(this);var aA,aB;if(this.collapsed){return j(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&u(this.startContainer)){aA=this.startContainer.cloneNode(true);aA.data=aA.data.slice(this.startOffset,this.endOffset);aB=j(this).createDocumentFragment();aB.appendChild(aA);return aB}else{var aC=new w(this,true);aA=v(aC);aC.detach()}return aA}},canSurroundContents:function(){r(this);bd(this.startContainer);bd(this.endContainer);var aB=new w(this,true);var aA=(aB._first&&(au(aB._first,this))||(aB._last&&au(aB._last,this)));aB.detach();return !aA},surroundContents:function(aA){bl(aA,A);if(!this.canSurroundContents()){throw new bm("INVALID_STATE_ERR")}var aB=this.extractContents();if(aA.hasChildNodes()){while(aA.lastChild){aA.removeChild(aA.lastChild)}}p(aA,this.startContainer,this.startOffset);aA.appendChild(aB);this.selectNode(aA)},cloneRange:function(){r(this);var aC=new a4(j(this));var aB=i.length,aA;while(aB--){aA=i[aB];aC[aA]=this[aA]}return aC},toString:function(){r(this);var aA=this.startContainer;if(aA===this.endContainer&&u(aA)){return(aA.nodeType==3||aA.nodeType==4)?aA.data.slice(this.startOffset,this.endOffset):""}else{var aC=[],aB=new w(this,true);bk(aB,function(aD){if(aD.nodeType==3||aD.nodeType==4){aC.push(aD.data)}});aB.detach();return aC.join("")}},compareNode:function(aC){r(this);var aD=aC.parentNode;var aA=H(aC);if(!aD){throw new bm("NOT_FOUND_ERR")}var aB=this.comparePoint(aD,aA),aE=this.comparePoint(aD,aA+1);if(aB<0){return(aE>0)?o:ax}else{return(aE>0)?av:m}},comparePoint:function(aB,aA){r(this);a6(aB,"HIERARCHY_REQUEST_ERR");z(aB,this.startContainer);if(bf(aB,aA,this.startContainer,this.startOffset)<0){return -1}else{if(bf(aB,aA,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:bq,toHtml:function(){return t(this)},intersectsNode:function(aC,aF){r(this);a6(aC,"NOT_FOUND_ERR");if(bu(aC)!==j(this)){return false}var aD=aC.parentNode,aA=H(aC);a6(aD,"NOT_FOUND_ERR");var aB=bf(aD,aA,this.endContainer,this.endOffset),aE=bf(aD,aA+1,this.startContainer,this.startOffset);return aF?aB<=0&&aE>=0:aB<0&&aE>0},isPointInRange:function(aB,aA){r(this);a6(aB,"HIERARCHY_REQUEST_ERR");z(aB,this.startContainer);return(bf(aB,aA,this.startContainer,this.startOffset)>=0)&&(bf(aB,aA,this.endContainer,this.endOffset)<=0)},intersectsRange:function(aA){return bv(this,aA,false)},intersectsOrTouchesRange:function(aA){return bv(this,aA,true)},intersection:function(aD){if(this.intersectsRange(aD)){var aA=bf(this.startContainer,this.startOffset,aD.startContainer,aD.startOffset),aC=bf(this.endContainer,this.endOffset,aD.endContainer,aD.endOffset);var aB=this.cloneRange();if(aA==-1){aB.setStart(aD.startContainer,aD.startOffset)}if(aC==1){aB.setEnd(aD.endContainer,aD.endOffset)}return aB}return null},union:function(aB){if(this.intersectsOrTouchesRange(aB)){var aA=this.cloneRange();if(bf(aB.startContainer,aB.startOffset,this.startContainer,this.startOffset)==-1){aA.setStart(aB.startContainer,aB.startOffset)}if(bf(aB.endContainer,aB.endOffset,this.endContainer,this.endOffset)==1){aA.setEnd(aB.endContainer,aB.endOffset)}return aA}else{throw new bm("Ranges do not intersect")}},containsNode:function(aA,aB){if(aB){return this.intersectsNode(aA,false)}else{return this.compareNode(aA)==m}},containsNodeContents:function(aA){return this.comparePoint(aA,0)>=0&&this.comparePoint(aA,bn(aA))<=0},containsRange:function(aB){var aA=this.intersection(aB);return aA!==null&&aB.equals(aA)},containsNodeText:function(aB){var aA=this.cloneRange();aA.selectNode(aB);var aC=aA.getNodes([3]);if(aC.length>0){aA.setStart(aC[0],0);var aD=aC.pop();aA.setEnd(aD,aD.length);return this.containsRange(aA)}else{return this.containsNodeContents(aB)}},getNodes:function(aB,aA){r(this);return d(this,aB,aA)},getDocument:function(){return j(this)},collapseBefore:function(aA){this.setEndBefore(aA);this.collapse(false)},collapseAfter:function(aA){this.setStartAfter(aA);this.collapse(true)},getBookmark:function(aF){var aB=j(this);var aD=q.createRange(aB);aF=aF||C.getBody(aB);aD.selectNodeContents(aF);var aC=this.intersection(aD);var aA=0,aE=0;if(aC){aD.setEnd(aC.startContainer,aC.startOffset);aA=aD.toString().length;aE=aA+aC.toString().length}return{start:aA,end:aE,containerNode:aF}},moveToBookmark:function(aD){var aH=aD.containerNode;var aA=0;this.setStart(aH,0);this.collapse(true);var aF=[aH],aJ,aI=false,aC=false;var aE,aG,aB;while(!aC&&(aJ=aF.pop())){if(aJ.nodeType==3){aE=aA+aJ.length;if(!aI&&aD.start>=aA&&aD.start<=aE){this.setStart(aJ,aD.start-aA);aI=true}if(aI&&aD.end>=aA&&aD.end<=aE){this.setEnd(aJ,aD.end-aA);aC=true}aA=aE}else{aB=aJ.childNodes;aG=aB.length;while(aG--){aF.push(aB[aG])}}}},getName:function(){return"DomRange"},equals:function(aA){return a4.rangesEqual(this,aA)},isValid:function(){return b(this)},inspect:function(){return ar(this)},detach:function(){}});function bp(aA){aA.START_TO_START=k;aA.START_TO_END=at;aA.END_TO_END=a8;aA.END_TO_START=be;aA.NODE_BEFORE=ax;aA.NODE_AFTER=av;aA.NODE_BEFORE_AND_AFTER=o;aA.NODE_INSIDE=m}function x(aA){bp(aA);bp(aA.prototype)}function az(aB,aA){return function(){r(this);var aI=this.startContainer,aC=this.startOffset,aG=this.commonAncestorContainer;var aE=new w(this,true);var aD,aH;if(aI!==aG){aD=bg(aI,aG,true);aH=bj(aD);aI=aH.node;aC=aH.offset}bk(aE,bd);aE.reset();var aF=aB(aE);aE.detach();aA(this,aI,aC,aI,aC);return aF}}function bi(aE,aA){function aB(aH,aG){return function(aJ){bl(aJ,a9);bl(aw(aJ),bb);var aI=(aH?I:bj)(aJ);(aG?aF:aC)(this,aI.node,aI.offset)}}function aF(aK,aI,aH){var aJ=aK.endContainer,aG=aK.endOffset;if(aI!==aK.startContainer||aH!==aK.startOffset){if(aw(aI)!=aw(aJ)||bf(aI,aH,aJ,aG)==1){aJ=aI;aG=aH}aA(aK,aI,aH,aJ,aG)}}function aC(aG,aK,aH){var aI=aG.startContainer,aJ=aG.startOffset;if(aK!==aG.endContainer||aH!==aG.endOffset){if(aw(aK)!=aw(aI)||bf(aK,aH,aI,aJ)==-1){aI=aK;aJ=aH}aA(aG,aI,aJ,aK,aH)}}var aD=function(){};aD.prototype=q.rangePrototype;aE.prototype=new aD();a.extend(aE.prototype,{setStart:function(aG,aH){ay(aG,true);ba(aG,aH);aF(this,aG,aH)},setEnd:function(aG,aH){ay(aG,true);ba(aG,aH);aC(this,aG,aH)},setStartAndEnd:function(){var aJ=arguments;var aH=aJ[0],aI=aJ[1],aK=aH,aG=aI;switch(aJ.length){case 3:aG=aJ[2];break;case 4:aK=aJ[2];aG=aJ[3];break}aA(this,aH,aI,aK,aG)},setBoundary:function(aI,aH,aG){this["set"+(aG?"Start":"End")](aI,aH)},setStartBefore:aB(true,true),setStartAfter:aB(false,true),setEndBefore:aB(true,false),setEndAfter:aB(false,false),collapse:function(aG){r(this);if(aG){aA(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{aA(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(aG){ay(aG,true);aA(this,aG,0,aG,bn(aG))},selectNode:function(aI){ay(aI,false);bl(aI,a9);var aH=I(aI),aG=bj(aI);aA(this,aH.node,aH.offset,aG.node,aG.offset)},extractContents:az(br,aA),deleteContents:az(h,aA),canSurroundContents:function(){r(this);bd(this.startContainer);bd(this.endContainer);var aG=new w(this,true);var aH=(aG._first&&au(aG._first,this)||(aG._last&&au(aG._last,this)));aG.detach();return !aH},splitBoundaries:function(){a5(this)},splitBoundariesPreservingPositions:function(aG){a5(this,aG)},normalizeBoundaries:function(){r(this);var aH=this.startContainer,aM=this.startOffset,aI=this.endContainer,aO=this.endOffset;var aL=function(aP){var aQ=aP.nextSibling;if(aQ&&aQ.nodeType==aP.nodeType){aI=aP;aO=aP.length;aP.appendData(aQ.data);aQ.parentNode.removeChild(aQ)}};var aG=function(aP){var aQ=aP.previousSibling;if(aQ&&aQ.nodeType==aP.nodeType){aH=aP;var aR=aP.length;aM=aQ.length;aP.insertData(0,aQ.data);aQ.parentNode.removeChild(aQ);if(aH==aI){aO+=aM;aI=aH}else{if(aI==aP.parentNode){var aS=H(aP);if(aO==aS){aI=aP;aO=aR}else{if(aO>aS){aO--}}}}}};var aJ=true;if(u(aI)){if(aI.length==aO){aL(aI)}}else{if(aO>0){var aK=aI.childNodes[aO-1];if(aK&&u(aK)){aL(aK)}}aJ=!this.collapsed}if(aJ){if(u(aH)){if(aM==0){aG(aH)}}else{if(aM<aH.childNodes.length){var aN=aH.childNodes[aM];if(aN&&u(aN)){aG(aN)}}}}else{aH=aI;aM=aO}aA(this,aH,aM,aI,aO)},collapseToPoint:function(aG,aH){ay(aG,true);ba(aG,aH);this.setStartAndEnd(aG,aH)}});x(aE)}function e(aA){aA.collapsed=(aA.startContainer===aA.endContainer&&aA.startOffset===aA.endOffset);aA.commonAncestorContainer=aA.collapsed?aA.startContainer:C.getCommonAncestor(aA.startContainer,aA.endContainer)}function D(aD,aB,aE,aA,aC){aD.startContainer=aB;aD.startOffset=aE;aD.endContainer=aA;aD.endOffset=aC;aD.document=C.getDocument(aB);e(aD)}function a4(aA){this.startContainer=aA;this.startOffset=0;this.endContainer=aA;this.endOffset=0;this.document=aA;e(this)}bi(a4,D);a.extend(a4,{rangeProperties:i,RangeIterator:w,copyComparisonConstants:x,createPrototypeRange:bi,inspect:ar,toHtml:t,getRangeDocument:j,rangesEqual:function(aA,aB){return aA.startContainer===aB.startContainer&&aA.startOffset===aB.startOffset&&aA.endContainer===aB.endContainer&&aA.endOffset===aB.endOffset}});q.DomRange=a4});X.createCoreModule("WrappedRange",["DomRange"],function(f,n){var r,q;var j=f.dom;var i=f.util;var o=j.DomPosition;var d=f.DomRange;var h=j.getBody;var a=j.getContentDocument;var g=j.isCharacterDataNode;if(f.features.implementsDomRange){(function(){var B;var u=d.rangeProperties;function s(G){var F=u.length,E;while(F--){E=u[F];G[E]=G.nativeRange[E]}G.collapsed=(G.startContainer===G.endContainer&&G.startOffset===G.endOffset)}function z(I,F,ar,E,H){var at=(I.startContainer!==F||I.startOffset!=ar);var av=(I.endContainer!==E||I.endOffset!=H);var G=!I.equals(I.nativeRange);if(at||av||G){I.setEnd(E,H);I.setStart(F,ar)}}var C;r=function(E){if(!E){throw n.createError("WrappedRange: Range must be specified")}this.nativeRange=E;s(this)};d.createPrototypeRange(r,z);B=r.prototype;B.selectNode=function(E){this.nativeRange.selectNode(E);s(this)};B.cloneContents=function(){return this.nativeRange.cloneContents()};B.surroundContents=function(E){this.nativeRange.surroundContents(E);s(this)};B.collapse=function(E){this.nativeRange.collapse(E);s(this)};B.cloneRange=function(){return new r(this.nativeRange.cloneRange())};B.refresh=function(){s(this)};B.toString=function(){return this.nativeRange.toString()};var v=document.createTextNode("test");h(document).appendChild(v);var y=document.createRange();y.setStart(v,0);y.setEnd(v,0);try{y.setStart(v,1);B.setStart=function(F,E){this.nativeRange.setStart(F,E);s(this)};B.setEnd=function(F,E){this.nativeRange.setEnd(F,E);s(this)};C=function(E){return function(F){this.nativeRange[E](F);s(this)}}}catch(w){B.setStart=function(F,E){try{this.nativeRange.setStart(F,E)}catch(G){this.nativeRange.setEnd(F,E);this.nativeRange.setStart(F,E)}s(this)};B.setEnd=function(F,E){try{this.nativeRange.setEnd(F,E)}catch(G){this.nativeRange.setStart(F,E);this.nativeRange.setEnd(F,E)}s(this)};C=function(F,E){return function(G){try{this.nativeRange[F](G)}catch(H){this.nativeRange[E](G);this.nativeRange[F](G)}s(this)}}}B.setStartBefore=C("setStartBefore","setEndBefore");B.setStartAfter=C("setStartAfter","setEndAfter");B.setEndBefore=C("setEndBefore","setStartBefore");B.setEndAfter=C("setEndAfter","setStartAfter");B.selectNodeContents=function(E){this.setStartAndEnd(E,0,j.getNodeLength(E))};y.selectNodeContents(v);y.setEnd(v,3);var t=document.createRange();t.selectNodeContents(v);t.setEnd(v,4);t.setStart(v,2);if(y.compareBoundaryPoints(y.START_TO_END,t)==-1&&y.compareBoundaryPoints(y.END_TO_START,t)==1){B.compareBoundaryPoints=function(E,F){F=F.nativeRange||F;if(E==F.START_TO_END){E=F.END_TO_START}else{if(E==F.END_TO_START){E=F.START_TO_END}}return this.nativeRange.compareBoundaryPoints(E,F)}}else{B.compareBoundaryPoints=function(E,F){return this.nativeRange.compareBoundaryPoints(E,F.nativeRange||F)}}var D=document.createElement("div");D.innerHTML="123";var A=D.firstChild;var x=h(document);x.appendChild(D);y.setStart(A,1);y.setEnd(A,2);y.deleteContents();if(A.data=="13"){B.deleteContents=function(){this.nativeRange.deleteContents();s(this)};B.extractContents=function(){var E=this.nativeRange.extractContents();s(this);return E}}else{}x.removeChild(D);x=null;if(i.isHostMethod(y,"createContextualFragment")){B.createContextualFragment=function(E){return this.nativeRange.createContextualFragment(E)}}h(document).removeChild(v);B.getName=function(){return"WrappedRange"};f.WrappedRange=r;f.createNativeRange=function(E){E=a(E,n,"createNativeRange");return E.createRange()}})()}if(f.features.implementsTextRange){var m=function(s){var u=s.parentElement();var w=s.duplicate();w.collapse(true);var t=w.parentElement();w=s.duplicate();w.collapse(false);var v=w.parentElement();var x=(t==v)?t:j.getCommonAncestor(t,v);return x==u?x:j.getCommonAncestor(u,x)};var p=function(s){return s.compareEndPoints("StartToEnd",s)==0};var l=function(aw,B,D,av,ar){var A=aw.duplicate();A.collapse(D);var au=A.parentElement();if(!j.isOrIsAncestorOf(B,au)){au=B}if(!au.canHaveHTML){var E=new o(au.parentNode,j.getNodeIndex(au));return{boundaryPosition:E,nodeInfo:{nodeIndex:E.offset,containerElement:E.node}}}var at=j.getDocument(au).createElement("span");if(at.parentNode){at.parentNode.removeChild(at)}var s,u=D?"StartToStart":"StartToEnd";var z,I,C,y;var G=(ar&&ar.containerElement==au)?ar.nodeIndex:0;var x=au.childNodes.length;var H=x;var v=H;while(true){if(v==x){au.appendChild(at)}else{au.insertBefore(at,au.childNodes[v])}A.moveToElementText(at);s=A.compareEndPoints(u,aw);if(s==0||G==H){break}else{if(s==-1){if(H==G+1){break}else{G=v}}else{H=(H==G+1)?G:v}}v=Math.floor((G+H)/2);au.removeChild(at)}y=at.nextSibling;if(s==-1&&y&&g(y)){A.setEndPoint(D?"EndToStart":"EndToEnd",aw);var F;if(/[\r\n]/.test(y.data)){var w=A.duplicate();var t=w.text.replace(/\r\n/g,"\r").length;F=w.moveStart("character",t);while((s=w.compareEndPoints("StartToEnd",w))==-1){F++;w.moveStart("character",1)}}else{F=A.text.length}C=new o(y,F)}else{z=(av||!D)&&at.previousSibling;I=(av||D)&&at.nextSibling;if(I&&g(I)){C=new o(I,0)}else{if(z&&g(z)){C=new o(z,z.data.length)}else{C=new o(au,j.getNodeIndex(at))}}}at.parentNode.removeChild(at);return{boundaryPosition:C,nodeInfo:{nodeIndex:v,containerElement:au}}};var b=function(s,A){var z,w,y=s.offset;var v=j.getDocument(s.node);var B,u,t=h(v).createTextRange();var x=g(s.node);if(x){z=s.node;w=z.parentNode}else{u=s.node.childNodes;z=(y<u.length)?u[y]:null;w=s.node}B=v.createElement("span");B.innerHTML="&#feff;";if(z){w.insertBefore(B,z)}else{w.appendChild(B)}t.moveToElementText(B);t.collapse(!A);w.removeChild(B);if(x){t[A?"moveStart":"moveEnd"]("character",y)}return t};q=function(s){this.textRange=s;this.refresh()};q.prototype=new d(document);q.prototype.refresh=function(){var s,v,t;var u=m(this.textRange);if(p(this.textRange)){v=s=l(this.textRange,u,true,true).boundaryPosition}else{t=l(this.textRange,u,true,false);s=t.boundaryPosition;v=l(this.textRange,u,false,false,t.nodeInfo).boundaryPosition}this.setStart(s.node,s.offset);this.setEnd(v.node,v.offset)};q.prototype.getName=function(){return"WrappedTextRange"};d.copyComparisonConstants(q);var e=function(v){if(v.collapsed){return b(new o(v.startContainer,v.startOffset),true)}else{var s=b(new o(v.startContainer,v.startOffset),true);var t=b(new o(v.endContainer,v.endOffset),false);var u=h(d.getRangeDocument(v)).createTextRange();u.setEndPoint("StartToStart",s);u.setEndPoint("EndToEnd",t);return u}};q.rangeToTextRange=e;q.prototype.toTextRange=function(){return e(this)};f.WrappedTextRange=q;if(!f.features.implementsDomRange||f.config.preferTextRange){var k=(function(){return this})();if(typeof k.Range=="undefined"){k.Range=q}f.createNativeRange=function(s){s=a(s,n,"createNativeRange");return h(s).createTextRange()};f.WrappedRange=q}}f.createRange=function(s){s=a(s,n,"createRange");return new f.WrappedRange(f.createNativeRange(s))};f.createRangyRange=function(s){s=a(s,n,"createRangyRange");return new d(s)};f.createIframeRange=function(s){n.deprecationNotice("createIframeRange()","createRange(iframeEl)");return f.createRange(s)};f.createIframeRangyRange=function(s){n.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return f.createRangyRange(s)};f.addShimListener(function(s){var t=s.document;if(typeof t.createRange=="undefined"){t.createRange=function(){return f.createRange(t)}}t=s=null})});X.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(p,A){p.config.checkSelectionRanges=true;var s="boolean";var l="number";var C=p.dom;var f=p.util;var a7=f.isHostMethod;var a3=p.DomRange;var w=p.WrappedRange;var a8=p.DOMException;var B=C.DomPosition;var bb;var a;var h=p.features;var aV="Control";var aW=C.getDocument;var aX=C.getBody;var g=a3.rangesEqual;function u(aA){return(typeof aA=="string")?/^backward(s)?$/i.test(aA):!!aA}function I(aA,aC){if(!aA){return window}else{if(C.isWindow(aA)){return aA}else{if(aA instanceof y){return aA.win}else{var aB=C.getContentDocument(aA,A,aC);return C.getWindow(aB)}}}}function d(aA){return I(aA,"getWinSelection").getSelection()}function ax(aA){return I(aA,"getDocSelection").document.selection}function aY(aB){var aA=false;if(aB.anchorNode){aA=(C.comparePoints(aB.anchorNode,aB.anchorOffset,aB.focusNode,aB.focusOffset)==1)}return aA}var a0=a7(window,"getSelection"),a9=f.isHostObject(document,"selection");h.implementsWinGetSelection=a0;h.implementsDocSelection=a9;var au=a9&&(!a0||p.config.preferTextRange);if(au){bb=ax;p.isSelectionValid=function(aB){var aA=I(aB,"isSelectionValid").document,aC=aA.selection;return(aC.type!="None"||aW(aC.createRange().parentElement())==aA)}}else{if(a0){bb=d;p.isSelectionValid=function(){return true}}else{A.fail("Neither document.selection or window.getSelection() detected.")}}p.getNativeSelection=bb;var ba=bb();var v=p.createNativeRange(document);var t=aX(document);var bd=f.areHostProperties(ba,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=bd;var ay=a7(ba,"extend");h.selectionHasExtend=ay;var aU=(typeof ba.rangeCount==l);h.selectionHasRangeCount=aU;var a4=false;var a6=true;var H=ay?function(aA,aD){var aB=a3.getRangeDocument(aD);var aC=p.createRange(aB);aC.collapseToPoint(aD.endContainer,aD.endOffset);aA.addRange(b(aC));aA.extend(aD.startContainer,aD.startOffset)}:null;if(f.areHostMethods(ba,["addRange","getRangeAt","removeAllRanges"])&&typeof ba.rangeCount==l&&h.implementsDomRange){(function(){var aI=window.getSelection();if(aI){var aE=aI.rangeCount;var aC=(aE>1);var aA=[];var aK=aY(aI);for(var aD=0;aD<aE;++aD){aA[aD]=aI.getRangeAt(aD)}var aB=aX(document);var aF=aB.appendChild(document.createElement("div"));aF.contentEditable="false";var aG=aF.appendChild(document.createTextNode("\u00a0\u00a0\u00a0"));var aH=document.createRange();aH.setStart(aG,1);aH.collapse(true);aI.addRange(aH);a6=(aI.rangeCount==1);aI.removeAllRanges();if(!aC){var aL=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(aL&&parseInt(aL[1])>=36){a4=false}else{var aJ=aH.cloneRange();aH.setStart(aG,0);aJ.setEnd(aG,3);aJ.setStart(aG,2);aI.addRange(aH);aI.addRange(aJ);a4=(aI.rangeCount==2)}}aB.removeChild(aF);aI.removeAllRanges();for(aD=0;aD<aE;++aD){if(aD==0&&aK){if(H){H(aI,aA[aD])}else{p.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");aI.addRange(aA[aD])}}else{aI.addRange(aA[aD])}}}})()}h.selectionSupportsMultipleRanges=a4;h.collapsedNonEditableSelectionsSupported=a6;var q=false,k;if(t&&a7(t,"createControlRange")){k=t.createControlRange();if(f.areHostProperties(k,["item","add"])){q=true}}h.implementsControlRange=q;if(bd){a=function(aA){return aA.anchorNode===aA.focusNode&&aA.anchorOffset===aA.focusOffset}}else{a=function(aA){return aA.rangeCount?aA.getRangeAt(aA.rangeCount-1).collapsed:false}}function E(aC,aE,aB){var aD=aB?"end":"start",aA=aB?"start":"end";aC.anchorNode=aE[aD+"Container"];aC.anchorOffset=aE[aD+"Offset"];aC.focusNode=aE[aA+"Container"];aC.focusOffset=aE[aA+"Offset"]}function ar(aA){var aB=aA.nativeSelection;aA.anchorNode=aB.anchorNode;aA.anchorOffset=aB.anchorOffset;aA.focusNode=aB.focusNode;aA.focusOffset=aB.focusOffset}function j(aA){aA.anchorNode=aA.focusNode=null;aA.anchorOffset=aA.focusOffset=0;aA.rangeCount=0;aA.isCollapsed=true;aA._ranges.length=0}function b(aB){var aA;if(aB instanceof a3){aA=p.createNativeRange(aB.getDocument());aA.setEnd(aB.endContainer,aB.endOffset);aA.setStart(aB.startContainer,aB.startOffset)}else{if(aB instanceof w){aA=aB.nativeRange}else{if(h.implementsDomRange&&(aB instanceof C.getWindow(aB.startContainer).Range)){aA=aB}}}return aA}function i(aA){if(!aA.length||aA[0].nodeType!=1){return false}for(var aB=1,aC=aA.length;aB<aC;++aB){if(!C.isAncestorOf(aA[0],aA[aB])){return false}}return true}function bc(aA){var aB=aA.getNodes();if(!i(aB)){throw A.createError("getSingleElementFromRange: range "+aA.inspect()+" did not consist of a single element")}return aB[0]}function n(aA){return !!aA&&typeof aA.text!="undefined"}function e(aA,aB){var aC=new w(aB);aA._ranges=[aC];E(aA,aC,false);aA.rangeCount=1;aA.isCollapsed=aC.collapsed}function av(aB){aB._ranges.length=0;if(aB.docSelection.type=="None"){j(aB)}else{var aC=aB.docSelection.createRange();if(n(aC)){e(aB,aC)}else{aB.rangeCount=aC.length;var aE,aA=aW(aC.item(0));for(var aD=0;aD<aB.rangeCount;++aD){aE=p.createRange(aA);aE.selectNode(aC.item(aD));aB._ranges.push(aE)}aB.isCollapsed=aB.rangeCount==1&&aB._ranges[0].collapsed;E(aB,aB._ranges[aB.rangeCount-1],false)}}}function D(aH,aE){var aG=aH.docSelection.createRange();var aI=bc(aE);var aA=aW(aG.item(0));var aD=aX(aA).createControlRange();for(var aF=0,aC=aG.length;aF<aC;++aF){aD.add(aG.item(aF))}try{aD.add(aI)}catch(aB){throw A.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}aD.select();av(aH)}var az;if(a7(ba,"getRangeAt")){az=function(aA,aC){try{return aA.getRangeAt(aC)}catch(aB){return null}}}else{if(bd){az=function(aB){var aA=aW(aB.anchorNode);var aC=p.createRange(aA);aC.setStartAndEnd(aB.anchorNode,aB.anchorOffset,aB.focusNode,aB.focusOffset);if(aC.collapsed!==this.isCollapsed){aC.setStartAndEnd(aB.focusNode,aB.focusOffset,aB.anchorNode,aB.anchorOffset)}return aC}}}function y(aC,aA,aB){this.nativeSelection=aC;this.docSelection=aA;this._ranges=[];this.win=aB;this.refresh()}y.prototype=p.selectionPrototype;function G(aA){aA.win=aA.anchorNode=aA.focusNode=aA._ranges=null;aA.rangeCount=aA.anchorOffset=aA.focusOffset=0;aA.detached=true}var aZ=[];function a5(aA,aB){var aE=aZ.length,aD,aC;while(aE--){aD=aZ[aE];aC=aD.selection;if(aB=="deleteAll"){G(aC)}else{if(aD.win==aA){if(aB=="delete"){aZ.splice(aE,1);return true}else{return aC}}}}if(aB=="deleteAll"){aZ.length=0}return null}var at=function(aB){if(aB&&aB instanceof y){aB.refresh();return aB}aB=I(aB,"getNativeSelection");var aC=a5(aB);var aD=bb(aB),aA=a9?ax(aB):null;if(aC){aC.nativeSelection=aD;aC.docSelection=aA;aC.refresh()}else{aC=new y(aD,aA,aB);aZ.push({win:aB,selection:aC})}return aC};p.getSelection=at;p.getIframeSelection=function(aA){A.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return p.getSelection(C.getIframeWindow(aA))};var F=y.prototype;function m(aB,aG){var aA=aW(aG[0].startContainer);var aD=aX(aA).createControlRange();for(var aE=0,aC,aH=aG.length;aE<aH;++aE){aC=bc(aG[aE]);try{aD.add(aC)}catch(aF){throw A.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}aD.select();av(aB)}if(!au&&bd&&f.areHostMethods(ba,["removeAllRanges","addRange"])){F.removeAllRanges=function(){this.nativeSelection.removeAllRanges();j(this)};var x=function(aA,aB){H(aA.nativeSelection,aB);aA.refresh()};if(aU){F.addRange=function(aD,aA){if(q&&a9&&this.docSelection.type==aV){D(this,aD)}else{if(u(aA)&&ay){x(this,aD)}else{var aC;if(a4){aC=this.rangeCount}else{this.removeAllRanges();aC=0}this.nativeSelection.addRange(b(aD).cloneRange());this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==aC+1){if(p.config.checkSelectionRanges){var aB=az(this.nativeSelection,this.rangeCount-1);if(aB&&!g(aB,aD)){aD=new w(aB)}}this._ranges[this.rangeCount-1]=aD;E(this,aD,r(this.nativeSelection));this.isCollapsed=a(this)}else{this.refresh()}}}}}else{F.addRange=function(aB,aA){if(u(aA)&&ay){x(this,aB)}else{this.nativeSelection.addRange(b(aB));this.refresh()}}}F.setRanges=function(aB){if(q&&a9&&aB.length>1){m(this,aB)}else{this.removeAllRanges();for(var aA=0,aC=aB.length;aA<aC;++aA){this.addRange(aB[aA])}}}}else{if(a7(ba,"empty")&&a7(v,"select")&&q&&au){F.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var aA;if(this.anchorNode){aA=aW(this.anchorNode)}else{if(this.docSelection.type==aV){var aC=this.docSelection.createRange();if(aC.length){aA=aW(aC.item(0))}}}if(aA){var aB=aX(aA).createTextRange();aB.select();this.docSelection.empty()}}}catch(aD){}j(this)};F.addRange=function(aA){if(this.docSelection.type==aV){D(this,aA)}else{p.WrappedTextRange.rangeToTextRange(aA).select();this._ranges[0]=aA;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;E(this,aA,false)}};F.setRanges=function(aB){this.removeAllRanges();var aA=aB.length;if(aA>1){m(this,aB)}else{if(aA){this.addRange(aB[0])}}}}else{A.fail("No means of selecting a Range or TextRange was found");return false}}F.getRangeAt=function(aA){if(aA<0||aA>=this.rangeCount){throw new a8("INDEX_SIZE_ERR")}else{return this._ranges[aA].cloneRange()}};var o;if(au){o=function(aA){var aB;if(p.isSelectionValid(aA.win)){aB=aA.docSelection.createRange()}else{aB=aX(aA.win.document).createTextRange();aB.collapse(true)}if(aA.docSelection.type==aV){av(aA)}else{if(n(aB)){e(aA,aB)}else{j(aA)}}}}else{if(a7(ba,"getRangeAt")&&typeof ba.rangeCount==l){o=function(aA){if(q&&a9&&aA.docSelection.type==aV){av(aA)}else{aA._ranges.length=aA.rangeCount=aA.nativeSelection.rangeCount;if(aA.rangeCount){for(var aB=0,aC=aA.rangeCount;aB<aC;++aB){aA._ranges[aB]=new p.WrappedRange(aA.nativeSelection.getRangeAt(aB))}E(aA,aA._ranges[aA.rangeCount-1],r(aA.nativeSelection));aA.isCollapsed=a(aA)}else{j(aA)}}}}else{if(bd&&typeof ba.isCollapsed==s&&typeof v.collapsed==s&&h.implementsDomRange){o=function(aA){var aC,aB=aA.nativeSelection;if(aB.anchorNode){aC=az(aB,0);aA._ranges=[aC];aA.rangeCount=1;ar(aA);aA.isCollapsed=a(aA)}else{j(aA)}}}else{A.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}F.refresh=function(aD){var aE=aD?this._ranges.slice(0):null;var aB=this.anchorNode,aA=this.anchorOffset;o(this);if(aD){var aC=aE.length;if(aC!=this._ranges.length){return true}if(this.anchorNode!=aB||this.anchorOffset!=aA){return true}while(aC--){if(!g(aE[aC],this._ranges[aC])){return true}}return false}};var z=function(aA,aC){var aD=aA.getAllRanges();aA.removeAllRanges();for(var aB=0,aE=aD.length;aB<aE;++aB){if(!g(aC,aD[aB])){aA.addRange(aD[aB])}}if(!aA.rangeCount){j(aA)}};if(q&&a9){F.removeRange=function(aE){if(this.docSelection.type==aV){var aG=this.docSelection.createRange();var aI=bc(aE);var aA=aW(aG.item(0));var aC=aX(aA).createControlRange();var aH,aB=false;for(var aF=0,aD=aG.length;aF<aD;++aF){aH=aG.item(aF);if(aH!==aI||aB){aC.add(aG.item(aF))}else{aB=true}}aC.select();av(this)}else{z(this,aE)}}}else{F.removeRange=function(aA){z(this,aA)}}var r;if(!au&&bd&&h.implementsDomRange){r=aY;F.isBackward=function(){return r(this)}}else{r=F.isBackward=function(){return false}}F.isBackwards=F.isBackward;F.toString=function(){var aA=[];for(var aB=0,aC=this.rangeCount;aB<aC;++aB){aA[aB]=""+this._ranges[aB]}return aA.join("")};function a2(aA,aB){if(aA.win.document!=aW(aB)){throw new a8("WRONG_DOCUMENT_ERR")}}F.collapse=function(aB,aA){a2(this,aB);var aC=p.createRange(aB);aC.collapseToPoint(aB,aA);this.setSingleRange(aC);this.isCollapsed=true};F.collapseToStart=function(){if(this.rangeCount){var aA=this._ranges[0];this.collapse(aA.startContainer,aA.startOffset)}else{throw new a8("INVALID_STATE_ERR")}};F.collapseToEnd=function(){if(this.rangeCount){var aA=this._ranges[this.rangeCount-1];this.collapse(aA.endContainer,aA.endOffset)}else{throw new a8("INVALID_STATE_ERR")}};F.selectAllChildren=function(aA){a2(this,aA);var aB=p.createRange(aA);aB.selectNodeContents(aA);this.setSingleRange(aB)};F.deleteFromDocument=function(){if(q&&a9&&this.docSelection.type==aV){var aA=this.docSelection.createRange();var aB;while(aA.length){aB=aA.item(0);aA.remove(aB);aB.parentNode.removeChild(aB)}this.refresh()}else{if(this.rangeCount){var aD=this.getAllRanges();if(aD.length){this.removeAllRanges();for(var aC=0,aE=aD.length;aC<aE;++aC){aD[aC].deleteContents()}this.addRange(aD[aE-1])}}}};F.eachRange=function(aA,aB){for(var aC=0,aD=this._ranges.length;aC<aD;++aC){if(aA(this.getRangeAt(aC))){return aB}}};F.getAllRanges=function(){var aA=[];this.eachRange(function(aB){aA.push(aB)});return aA};F.setSingleRange=function(aB,aA){this.removeAllRanges();this.addRange(aB,aA)};F.callMethodOnEachRange=function(aC,aA){var aB=[];this.eachRange(function(aD){aB.push(aD[aC].apply(aD,aA))});return aB};function a1(aA){return function(aC,aB){var aD;if(this.rangeCount){aD=this.getRangeAt(0);aD["set"+(aA?"Start":"End")](aC,aB)}else{aD=p.createRange(this.win.document);aD.setStartAndEnd(aC,aB)}this.setSingleRange(aD,this.isBackward())}}F.setStart=a1(true);F.setEnd=a1(false);p.rangePrototype.select=function(aA){at(this.getDocument()).setSingleRange(this,aA)};F.changeEachRange=function(aB){var aC=[];var aA=this.isBackward();this.eachRange(function(aD){aB(aD);aC.push(aD)});this.removeAllRanges();if(aA&&aC.length==1){this.addRange(aC[0],"backward")}else{this.setRanges(aC)}};F.containsNode=function(aA,aB){return this.eachRange(function(aC){return aC.containsNode(aA,aB)},true)||false};F.getBookmark=function(aA){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[aA])}};F.moveToBookmark=function(aA){var aE=[];for(var aB=0,aC,aD;aC=aA.rangeBookmarks[aB++];){aD=p.createRange(this.win);aD.moveToBookmark(aC);aE.push(aD)}if(aA.backward){this.setSingleRange(aE[0],"backward")}else{this.setRanges(aE)}};F.toHtml=function(){var aA=[];this.eachRange(function(aB){aA.push(a3.toHtml(aB))});return aA.join("")};if(h.implementsTextRange){F.getNativeTextRange=function(){var aA,aB;if((aA=this.docSelection)){var aC=aA.createRange();if(n(aC)){return aC}else{throw A.createError("getNativeTextRange: selection is a control selection")}}else{if(this.rangeCount>0){return p.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw A.createError("getNativeTextRange: selection contains no range")}}}}function aw(aA){var aB=[];var aD=new B(aA.anchorNode,aA.anchorOffset);var aF=new B(aA.focusNode,aA.focusOffset);var aE=(typeof aA.getName=="function")?aA.getName():"Selection";if(typeof aA.rangeCount!="undefined"){for(var aC=0,aG=aA.rangeCount;aC<aG;++aC){aB[aC]=a3.inspect(aA.getRangeAt(aC))}}return"["+aE+"(Ranges: "+aB.join(", ")+")(anchor: "+aD.inspect()+", focus: "+aF.inspect()+"]"}F.getName=function(){return"WrappedSelection"};F.inspect=function(){return aw(this)};F.detach=function(){a5(this.win,"delete");G(this)};y.detachAll=function(){a5(null,"deleteAll")};y.inspect=aw;y.isDirectionBackward=u;p.Selection=y;p.selectionPrototype=F;p.addShimListener(function(aA){if(typeof aA.getSelection=="undefined"){aA.getSelection=function(){return at(aA)}}aA=null})});return X},this);(function(e,d){if(typeof define=="function"&&define.amd){define(["rangy"],e)}else{e(d.rangy)}})(function(b){b.createModule("SaveRestore",["WrappedRange"],function(y,B){var z=y.dom;var E="\ufeff";function a(d,e){return(e||document).getElementById(d)}function D(g,i){var f="selectionBoundary_"+(+new Date())+"_"+(""+Math.random()).slice(2);var h;var d=z.getDocument(g.startContainer);var e=g.cloneRange();e.collapse(i);h=d.createElement("span");h.id=f;h.style.lineHeight="0";h.style.display="none";h.className="rangySelectionBoundary";h.appendChild(d.createTextNode(E));e.insertNode(h);return h}function u(d,f,e,h){var g=a(e,d);if(g){f[h?"setStartBefore":"setEndBefore"](g);g.parentNode.removeChild(g)}else{B.warn("Marker element has been removed. Cannot restore selection.")}}function C(d,e){return e.compareBoundaryPoints(d.START_TO_START,d)}function w(i,d){var g,h,f=y.DomRange.getRangeDocument(i),e=i.toString();if(i.collapsed){h=D(i,false);return{document:f,markerId:h.id,collapsed:true}}else{h=D(i,false);g=D(i,true);return{document:f,startMarkerId:g.id,endMarkerId:h.id,collapsed:false,backward:d,toString:function(){return"original text: '"+e+"', new text: '"+i.toString()+"'"}}}}function s(e,f){var d=e.document;if(typeof f=="undefined"){f=true}var g=y.createRange(d);if(e.collapsed){var h=a(e.markerId,d);if(h){h.style.display="inline";var i=h.previousSibling;if(i&&i.nodeType==3){h.parentNode.removeChild(h);g.collapseToPoint(i,i.length)}else{g.collapseBefore(h);h.parentNode.removeChild(h)}}else{B.warn("Marker element has been removed. Cannot restore selection.")}}else{u(d,g,e.startMarkerId,true);u(d,g,e.endMarkerId,false)}if(f){g.normalizeBoundaries()}return g}function F(h,j){var e=[],g,d;h=h.slice(0);h.sort(C);for(var f=0,i=h.length;f<i;++f){e[f]=w(h[f],j)}for(f=i-1;f>=0;--f){g=h[f];d=y.DomRange.getRangeDocument(g);if(g.collapsed){g.collapseAfter(a(e[f].markerId,d))}else{g.setEndBefore(a(e[f].endMarkerId,d));g.setStartAfter(a(e[f].startMarkerId,d))}}return e}function A(e){if(!y.isSelectionValid(e)){B.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");return null}var f=y.getSelection(e);var h=f.getAllRanges();var d=(h.length==1&&f.isBackward());var g=F(h,d);if(d){f.setSingleRange(h[0],"backward")}else{f.setRanges(h)}return{win:e,rangeInfos:g,restored:false}}function t(d){var g=[];var f=d.length;for(var e=f-1;e>=0;e--){g[e]=s(d[e],true)}return g}function G(i,f){if(!i.restored){var e=i.rangeInfos;var d=y.getSelection(i.win);var h=t(e),g=e.length;if(g==1&&f&&y.features.selectionHasExtend&&e[0].backward){d.removeAllRanges();d.addRange(h[0],true)}else{d.setRanges(h)}i.restored=true}}function x(d,e){var f=a(e,d);if(f){f.parentNode.removeChild(f)}}function v(g){var d=g.rangeInfos;for(var e=0,h=d.length,f;e<h;++e){f=d[e];if(f.collapsed){x(g.doc,f.markerId)}else{x(g.doc,f.startMarkerId);x(g.doc,f.endMarkerId)}}}y.util.extend(y,{saveRange:w,restoreRange:s,saveRanges:F,restoreRanges:t,saveSelection:A,restoreSelection:G,removeMarkerElement:x,removeMarkers:v})})},this);var Base=function(){};Base.extend=function(h,k){var j=Base.prototype.extend;Base._prototyping=true;var l=new this;j.call(l,h);l.base=function(){};delete Base._prototyping;var m=l.constructor;var i=l.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==i){this._constructing=true;m.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||j).call(arguments[0],l)}}}};i.ancestor=this;i.extend=this.extend;i.forEach=this.forEach;i.implement=this.implement;i.prototype=l;i.toString=this.toString;i.valueOf=function(a){return(a=="object")?i:m.valueOf()};j.call(i,k);if(typeof i.init=="function"){i.init()}return i};Base.prototype={extend:function(r,l){if(arguments.length>1){var o=this[r];if(o&&(typeof l=="function")&&(!o.valueOf||o.valueOf()!=l.valueOf())&&/\bbase\b/.test(l)){var s=l.valueOf();l=function(){var a=this.base||Base.prototype.base;this.base=o;var b=s.apply(this,arguments);this.base=a;return b};l.valueOf=function(a){return(a=="object")?l:s};l.toString=Base.toString}this[r]=l}else{if(r){var m=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){m=this.extend||m}var p={toSource:null};var n=["constructor","toString","valueOf"];var q=Base._prototyping?0:1;while(i=n[q++]){if(r[i]!=p[i]){m.call(this,i,r[i])}}for(var i in r){if(!p[i]){m.call(this,i,r[i])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(g,h,i){for(var f in g){if(this.prototype[f]===undefined){h.call(i,g[f],f,g)}}},implement:function(){for(var b=0;b<arguments.length;b++){if(typeof arguments[b]=="function"){arguments[b](this.prototype)}else{this.prototype.extend(arguments[b])}}return this},toString:function(){return String(this.valueOf())}});wysihtml5.browser=(function(){var k=navigator.userAgent,p=document.createElement("div"),r=k.indexOf("Gecko")!==-1&&k.indexOf("KHTML")===-1,n=k.indexOf("AppleWebKit/")!==-1,s=k.indexOf("Chrome/")!==-1,q=k.indexOf("Opera/")!==-1;function l(a){return +((/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/))||[undefined,0])[1]}function m(a){return +(a.match(/android (\d+)/)||[undefined,0])[1]}function o(d,b){var e=-1,a;if(navigator.appName=="Microsoft Internet Explorer"){a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})")}else{if(navigator.appName=="Netscape"){a=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")}}if(a&&a.exec(navigator.userAgent)!=null){e=parseFloat(RegExp.$1)}if(e===-1){return false}if(!d){return true}if(!b){return d===e}if(b==="<"){return d<e}if(b===">"){return d>e}if(b==="<="){return d<=e}if(b===">="){return d>=e}}return{USER_AGENT:k,supported:function(){var a=this.USER_AGENT.toLowerCase(),e="contentEditable" in p,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,b=document.querySelector&&document.querySelectorAll,f=(this.isIos()&&l(a)<5)||(this.isAndroid()&&m(a)<4)||a.indexOf("opera mobi")!==-1||a.indexOf("hpwos/")!==-1;return e&&d&&b&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return(/ipad|iphone|ipod/i).test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return o()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return o()},hasCurrentStyleProperty:function(){return"currentStyle" in p},hasHistoryIssue:function(){return r&&navigator.platform.substr(0,3)==="Mac"},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(a){return"placeholder" in a},supportsEvent:function(a){return"on"+a in p||(function(){p.setAttribute("on"+a,"return;");return typeof(p["on"+a])==="function"})()},supportsEventsInIframeCorrectly:function(){return !q},supportsHTML5Tags:function(a){var b=a.createElement("div"),d="<article>foo</article>";b.innerHTML=d;return b.innerHTML.toLowerCase()===d},supportsCommand:(function(){var a={formatBlock:o(10,"<="),insertUnorderedList:o(),insertOrderedList:o()};var b={insertHTML:r};return function(h,f){var e=a[f];if(!e){try{return h.queryCommandSupported(f)}catch(g){}try{return h.queryCommandEnabled(f)}catch(d){return !!b[f]}}return false}})(),doesAutoLinkingInContentEditable:function(){return o()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||q||n},supportsGetAttributeCorrectly:function(){var a=document.createElement("td");return a.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return r||o()||q},autoScrollsToCaret:function(){return !n},autoClosesUnclosedTags:function(){var a=p.cloneNode(false),d,b;a.innerHTML="<p><div></div>";b=a.innerHTML.toLowerCase();d=b==="<p></p><div></div>"||b==="<p><div></div></p>";this.autoClosesUnclosedTags=function(){return d};return d},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},needsSpaceAfterLineBreak:function(){return q},supportsSpeechApiOn:function(b){var a=k.match(/Chrome\/(\d+)/)||[undefined,0];return a[1]>=11&&("onwebkitspeechchange" in b||"speech" in b)},crashesWhenDefineProperty:function(a){return o(9)&&(a==="XMLHttpRequest"||a==="XDomainRequest")},doesAsyncFocus:function(){return o()},hasProblemsSettingCaretAfterImg:function(){return o()},hasUndoInContextMenu:function(){return r||s||q},hasInsertNodeIssue:function(){return q},hasIframeFocusIssue:function(){return o()},createsNestedInvalidMarkupAfterPaste:function(){return n},supportsMutationEvents:function(){return("MutationEvent" in window)},supportsModenPaste:function(){return !("clipboardData" in window)}}})();wysihtml5.lang.array=function(b){return{contains:function(e){if(Array.isArray(e)){for(var a=e.length;a--;){if(wysihtml5.lang.array(b).indexOf(e[a])!==-1){return true}}return false}else{return wysihtml5.lang.array(b).indexOf(e)!==-1}},indexOf:function(f){if(b.indexOf){return b.indexOf(f)}else{for(var a=0,g=b.length;a<g;a++){if(b[a]===f){return a}}return -1}},without:function(a){a=wysihtml5.lang.array(a);var h=[],i=0,g=b.length;for(;i<g;i++){if(!a.contains(b[i])){h.push(b[i])}}return h},get:function(){var g=0,f=b.length,a=[];for(;g<f;g++){a.push(b[g])}return a},map:function(h,j){if(Array.prototype.map){return b.map(h,j)}else{var k=b.length>>>0,a=new Array(k),i=0;for(;i<k;i++){a[i]=h.call(j,b[i],i,b)}return a}},unique:function(){var f=[],g=b.length,a=0;while(a<g){if(!wysihtml5.lang.array(f).contains(b[a])){f.push(b[a])}a++}return f}}};wysihtml5.lang.Dispatcher=Base.extend({on:function(e,d){this.events=this.events||{};this.events[e]=this.events[e]||[];this.events[e].push(d);return this},off:function(g,j){this.events=this.events||{};var k=0,h,i;if(g){h=this.events[g]||[],i=[];for(;k<h.length;k++){if(h[k]!==j&&j){i.push(h[k])}}this.events[g]=i}else{this.events={}}return this},fire:function(f,h){this.events=this.events||{};var g=this.events[f]||[],i=0;for(;i<g.length;i++){g[i].call(this,h)}return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}});wysihtml5.lang.object=function(b){return{merge:function(a){for(var e in a){b[e]=a[e]}return this},get:function(){return b},clone:function(a){var g={},f;if(b===null||!wysihtml5.lang.object(b).isPlainObject()){return b}for(f in b){if(b.hasOwnProperty(f)){if(a){g[f]=wysihtml5.lang.object(b[f]).clone(a)}else{g[f]=b[f]}}}return g},isArray:function(){return Object.prototype.toString.call(b)==="[object Array]"},isFunction:function(){return Object.prototype.toString.call(b)==="[object Function]"},isPlainObject:function(){return Object.prototype.toString.call(b)==="[object Object]"}}};(function(){var h=/^\s+/,i=/\s+$/,g=/[&<>\t"]/g,f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml5.lang.string=function(a){a=String(a);return{trim:function(){return a.replace(h,"").replace(i,"")},interpolate:function(b){for(var d in b){a=this.replace("#{"+d+"}").by(b[d])}return a},replace:function(b){return{by:function(d){return a.split(b).join(d)}}},escapeHTML:function(e,b){var d=a.replace(g,function(k){return f[k]});if(e){d=d.replace(/(?:\r\n|\r|\n)/g,"<br />")}if(b){d=d.replace(/  /gi,"&nbsp; ")}return d}}}})();(function(n){var p=n.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),o=/((https?:\/\/|www\.)[^\s<]{3,})/gi,u=/([^\w\/\-](,?))$/i,w=100,t={")":"(","]":"[","}":"{"};function x(b,a){if(q(b,a)){return b}if(b===b.ownerDocument.documentElement){b=b.ownerDocument.body}return y(b,a)}function s(a){return a.replace(o,function(f,g){var d=(g.match(u)||[])[1]||"",h=t[d];g=g.replace(u,"");if(g.split(h).length>g.split(d).length){g=g+d;d=""}var e=g,b=g;if(g.length>w){b=b.substr(0,w)+"..."}if(e.substr(0,4)==="www."){e="http://"+e}return'<a href="'+e+'">'+b+"</a>"+d})}function v(a){var b=a._wysihtml5_tempElement;if(!b){b=a._wysihtml5_tempElement=a.createElement("div")}return b}function r(a){var d=a.parentNode,b=n.lang.string(a.data).escapeHTML(),e=v(d.ownerDocument);e.innerHTML="<span></span>"+s(b);e.removeChild(e.firstChild);while(e.firstChild){d.insertBefore(e.firstChild,a)}d.removeChild(a)}function q(d,a){var b;while(d.parentNode){d=d.parentNode;b=d.nodeName;if(d.className&&n.lang.array(d.className.split(" ")).contains(a)){return true}if(p.contains(b)){return true}else{if(b==="body"){return false}}}return false}function y(e,a){if(p.contains(e.nodeName)){return}if(e.className&&n.lang.array(e.className.split(" ")).contains(a)){return}if(e.nodeType===n.TEXT_NODE&&e.data.match(o)){r(e);return}var b=n.lang.array(e.childNodes).get(),d=b.length,f=0;for(;f<d;f++){y(b[f],a)}return e}n.dom.autoLink=x;n.dom.autoLink.URL_REG_EXP=o})(wysihtml5);(function(d){var e=d.dom;e.addClass=function(g,b){var a=g.classList;if(a){return a.add(b)}if(e.hasClass(g,b)){return}g.className+=" "+b};e.removeClass=function(g,b){var a=g.classList;if(a){return a.remove(b)}g.className=g.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};e.hasClass=function(i,h){var a=i.classList;if(a){return a.contains(h)}var b=i.className;return(b.length>0&&(b==h||new RegExp("(^|\\s)"+h+"(\\s|$)").test(b)))}})(wysihtml5);wysihtml5.dom.contains=(function(){var b=document.documentElement;if(b.contains){return function(a,e){if(e.nodeType!==wysihtml5.ELEMENT_NODE){e=e.parentNode}return a!==e&&a.contains(e)}}else{if(b.compareDocumentPosition){return function(a,e){return !!(a.compareDocumentPosition(e)&16)}}}})();wysihtml5.dom.convertToList=(function(){function e(a,b){var d=a.createElement("li");b.appendChild(d);return d}function g(a,b){return a.createElement(b)}function f(B,d,A){if(B.nodeName==="UL"||B.nodeName==="OL"||B.nodeName==="MENU"){return B}var a=B.ownerDocument,w=g(a,d),v=B.querySelectorAll("br"),x=v.length,F,G,D,i,y,E,z,b,C;for(C=0;C<x;C++){i=v[C];while((y=i.parentNode)&&y!==B&&y.lastChild===i){if(wysihtml5.dom.getStyle("display").from(y)==="block"){y.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}}F=wysihtml5.lang.array(B.childNodes).get();G=F.length;for(C=0;C<G;C++){b=b||e(a,w);D=F[C];E=wysihtml5.dom.getStyle("display").from(D)==="block";z=D.nodeName==="BR";if(E&&(!A||!wysihtml5.dom.hasClass(D,A))){b=b.firstChild?e(a,w):b;b.appendChild(D);b=null;continue}if(z){b=b.firstChild?null:b;continue}b.appendChild(D)}if(F.length===0){e(a,w)}B.parentNode.replaceChild(w,B);return w}return f})();wysihtml5.dom.copyAttributes=function(b){return{from:function(a){return{to:function(k){var h,j=0,i=b.length;for(;j<i;j++){h=b[j];if(typeof(a[h])!=="undefined"&&a[h]!==""){k[h]=a[h]}}return{andTo:arguments.callee}}}}}};(function(f){var h=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];var i=function(a){if(g(a)){return parseInt(f.getStyle("width").from(a),10)<a.offsetWidth}return false};var g=function(b){var d=0,a=h.length;for(;d<a;d++){if(f.getStyle(h[d]).from(b)==="border-box"){return h[d]}}};f.copyStyles=function(a){return{from:function(m){if(i(m)){a=wysihtml5.lang.array(a).without(h)}var e="",d=a.length,n=0,b;for(;n<d;n++){b=a[n];e+=b+":"+f.getStyle(b).from(m)+";"}return{to:function(j){f.setStyles(e).on(j);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);(function(b){b.dom.delegate=function(i,a,h,g){return b.dom.observe(i,h,function(e){var d=e.target,f=b.lang.array(i.querySelectorAll(a));while(d&&d!==i){if(f.contains(d)){g.call(d,e);break}d=d.parentNode}})}})(wysihtml5);(function(b){b.dom.domNode=function(g){var f=[b.ELEMENT_NODE,b.TEXT_NODE];var a=function(d){return d.nodeType===b.TEXT_NODE&&(/^\s*$/g).test(d.data)};return{prev:function(e){var i=g.previousSibling,d=(e&&e.nodeTypes)?e.nodeTypes:f;if(!i){return null}if((!b.lang.array(d).contains(i.nodeType))||(e&&e.ignoreBlankTexts&&a(i))){return b.dom.domNode(i).prev(e)}return i},next:function(e){var i=g.nextSibling,d=(e&&e.nodeTypes)?e.nodeTypes:f;if(!i){return null}if((!b.lang.array(d).contains(i.nodeType))||(e&&e.ignoreBlankTexts&&a(i))){return b.dom.domNode(i).next(e)}return i}}}})(wysihtml5);wysihtml5.dom.getAsDom=(function(){var f=function(b,d){var j=d.createElement("div");j.style.display="none";d.body.appendChild(j);try{j.innerHTML=b}catch(a){}d.body.removeChild(j);return j};var g=function(b){if(b._wysihtml5_supportsHTML5Tags){return}for(var d=0,a=e.length;d<a;d++){b.createElement(e[d])}b._wysihtml5_supportsHTML5Tags=true};var e=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(a,b){b=b||document;var d;if(typeof(a)==="object"&&a.nodeType){d=b.createElement("div");d.appendChild(a)}else{if(wysihtml5.browser.supportsHTML5Tags(b)){d=b.createElement("div");d.innerHTML=a}else{g(b);d=f(a,b)}}return d}})();wysihtml5.dom.getParentElement=(function(){function g(a,b){if(!b||!b.length){return true}if(typeof(b)==="string"){return a===b}else{return wysihtml5.lang.array(b).contains(a)}}function h(a){return a.nodeType===wysihtml5.ELEMENT_NODE}function i(e,d,b){var a=(e.className||"").match(b)||[];if(!d){return !!a.length}return a[a.length-1]===d}function f(d,a,e){var b=(d.getAttribute("style")||"").match(e)||[];if(!a){return !!b.length}return b[b.length-1]===a}return function(d,l,b,m){var e=(l.cssStyle||l.styleRegExp),a=(l.className||l.classRegExp);b=b||50;while(b--&&d&&d.nodeName!=="BODY"&&(!m||d!==m)){if(h(d)&&g(d.nodeName,l.nodeName)&&(!e||f(d,l.cssStyle,l.styleRegExp))&&(!a||i(d,l.className,l.classRegExp))){return d}d=d.parentNode}return null}})();wysihtml5.dom.getStyle=(function(){var e={"float":("styleFloat" in document.createElement("div").style)?"styleFloat":"cssFloat"},g=/\-[a-z]/g;function f(a){return a.replace(g,function(b){return b.charAt(1).toUpperCase()})}return function(a){return{from:function(u){if(u.nodeType!==wysihtml5.ELEMENT_NODE){return}var d=u.ownerDocument,t=e[a]||f(a),x=u.style,w=u.currentStyle,b=x[t];if(b){return b}if(w){try{return w[t]}catch(r){}}var s=d.defaultView||d.parentWindow,q=(a==="height"||a==="width")&&u.nodeName==="TEXTAREA",v,y;if(s.getComputedStyle){if(q){v=x.overflow;x.overflow="hidden"}y=s.getComputedStyle(u,null).getPropertyValue(a);if(q){x.overflow=v||""}return y}}}}})();wysihtml5.dom.getTextNodes=function(g,f){var e=[];for(g=g.firstChild;g;g=g.nextSibling){if(g.nodeType==3){if(!f||!(/^\s*$/).test(g.innerText||g.textContent)){e.push(g)}}else{e=e.concat(wysihtml5.dom.getTextNodes(g,f))}}return e};wysihtml5.dom.hasElementWithTagName=(function(){var g={},e=1;function f(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=e++)}return function(b,d){var i=f(b)+":"+d,a=g[i];if(!a){a=g[i]=b.getElementsByTagName(d)}return a.length>0}})();(function(h){var i={},f=1;function g(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=f++)}h.dom.hasElementWithClassName=function(b,d){if(!h.browser.supportsNativeGetElementsByClassName()){return !!b.querySelector("."+d)}var e=g(b)+":"+d,a=i[e];if(!a){a=i[e]=b.getElementsByClassName(d)}return a.length>0}})(wysihtml5);wysihtml5.dom.insert=function(b){return{after:function(a){a.parentNode.insertBefore(b,a.nextSibling)},before:function(a){a.parentNode.insertBefore(b,a)},into:function(a){a.appendChild(b)}}};wysihtml5.dom.insertCSS=function(b){b=b.join("\n");return{into:function(g){var a=g.createElement("style");a.type="text/css";if(a.styleSheet){a.styleSheet.cssText=b}else{a.appendChild(g.createTextNode(b))}var h=g.querySelector("head link");if(h){h.parentNode.insertBefore(a,h);return}else{var i=g.querySelector("head");if(i){i.appendChild(a)}}}}};(function(b){b.dom.lineBreaks=function(g){function f(d){return d.nodeName==="BR"}function a(d){if(f(d)){return true}if(b.dom.getStyle("display").from(d)==="block"){return true}return false}return{add:function(k){var d=g.ownerDocument,e=b.dom.domNode(g).next({ignoreBlankTexts:true}),j=b.dom.domNode(g).prev({ignoreBlankTexts:true});if(e&&!a(e)){b.dom.insert(d.createElement("br")).after(g)}if(j&&!a(j)){b.dom.insert(d.createElement("br")).before(g)}},remove:function(i){var d=b.dom.domNode(g).next({ignoreBlankTexts:true}),e=b.dom.domNode(g).prev({ignoreBlankTexts:true});if(d&&f(d)){d.parentNode.removeChild(d)}if(e&&f(e)){e.parentNode.removeChild(e)}}}}})(wysihtml5);wysihtml5.dom.observe=function(o,k,n){k=typeof(k)==="string"?[k]:k;var l,j,i=0,m=k.length;for(;i<m;i++){j=k[i];if(o.addEventListener){o.addEventListener(j,n,false)}else{l=function(a){if(!("target" in a)){a.target=a.srcElement}a.preventDefault=a.preventDefault||function(){this.returnValue=false};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=true};n.call(o,a)};o.attachEvent("on"+j,l)}}return{stop:function(){var d,b=0,a=k.length;for(;b<a;b++){d=k[b];if(o.removeEventListener){o.removeEventListener(d,n,false)}else{o.detachEvent("on"+d,l)}}}}};wysihtml5.dom.parse=function(P,L){var Q={"1":T,"3":U,"8":V},ac="span",K=/\s+/,R={tags:{},classes:{}},aa={};function O(h,k){wysihtml5.lang.object(aa).merge(R).merge(k.rules).get();var b=k.context||h.ownerDocument||document,i=b.createDocumentFragment(),a=typeof(h)==="string",f=false,j,e,g;if(k.clearInternals===true){f=true}if(a){j=wysihtml5.dom.getAsDom(h,b)}else{j=h}if(aa.selectors){F(j,aa.selectors)}while(j.firstChild){g=j.firstChild;e=D(g,k.cleanUp,f,k.uneditableClass);if(e){i.appendChild(e)}if(g!==e){j.removeChild(g)}}if(k.unjoinNbsps){var d=wysihtml5.dom.getTextNodes(i);for(var l=d.length;l--;){d[l].nodeValue=d[l].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ")}}j.innerHTML="";j.appendChild(i);return a?wysihtml5.quirks.getCorrectInnerHTML(j):j}function D(m,a,f,k){var e=m.nodeType,g=m.childNodes,h=g.length,b=Q[e],l=0,i,d,j;if(k&&e===1&&wysihtml5.dom.hasClass(m,k)){return m}d=b&&b(m,f);if(!d){if(d===false){i=m.ownerDocument.createDocumentFragment();for(l=h;l--;){if(g[l]){j=D(g[l],a,f,k);if(j){if(g[l]===j){l--}i.insertBefore(j,i.firstChild)}}}if(wysihtml5.dom.getStyle("display").from(m)==="block"){i.appendChild(m.ownerDocument.createElement("br"))}if(wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(m.nodeName.toLowerCase())&&m.parentNode.lastChild!==m){if(!m.nextSibling||m.nextSibling.nodeType!==3||!(/^\s/).test(m.nextSibling.nodeValue)){i.appendChild(m.ownerDocument.createTextNode(" "))}}if(i.normalize){i.normalize()}return i}else{return null}}for(l=0;l<h;l++){if(g[l]){j=D(g[l],a,f,k);if(j){if(g[l]===j){l--}d.appendChild(j)}}}if(a&&d.nodeName.toLowerCase()===ac&&(!d.childNodes.length||((/^\s*$/gi).test(d.innerHTML)&&(f||(m.className!=="_wysihtml5-temp-placeholder"&&m.className!=="rangySelectionBoundary")))||!d.attributes.length)){i=d.ownerDocument.createDocumentFragment();while(d.firstChild){i.appendChild(d.firstChild)}if(i.normalize){i.normalize()}return i}if(d.normalize){d.normalize()}return d}function F(e,b){var d,a,f;for(d in b){if(b.hasOwnProperty(d)){if(wysihtml5.lang.object(b[d]).isFunction()){a=b[d]}else{if(typeof(b[d])==="string"&&W[b[d]]){a=W[b[d]]}}f=e.querySelectorAll(d);for(var g=f.length;g--;){a(f[g])}}}}function T(d,a){var e,g,h=aa.tags,b=d.nodeName.toLowerCase(),i=d.scopeName,f;if(d._wysihtml5){return null}d._wysihtml5=1;if(d.className==="wysihtml5-temp"){return null}if(i&&i!="HTML"){b=i+":"+b}if("outerHTML" in d){if(!wysihtml5.browser.autoClosesUnclosedTags()&&d.nodeName==="P"&&d.outerHTML.slice(-4).toLowerCase()!=="</p>"){b="div"}}if(b in h){e=h[b];if(!e||e.remove){return null}else{if(e.unwrap){return false}}e=typeof(e)==="string"?{rename_tag:e}:e}else{if(d.firstChild){e={rename_tag:ac}}else{return null}}if(e.one_of_type&&!M(d,aa,e.one_of_type,a)){if(e.remove_action){if(e.remove_action==="unwrap"){return false}else{if(e.remove_action==="rename"){f=e.remove_action_rename_to||ac}else{return null}}}else{return null}}g=d.ownerDocument.createElement(f||e.rename_tag||b);Y(d,g,e,a);G(d,g,e);d=null;if(g.normalize){g.normalize()}return g}function M(d,b,f,a){var g,e;if(d.nodeName==="SPAN"&&!a&&(d.className==="_wysihtml5-temp-placeholder"||d.className==="rangySelectionBoundary")){return true}for(e in f){if(f.hasOwnProperty(e)&&b.type_definitions&&b.type_definitions[e]){g=b.type_definitions[e];if(J(d,g)){return true}}}return false}function X(d,a){var b=d.length;while(b--){if(d[b]===a){return true}}return false}function J(l,o){var g=l.getAttribute("class"),a=l.getAttribute("style"),h,d,f,e,i,k,m;if(o.methods){for(var n in o.methods){if(o.methods.hasOwnProperty(n)&&I[n]){if(I[n](l)){return true}}}}if(g&&o.classes){g=g.replace(/^\s+/g,"").replace(/\s+$/g,"").split(K);h=g.length;for(var j=0;j<h;j++){if(o.classes[g[j]]){return true}}}if(a&&o.styles){a=a.split(";");for(d in o.styles){if(o.styles.hasOwnProperty(d)){for(var b=a.length;b--;){m=a[b].split(":");if(m[0].replace(/\s/g,"").toLowerCase()===d){if(o.styles[d]===true||o.styles[d]===1||wysihtml5.lang.array(o.styles[d]).contains(m[1].replace(/\s/g,"").toLowerCase())){return true}}}}}}if(o.attrs){for(e in o.attrs){if(o.attrs.hasOwnProperty(e)){i=wysihtml5.dom.getAttribute(l,e);if(typeof(i)==="string"){if(i.search(o.attrs[e])>-1){return true}}}}}return false}function G(a,e,b){var d,f;if(b&&b.keep_styles){for(d in b.keep_styles){if(b.keep_styles.hasOwnProperty(d)){f=(d==="float")?a.style.styleFloat||a.style.cssFloat:a.style[d];if(b.keep_styles[d] instanceof RegExp&&!(b.keep_styles[d].test(f))){continue}if(d==="float"){e.style[(a.style.styleFloat)?"styleFloat":"cssFloat"]=f}else{if(a.style[d]){e.style[d]=f}}}}}}function C(a,b){var d=[];for(var e in b){if(b.hasOwnProperty(e)&&e.indexOf(a)===0){d.push(e)}}return d}function ab(f,e,g,a){var b=E[g],d;if(b){if(e||(f==="alt"&&a=="IMG")){d=b(e);if(typeof(d)==="string"){return d}}}return false}function H(a,l){var d=wysihtml5.lang.object(aa.attributes||{}).clone(),e=wysihtml5.lang.object(d).merge(wysihtml5.lang.object(l||{}).clone()).get(),j={},h=wysihtml5.dom.getAttributes(a),g,b,f;for(g in e){if((/\*$/).test(g)){f=C(g.slice(0,-1),h);for(var i=0,k=f.length;i<k;i++){b=ab(f[i],h[f[i]],e[g],a.nodeName);if(b!==false){j[f[i]]=b}}}else{b=ab(g,h[g],e[g],a.nodeName);if(b!==false){j[g]=b}}}return j}function Y(k,w,s,j){var p={},b=s.set_class,m=s.add_class,h=s.add_style,f=s.set_attributes,t=aa.classes,g=0,d=[],o=[],a=[],i=[],r,n,u,q,l,v;if(f){p=wysihtml5.lang.object(f).clone()}p=wysihtml5.lang.object(p).merge(H(k,s.check_attributes)).get();if(b){d.push(b)}if(m){for(l in m){v=N[m[l]];if(!v){continue}q=v(wysihtml5.dom.getAttribute(k,l));if(typeof(q)==="string"){d.push(q)}}}if(h){for(l in h){v=S[h[l]];if(!v){continue}newStyle=v(wysihtml5.dom.getAttribute(k,l));if(typeof(newStyle)==="string"){o.push(newStyle)}}}if(typeof(t)==="string"&&t==="any"&&k.getAttribute("class")){if(aa.classes_blacklist){i=k.getAttribute("class");if(i){d=d.concat(i.split(K))}r=d.length;for(;g<r;g++){u=d[g];if(!aa.classes_blacklist[u]){a.push(u)}}if(a.length){p["class"]=wysihtml5.lang.array(a).unique().join(" ")}}else{p["class"]=k.getAttribute("class")}}else{if(!j){t["_wysihtml5-temp-placeholder"]=1;t._rangySelectionBoundary=1;t["wysiwyg-tmp-selected-cell"]=1}i=k.getAttribute("class");if(i){d=d.concat(i.split(K))}r=d.length;for(;g<r;g++){u=d[g];if(t[u]){a.push(u)}}if(a.length){p["class"]=wysihtml5.lang.array(a).unique().join(" ")}}if(p["class"]&&j){p["class"]=p["class"].replace("wysiwyg-tmp-selected-cell","");if((/^\s*$/g).test(p["class"])){delete p["class"]}}if(o.length){p.style=wysihtml5.lang.array(o).unique().join(" ")}for(l in p){try{w.setAttribute(l,p[l])}catch(e){}}if(p.src){if(typeof(p.width)!=="undefined"){w.setAttribute("width",p.width)}if(typeof(p.height)!=="undefined"){w.setAttribute("height",p.height)}}}var Z=/\uFEFF/g;function U(a){var b=a.nextSibling;if(b&&b.nodeType===wysihtml5.TEXT_NODE){b.data=a.data.replace(Z,"")+b.data.replace(Z,"")}else{var d=a.data.replace(Z,"");return a.ownerDocument.createTextNode(d)}}function V(a){if(aa.comments){return a.ownerDocument.createComment(a.nodeValue)}}var E={url:(function(){var a=/^https?:\/\//i;return function(b){if(!b||!b.match(a)){return null}return b.replace(a,function(d){return d.toLowerCase()})}})(),src:(function(){var a=/^(\/|https?:\/\/)/i;return function(b){if(!b||!b.match(a)){return null}return b.replace(a,function(d){return d.toLowerCase()})}})(),href:(function(){var a=/^(#|\/|https?:\/\/|mailto:)/i;return function(b){if(!b||!b.match(a)){return null}return b.replace(a,function(d){return d.toLowerCase()})}})(),alt:(function(){var a=/[^ a-z0-9_\-]/gi;return function(b){if(!b){return""}return b.replace(a,"")}})(),numbers:(function(){var a=/\D/g;return function(b){b=(b||"").replace(a,"");return b||null}})(),any:(function(){return function(a){return a}})()};var S={align_text:(function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[String(b).toLowerCase()]}})(),};var N={align_img:(function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}})(),align_text:(function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}})(),clear_br:(function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}})(),size_font:(function(){var a={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}})()};var I={has_visible_contet:(function(){var b,d=false,a=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(e){b=(e.innerText||e.textContent).replace(/\s/g,"");if(b&&b.length>0){return true}for(var f=a.length;f--;){if(e.querySelector(a[f])){return true}}if(e.offsetWidth&&e.offsetWidth>0&&e.offsetHeight&&e.offsetHeight>0){return true}return false}})()};var W={unwrap:function(a){wysihtml5.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return O(P,L)};wysihtml5.dom.removeEmptyTextNodes=function(k){var g,i=wysihtml5.lang.array(k.childNodes).get(),j=i.length,h=0;for(;h<j;h++){g=i[h];if(g.nodeType===wysihtml5.TEXT_NODE&&g.data===""){g.parentNode.removeChild(g)}}};wysihtml5.dom.renameElement=function(g,f){var h=g.ownerDocument.createElement(f),i;while(i=g.firstChild){h.appendChild(i)}wysihtml5.dom.copyAttributes(["align","className"]).from(g).to(h);g.parentNode.replaceChild(h,g);return h};wysihtml5.dom.replaceWithChildNodes=function(d){if(!d.parentNode){return}if(!d.firstChild){d.parentNode.removeChild(d);return}var e=d.ownerDocument.createDocumentFragment();while(d.firstChild){e.appendChild(d.firstChild)}d.parentNode.replaceChild(e,d);d=e=null};(function(i){function k(a){return i.getStyle("display").from(a)==="block"}function j(a){return a.nodeName==="BR"}function g(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function h(f,b){if(!f.nodeName.match(/^(MENU|UL|OL)$/)){return}var a=f.ownerDocument,e=a.createDocumentFragment(),v=wysihtml5.dom.domNode(f).prev({ignoreBlankTexts:true}),d,u,t,s,r,w;if(b){if(v&&!k(v)&&!j(v)){g(e)}while(w=(f.firstElementChild||f.firstChild)){u=w.lastChild;while(d=w.firstChild){t=d===u;s=t&&!k(d)&&!j(d);e.appendChild(d);if(s){g(e)}}w.parentNode.removeChild(w)}}else{while(w=(f.firstElementChild||f.firstChild)){if(w.querySelector&&w.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6")){while(d=w.firstChild){e.appendChild(d)}}else{r=a.createElement("p");while(d=w.firstChild){r.appendChild(d)}e.appendChild(r)}w.parentNode.removeChild(w)}}f.parentNode.replaceChild(e,f)}i.resolveList=h})(wysihtml5.dom);(function(i){var j=document,k=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],g=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],h=["referrer","write","open","close"];i.dom.Sandbox=Base.extend({constructor:function(a,b){this.callback=a||i.EMPTY_FUNCTION;this.config=i.lang.object({}).merge(b).get();this.editableArea=this._createIframe()},insertInto:function(a){if(typeof(a)==="string"){a=j.getElementById(a)}a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var a=this,b=j.createElement("iframe");b.className="wysihtml5-sandbox";i.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(b);if(i.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()){b.src="javascript:'<html></html>'"}b.onload=function(){b.onreadystatechange=b.onload=null;a._onLoadIframe(b)};b.onreadystatechange=function(){if(/loaded|complete/.test(b.readyState)){b.onreadystatechange=b.onload=null;a._onLoadIframe(b)}};return b},_onLoadIframe:function(e){if(!i.dom.contains(j.documentElement,e)){return}var a=this,p=e.contentWindow,r=e.contentWindow.document,q=j.characterSet||j.charset||"utf-8",b=this._getHtml({charset:q,stylesheets:this.config.stylesheets});r.open("text/html","replace");r.write(b);r.close();this.getWindow=function(){return e.contentWindow};this.getDocument=function(){return e.contentWindow.document};p.onerror=function(n,m,l){throw new Error("wysihtml5.Sandbox: "+n,m,l)};if(!i.browser.supportsSandboxedIframes()){var f,d;for(f=0,d=k.length;f<d;f++){this._unset(p,k[f])}for(f=0,d=g.length;f<d;f++){this._unset(p,g[f],i.EMPTY_FUNCTION)}for(f=0,d=h.length;f<d;f++){this._unset(r,h[f])}this._unset(r,"cookie","",true)}this.loaded=true;setTimeout(function(){a.callback(a)},0)},_getHtml:function(b){var a=b.stylesheets,e="",f=0,d;a=typeof(a)==="string"?[a]:a;if(a){d=a.length;for(;f<d;f++){e+='<link rel="stylesheet" href="'+a[f]+'">'}}b.stylesheets=e;return i.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(f,d,e,a){try{f[d]=e}catch(b){}try{f.__defineGetter__(d,function(){return e})}catch(b){}if(a){try{f.__defineSetter__(d,function(){})}catch(b){}}if(!i.browser.crashesWhenDefineProperty(d)){try{var m={get:function(){return e}};if(a){m.set=function(){}}Object.defineProperty(f,d,m)}catch(b){}}}})})(wysihtml5);(function(d){var e=document;d.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(a,g,b){this.callback=a||d.EMPTY_FUNCTION;this.config=d.lang.object({}).merge(g).get();if(b){this.element=this._bindElement(b)}else{this.element=this._createElement()}},_createElement:function(){var a=e.createElement("div");a.className="wysihtml5-sandbox";this._loadElement(a);return a},_bindElement:function(a){a.className=(a.className&&a.className!="")?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox";this._loadElement(a,true);return a},_loadElement:function(h,i){var a=this;if(!i){var b=this._getHtml();h.innerHTML=b}this.getWindow=function(){return h.ownerDocument.defaultView};this.getDocument=function(){return h.ownerDocument};this.loaded=true;setTimeout(function(){a.callback(a)},0)},_getHtml:function(a){return""}})})(wysihtml5);(function(){var b={className:"class"};wysihtml5.dom.setAttributes=function(a){return{on:function(f){for(var g in a){f.setAttribute(b[g]||g,a[g])}}}}})();wysihtml5.dom.setStyles=function(b){return{on:function(g){var f=g.style;if(typeof(b)==="string"){f.cssText+=";"+b;return}for(var a in b){if(a==="float"){f.cssFloat=b[a];f.styleFloat=b[a]}else{f[a]=b[a]}}}}};(function(b){b.simulatePlaceholder=function(l,a,m){var k="placeholder",j=function(){var d=a.element.offsetWidth>0&&a.element.offsetHeight>0;if(a.hasPlaceholderSet()){a.clear();a.element.focus();if(d){setTimeout(function(){var e=a.selection.getSelection();if(!e.focusNode||!e.anchorNode){a.selection.selectNode(a.element.firstChild||a.element)}},0)}}a.placeholderSet=false;b.removeClass(a.element,k)},i=function(){if(a.isEmpty()){a.placeholderSet=true;a.setValue(m);b.addClass(a.element,k)}};l.on("set_placeholder",i).on("unset_placeholder",j).on("focus:composer",j).on("paste:composer",j).on("blur:composer",i);i()}})(wysihtml5.dom);(function(d){var e=document.documentElement;if("textContent" in e){d.setTextContent=function(b,a){b.textContent=a};d.getTextContent=function(a){return a.textContent}}else{if("innerText" in e){d.setTextContent=function(b,a){b.innerText=a};d.getTextContent=function(a){return a.innerText}}else{d.setTextContent=function(b,a){b.nodeValue=a};d.getTextContent=function(a){return a.nodeValue}}}})(wysihtml5.dom);wysihtml5.dom.getAttribute=function(m,h){var j=!wysihtml5.browser.supportsGetAttributeCorrectly();h=h.toLowerCase();var k=m.nodeName;if(k=="IMG"&&h=="src"&&wysihtml5.dom.isLoadedImage(m)===true){return m.src}else{if(j&&"outerHTML" in m){var l=m.outerHTML.toLowerCase(),i=l.indexOf(" "+h+"=")!=-1;return i?m.getAttribute(h):null}else{return m.getAttribute(h)}}};wysihtml5.dom.getAttributes=function(k){var i=!wysihtml5.browser.supportsGetAttributeCorrectly(),j=k.nodeName,g=[],h;for(h in k.attributes){if((k.attributes.hasOwnProperty&&k.attributes.hasOwnProperty(h))||(!k.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(k.attributes,h))){if(k.attributes[h].specified){if(j=="IMG"&&k.attributes[h].name.toLowerCase()=="src"&&wysihtml5.dom.isLoadedImage(k)===true){g.src=k.src}else{if(wysihtml5.lang.array(["rowspan","colspan"]).contains(k.attributes[h].name.toLowerCase())&&i){if(k.attributes[h].value!==1){g[k.attributes[h].name]=k.attributes[h].value}}else{g[k.attributes[h].name]=k.attributes[h].value}}}}}return g};wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(d){if(e.complete&&e.readyState==="complete"){return true}}};(function(l){var p=l.dom;var q=function(a){this.el=a;this.isColspan=false;this.isRowspan=false;this.firstCol=true;this.lastCol=true;this.firstRow=true;this.lastRow=true;this.isReal=true;this.spanCollection=[];this.modified=false};var n=function(b,a){if(b){this.cell=b;this.table=p.getParentElement(b,{nodeName:["TABLE"]})}else{if(a){this.table=a;this.cell=this.table.querySelectorAll("th, td")[0]}}};function m(g,h){var d=[],a;for(var f=0,e=g.length;f<e;f++){a=g[f].querySelectorAll(h);if(a){for(var b=a.length;b--;d.unshift(a[b])){}}}return d}function j(a){a.parentNode.removeChild(a)}function o(b,a){b.parentNode.insertBefore(a,b.nextSibling)}function k(a,d){var b=a.nextSibling;while(b.nodeType!=1){b=b.nextSibling;if(!d||d==b.tagName.toLowerCase()){return b}}return null}n.prototype={addSpannedCellToMap:function(a,h,i,b,g,v){var d=[],r=i+((v)?parseInt(v,10)-1:0),w=b+((g)?parseInt(g,10)-1:0);for(var e=i;e<=r;e++){if(typeof h[e]=="undefined"){h[e]=[]}for(var f=b;f<=w;f++){h[e][f]=new q(a);h[e][f].isColspan=(g&&parseInt(g,10)>1);h[e][f].isRowspan=(v&&parseInt(v,10)>1);h[e][f].firstCol=f==b;h[e][f].lastCol=f==w;h[e][f].firstRow=e==i;h[e][f].lastRow=e==r;h[e][f].isReal=f==b&&e==i;h[e][f].spanCollection=d;d.push(h[e][f])}}},setCellAsModified:function(d){d.modified=true;if(d.spanCollection.length>0){for(var b=0,a=d.spanCollection.length;b<a;b++){d.spanCollection[b].modified=true}}},setTableMap:function(){var i=[];var f=this.getTableRows(),t,a,b,u,e,g,h,d;for(t=0;t<f.length;t++){a=f[t];b=this.getRowCells(a);g=0;if(typeof i[t]=="undefined"){i[t]=[]}for(u=0;u<b.length;u++){e=b[u];while(typeof i[t][g]!="undefined"){g++}h=p.getAttribute(e,"colspan");d=p.getAttribute(e,"rowspan");if(h||d){this.addSpannedCellToMap(e,i,t,g,h,d);g=g+((h)?parseInt(h,10):1)}else{i[t][g]=new q(e);g++}}}this.map=i;return i},getRowCells:function(f){var d=this.table.querySelectorAll("table"),b=(d)?m(d,"th, td"):[],e=f.querySelectorAll("th, td"),a=(b.length>0)?l.lang.array(e).without(b):e;return a},getTableRows:function(){var b=this.table.querySelectorAll("table"),a=(b)?m(b,"tr"):[],d=this.table.querySelectorAll("tr"),e=(a.length>0)?l.lang.array(d).without(a):d;return e},getMapIndex:function(e){var b=this.map.length,f=(this.map&&this.map[0])?this.map[0].length:0;for(var a=0;a<b;a++){for(var d=0;d<f;d++){if(this.map[a][d].el===e){return{row:a,col:d}}}}return false},getElementAtIndex:function(a){this.setTableMap();if(this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el){return this.map[a.row][a.col].el}return null},getMapElsTo:function(g){var a=[];this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(g);if(this.idx_start.row>this.idx_end.row||(this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)){var i=this.idx_start;this.idx_start=this.idx_end;this.idx_end=i}if(this.idx_start.col>this.idx_end.col){var e=this.idx_start.col;this.idx_start.col=this.idx_end.col;this.idx_end.col=e}if(this.idx_start!=null&&this.idx_end!=null){for(var f=this.idx_start.row,b=this.idx_end.row;f<=b;f++){for(var d=this.idx_start.col,h=this.idx_end.col;d<=h;d++){a.push(this.map[f][d].el)}}}return a},orderSelectionEnds:function(b){this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(b);if(this.idx_start.row>this.idx_end.row||(this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)){var a=this.idx_start;this.idx_start=this.idx_end;this.idx_end=a}if(this.idx_start.col>this.idx_end.col){var d=this.idx_start.col;this.idx_start.col=this.idx_end.col;this.idx_end.col=d}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(b,h,a){var g=this.table.ownerDocument,f=g.createDocumentFragment(),d;for(var i=0;i<h;i++){d=g.createElement(b);if(a){for(var e in a){if(a.hasOwnProperty(e)){d.setAttribute(e,a[e])}}}d.appendChild(document.createTextNode("\u00a0"));f.appendChild(d)}return f},correctColIndexForUnreals:function(b,f){var g=this.map[f],d=-1;for(var a=0,e=b;a<b;a++){if(g[a].isReal){d++}}return d},getLastNewCellOnRow:function(f,g){var h=this.getRowCells(f),a,b;for(var d=0,e=h.length;d<e;d++){a=h[d];b=this.getMapIndex(a);if(b===false||(typeof g!="undefined"&&b.row!=g)){return a}}return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");if(!a||a.length==0){j(this.table);return true}else{return false}},splitRowToCells:function(e){if(e.isColspan){var a=parseInt(p.getAttribute(e.el,"colspan")||1,10),d=e.el.tagName.toLowerCase();if(a>1){var b=this.createCells(d,a-1);o(e.el,b)}e.el.removeAttribute("colspan")}},getRealRowEl:function(g,b){var a=null,f=null;b=b||this.idx;for(var d=0,e=this.map[b.row].length;d<e;d++){f=this.map[b.row][d];if(f.isReal){a=p.getParentElement(f.el,{nodeName:["TR"]});if(a){return a}}}if(a===null&&g){a=p.getParentElement(this.map[b.row][b.col].el,{nodeName:["TR"]})||null}return a},injectRowAt:function(a,g,h,e,b){var i=this.getRealRowEl(false,{row:a,col:g}),r=this.createCells(e,h);if(i){var d=this.correctColIndexForUnreals(g,a);if(d>=0){o(this.getRowCells(i)[d],r)}else{i.insertBefore(r,i.firstChild)}}else{var f=this.table.ownerDocument.createElement("tr");f.appendChild(r);o(p.getParentElement(b.el,{nodeName:["TR"]}),f)}},canMerge:function(f){this.to=f;this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(this.to);if(this.idx_start.row>this.idx_end.row||(this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)){var a=this.idx_start;this.idx_start=this.idx_end;this.idx_end=a}if(this.idx_start.col>this.idx_end.col){var e=this.idx_start.col;this.idx_start.col=this.idx_end.col;this.idx_end.col=e}for(var g=this.idx_start.row,b=this.idx_end.row;g<=b;g++){for(var d=this.idx_start.col,h=this.idx_end.col;d<=h;d++){if(this.map[g][d].isColspan||this.map[g][d].isRowspan){return false}}}return true},decreaseCellSpan:function(d,b){var a=parseInt(p.getAttribute(d.el,b),10)-1;if(a>=1){d.el.setAttribute(b,a)}else{d.el.removeAttribute(b);if(b=="colspan"){d.isColspan=false}if(b=="rowspan"){d.isRowspan=false}d.firstCol=true;d.lastCol=true;d.firstRow=true;d.lastRow=true;d.isReal=true}},removeSurplusLines:function(){var h,b,f,g,d,e,a;this.setTableMap();if(this.map){f=0;g=this.map.length;for(;f<g;f++){h=this.map[f];a=true;d=0;e=h.length;for(;d<e;d++){b=h[d];if(!(p.getAttribute(b.el,"rowspan")&&parseInt(p.getAttribute(b.el,"rowspan"),10)>1&&b.firstRow!==true)){a=false;break}}if(a){d=0;for(;d<e;d++){this.decreaseCellSpan(h[d],"rowspan")}}}var i=this.getTableRows();f=0;g=i.length;for(;f<g;f++){h=i[f];if(h.childNodes.length==0&&(/^\s*$/.test(h.textContent||h.innerText))){j(h)}}}},fillMissingCells:function(){var b=0,e=0,g=null;this.setTableMap();if(this.map){b=this.map.length;for(var f=0;f<b;f++){if(this.map[f].length>e){e=this.map[f].length}}for(var a=0;a<b;a++){for(var d=0;d<e;d++){if(this.map[a]&&!this.map[a][d]){if(d>0){this.map[a][d]=new q(this.createCells("td",1));g=this.map[a][d-1];if(g&&g.el&&g.el.parent){o(this.map[a][d-1].el,this.map[a][d].el)}}}}}}},rectify:function(){if(!this.removeEmptyTable()){this.removeSurplusLines();this.fillMissingCells();return true}else{return false}},unmerge:function(){if(this.rectify()){this.setTableMap();this.idx=this.getMapIndex(this.cell);if(this.idx){var g=this.map[this.idx.row][this.idx.col],f=(p.getAttribute(g.el,"colspan"))?parseInt(p.getAttribute(g.el,"colspan"),10):1,e=g.el.tagName.toLowerCase();if(g.isRowspan){var a=parseInt(p.getAttribute(g.el,"rowspan"),10);if(a>1){for(var b=1,d=a-1;b<=d;b++){this.injectRowAt(this.idx.row+b,this.idx.col,f,e,g)}}g.el.removeAttribute("rowspan")}this.splitRowToCells(g)}}},merge:function(f){if(this.rectify()){if(this.canMerge(f)){var a=this.idx_end.row-this.idx_start.row+1,g=this.idx_end.col-this.idx_start.col+1;for(var h=this.idx_start.row,d=this.idx_end.row;h<=d;h++){for(var e=this.idx_start.col,b=this.idx_end.col;e<=b;e++){if(h==this.idx_start.row&&e==this.idx_start.col){if(a>1){this.map[h][e].el.setAttribute("rowspan",a)}if(g>1){this.map[h][e].el.setAttribute("colspan",g)}}else{if(!(/^\s*<br\/?>\s*$/.test(this.map[h][e].el.innerHTML.toLowerCase()))){this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[h][e].el.innerHTML}j(this.map[h][e].el)}}}this.rectify()}else{if(window.console){console.log("Do not know how to merge allready merged cells.")}}}},collapseCellToNextRow:function(b){var h=this.getMapIndex(b.el),g=h.row+1,a={row:g,col:h.col};if(g<this.map.length){var f=this.getRealRowEl(false,a);if(f!==null){var d=this.correctColIndexForUnreals(a.col,a.row);if(d>=0){o(this.getRowCells(f)[d],b.el)}else{var e=this.getLastNewCellOnRow(f,g);if(e!==null){o(e,b.el)}else{f.insertBefore(b.el,f.firstChild)}}if(parseInt(p.getAttribute(b.el,"rowspan"),10)>2){b.el.setAttribute("rowspan",parseInt(p.getAttribute(b.el,"rowspan"),10)-1)}else{b.el.removeAttribute("rowspan")}}}},removeRowCell:function(a){if(a.isReal){if(a.isRowspan){this.collapseCellToNextRow(a)}else{j(a.el)}}else{if(parseInt(p.getAttribute(a.el,"rowspan"),10)>2){a.el.setAttribute("rowspan",parseInt(p.getAttribute(a.el,"rowspan"),10)-1)}else{a.el.removeAttribute("rowspan")}}},getRowElementsByCell:function(){var a=[];this.setTableMap();this.idx=this.getMapIndex(this.cell);if(this.idx!==false){var b=this.map[this.idx.row];for(var d=0,e=b.length;d<e;d++){if(b[d].isReal){a.push(b[d].el)}}}return a},getColumnElementsByCell:function(){var d=[];this.setTableMap();this.idx=this.getMapIndex(this.cell);if(this.idx!==false){for(var a=0,b=this.map.length;a<b;a++){if(this.map[a][this.idx.col]&&this.map[a][this.idx.col].isReal){d.push(this.map[a][this.idx.col].el)}}}return d},removeRow:function(){var a=p.getParentElement(this.cell,{nodeName:["TR"]});if(a){this.setTableMap();this.idx=this.getMapIndex(this.cell);if(this.idx!==false){var b=this.map[this.idx.row];for(var d=0,e=b.length;d<e;d++){if(!b[d].modified){this.setCellAsModified(b[d]);this.removeRowCell(b[d])}}}j(a)}},removeColCell:function(a){if(a.isColspan){if(parseInt(p.getAttribute(a.el,"colspan"),10)>2){a.el.setAttribute("colspan",parseInt(p.getAttribute(a.el,"colspan"),10)-1)}else{a.el.removeAttribute("colspan")}}else{if(a.isReal){j(a.el)}}},removeColumn:function(){this.setTableMap();this.idx=this.getMapIndex(this.cell);if(this.idx!==false){for(var a=0,b=this.map.length;a<b;a++){if(!this.map[a][this.idx.col].modified){this.setCellAsModified(this.map[a][this.idx.col]);this.removeColCell(this.map[a][this.idx.col])}}}},remove:function(a){if(this.rectify()){switch(a){case"row":this.removeRow();break;case"column":this.removeColumn();break}this.rectify()}},addRow:function(b){var h=this.table.ownerDocument;this.setTableMap();this.idx=this.getMapIndex(this.cell);if(b=="below"&&p.getAttribute(this.cell,"rowspan")){this.idx.row=this.idx.row+parseInt(p.getAttribute(this.cell,"rowspan"),10)-1}if(this.idx!==false){var e=this.map[this.idx.row],d=h.createElement("tr");for(var f=0,g=e.length;f<g;f++){if(!e[f].modified){this.setCellAsModified(e[f]);this.addRowCell(e[f],d,b)}}switch(b){case"below":o(this.getRealRowEl(true),d);break;case"above":var a=p.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});if(a){a.parentNode.insertBefore(d,a)}break}}},addRowCell:function(e,a,d){var b=(e.isColspan)?{colspan:p.getAttribute(e.el,"colspan")}:null;if(e.isReal){if(d!="above"&&e.isRowspan){e.el.setAttribute("rowspan",parseInt(p.getAttribute(e.el,"rowspan"),10)+1)}else{a.appendChild(this.createCells("td",1,b))}}else{if(d!="above"&&e.isRowspan&&e.lastRow){a.appendChild(this.createCells("td",1,b))}else{if(c.isRowspan){e.el.attr("rowspan",parseInt(p.getAttribute(e.el,"rowspan"),10)+1)}}}},add:function(a){if(this.rectify()){if(a=="below"||a=="above"){this.addRow(a)}if(a=="before"||a=="after"){this.addColumn(a)}}},addColCell:function(e,f,b){var a,d=e.el.tagName.toLowerCase();switch(b){case"before":a=(!e.isColspan||e.firstCol);break;case"after":a=(!e.isColspan||e.lastCol||(e.isColspan&&c.el==this.cell));break}if(a){switch(b){case"before":e.el.parentNode.insertBefore(this.createCells(d,1),e.el);break;case"after":o(e.el,this.createCells(d,1));break}if(e.isRowspan){this.handleCellAddWithRowspan(e,f+1,b)}}else{e.el.setAttribute("colspan",parseInt(p.getAttribute(e.el,"colspan"),10)+1)}},addColumn:function(e){var b,d;this.setTableMap();this.idx=this.getMapIndex(this.cell);if(e=="after"&&p.getAttribute(this.cell,"colspan")){this.idx.col=this.idx.col+parseInt(p.getAttribute(this.cell,"colspan"),10)-1}if(this.idx!==false){for(var f=0,a=this.map.length;f<a;f++){b=this.map[f];if(b[this.idx.col]){d=b[this.idx.col];if(!d.modified){this.setCellAsModified(d);this.addColCell(d,f,e)}}}}},handleCellAddWithRowspan:function(w,u,e){var b=parseInt(p.getAttribute(this.cell,"rowspan"),10)-1,i=p.getParentElement(w.el,{nodeName:["TR"]}),d=w.el.tagName.toLowerCase(),v,g,a=this.table.ownerDocument,h;for(var f=0;f<b;f++){v=this.correctColIndexForUnreals(this.idx.col,(u+f));i=k(i,"tr");if(i){if(v>0){switch(e){case"before":g=this.getRowCells(i);if(v>0&&this.map[u+f][this.idx.col].el!=g[v]&&v==g.length-1){o(g[v],this.createCells(d,1))}else{g[v].parentNode.insertBefore(this.createCells(d,1),g[v])}break;case"after":o(this.getRowCells(i)[v],this.createCells(d,1));break}}else{i.insertBefore(this.createCells(d,1),i.firstChild)}}else{h=a.createElement("tr");h.appendChild(this.createCells(d,1));this.table.appendChild(h)}}}};p.table={getCellsBetween:function(b,d){var a=new n(b);return a.getMapElsTo(d)},addCells:function(d,b){var a=new n(d);a.add(b)},removeCells:function(d,b){var a=new n(d);a.remove(b)},mergeCellsBetween:function(b,d){var a=new n(b);a.merge(d)},unmergeCell:function(b){var a=new n(b);a.unmerge()},orderSelectionEnds:function(d,b){var a=new n(d);return a.orderSelectionEnds(b)},indexOf:function(b){var a=new n(b);a.setTableMap();return a.getMapIndex(b)},findCell:function(b,d){var a=new n(null,b);return a.getElementAtIndex(d)},findRowByCell:function(b){var a=new n(b);return a.getRowElementsByCell()},findColumnByCell:function(b){var a=new n(b);return a.getColumnElementsByCell()},canMerge:function(b,d){var a=new n(b);return a.canMerge(d)}}})(wysihtml5);wysihtml5.dom.query=function(l,m){var e=[],n;if(l.nodeType){l=[l]}for(var k=0,i=l.length;k<i;k++){n=l[k].querySelectorAll(m);if(n){for(var o=n.length;o--;e.unshift(n[o])){}}}return e};wysihtml5.dom.compareDocumentPosition=(function(){var b=document.documentElement;if(b.compareDocumentPosition){return function(a,e){return a.compareDocumentPosition(e)}}else{return function(v,u){var r,q;if(v.nodeType===9){r=v}else{r=v.ownerDocument}if(u.nodeType===9){q=u}else{q=u.ownerDocument}if(v===u){return 0}if(v===u.ownerDocument){return 4+16}if(v.ownerDocument===u){return 2+8}if(r!==q){return 1}if(v.nodeType===2&&v.childNodes&&wysihtml5.lang.array(v.childNodes).indexOf(u)!==-1){return 4+16}if(u.nodeType===2&&u.childNodes&&wysihtml5.lang.array(u.childNodes).indexOf(v)!==-1){return 2+8}var n=v;var o=[];var s=null;while(n){if(n==u){return 2+8}o.push(n);n=n.parentNode}n=u;s=null;while(n){if(n==v){return 4+16}var a=wysihtml5.lang.array(o).indexOf(n);if(a!==-1){var t=o[a];var p=wysihtml5.lang.array(t.childNodes).indexOf(o[a-1]);var w=wysihtml5.lang.array(t.childNodes).indexOf(s);if(p>w){return 2}else{return 4}}s=n;n=n.parentNode}return 1}}})();wysihtml5.dom.unwrap=function(b){if(b.parentNode){while(b.lastChild){wysihtml5.dom.insert(b.lastChild).after(b)}b.parentNode.removeChild(b)}};wysihtml5.dom.getPastedHtml=function(d){var e;if(d.clipboardData){if(wysihtml5.lang.array(d.clipboardData.types).contains("text/html")){e=d.clipboardData.getData("text/html")}else{if(wysihtml5.lang.array(d.clipboardData.types).contains("text/plain")){e=wysihtml5.lang.string(d.clipboardData.getData("text/plain")).escapeHTML(true,true)}}}return e};wysihtml5.dom.getPastedHtmlWithDiv=function(f,k){var h=f.selection.getBookmark(),j=f.element.ownerDocument,i=j.createElement("DIV");j.body.appendChild(i);i.style.width="1px";i.style.height="1px";i.style.overflow="hidden";i.setAttribute("contenteditable","true");i.focus();setTimeout(function(){f.selection.setBookmark(h);k(i.innerHTML);i.parentNode.removeChild(i)},0)};wysihtml5.quirks.cleanPastedHTML=(function(){var g=function(a){var b=wysihtml5.lang.string(a).trim(),d=b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+d+"$).)*$","i")};var e=function(b,d){var a=wysihtml5.lang.object(b).clone(true),k,j;for(k in a.tags){if(a.tags.hasOwnProperty(k)){if(a.tags[k].keep_styles){for(j in a.tags[k].keep_styles){if(a.tags[k].keep_styles.hasOwnProperty(j)){if(d[j]){a.tags[k].keep_styles[j]=g(d[j])}}}}}}return a};var f=function(i,b){var a,l;if(!i){return null}for(var d=0,m=i.length;d<m;d++){if(!i[d].condition){l=i[d].set}if(i[d].condition&&i[d].condition.test(b)){return i[d].set}}return l};return function(d,j){var b={color:wysihtml5.dom.getStyle("color").from(j.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(j.referenceNode)},a=e(f(j.rules,d)||{},b),k;k=wysihtml5.dom.parse(d,{rules:a,cleanUp:true,context:j.referenceNode.ownerDocument,uneditableClass:j.uneditableClass,clearInternals:true,unjoinNbsps:true});return k}})();wysihtml5.quirks.ensureProperClearing=(function(){var b=function(){var a=this;setTimeout(function(){var e=a.innerHTML.toLowerCase();if(e=="<p>&nbsp;</p>"||e=="<p>&nbsp;</p><p>&nbsp;</p>"){a.innerHTML=""}},0)};return function(a){wysihtml5.dom.observe(a.element,["cut","keydown"],b)}})();(function(d){var e="%7E";d.quirks.getCorrectInnerHTML=function(m){var a=m.innerHTML;if(a.indexOf(e)===-1){return a}var i=m.querySelectorAll("[href*='~'], [src*='~']"),o,b,l,n;for(n=0,l=i.length;n<l;n++){o=i[n].href||i[n].src;b=d.lang.string(o).replace("~").by(e);a=d.lang.string(a).replace(b).by(o)}return a}})(wysihtml5);(function(d){var e="wysihtml5-quirks-redraw";d.quirks.redraw=function(h){d.dom.addClass(h,e);d.dom.removeClass(h,e);try{var a=h.ownerDocument;a.execCommand("italic",false,null);a.execCommand("italic",false,null)}catch(b){}}})(wysihtml5);wysihtml5.quirks.tableCellsSelection=function(C,w){var A=wysihtml5.dom,t={table:null,start:null,end:null,cells:null,select:D},y="wysiwyg-tmp-selected-cell",x=null,E=null;function q(){A.observe(C,"mousedown",function(b){var a=wysihtml5.dom.getParentElement(b.target,{nodeName:["TD","TH"]});if(a){v(a)}});return t}function v(a){t.start=a;t.end=a;t.cells=[a];t.table=A.getParentElement(t.start,{nodeName:["TABLE"]});if(t.table){r();A.addClass(a,y);x=A.observe(C,"mousemove",z);E=A.observe(C,"mouseup",s);w.fire("tableselectstart").fire("tableselectstart:composer")}}function r(){if(C){var b=C.querySelectorAll("."+y);if(b.length>0){for(var a=0;a<b.length;a++){A.removeClass(b[a],y)}}}}function B(b){for(var a=0;a<b.length;a++){A.addClass(b[a],y)}}function z(b){var a=null,e=A.getParentElement(b.target,{nodeName:["TD","TH"]}),d;if(e&&t.table&&t.start){a=A.getParentElement(e,{nodeName:["TABLE"]});if(a&&a===t.table){r();d=t.end;t.end=e;t.cells=A.table.getCellsBetween(t.start,e);if(t.cells.length>1){w.composer.selection.deselect()}B(t.cells);if(t.end!==d){w.fire("tableselectchange").fire("tableselectchange:composer")}}}}function s(a){x.stop();E.stop();w.fire("tableselect").fire("tableselect:composer");setTimeout(function(){u()},0)}function u(){var a=A.observe(C.ownerDocument,"click",function(b){a.stop();if(A.getParentElement(b.target,{nodeName:["TABLE"]})!=t.table){r();t.table=null;t.start=null;t.end=null;w.fire("tableunselect").fire("tableunselect:composer")}})}function D(a,b){t.start=a;t.end=b;t.table=A.getParentElement(t.start,{nodeName:["TABLE"]});selectedCells=A.table.getCellsBetween(t.start,t.end);B(selectedCells);u();w.fire("tableselect").fire("tableselect:composer")}return q()};(function(j){var h=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,l=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,i=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,m=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i;var k=function(a){return new RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};j.quirks.styleParser={parseColor:function(d,a){var b=k(a),q=d.match(b),e=10,r,g;if(q){for(var f=q.length;f--;){q[f]=j.lang.string(q[f].split(":")[1]).trim()}r=q[q.length-1];if(h.test(r)){g=r.match(h)}else{if(l.test(r)){g=r.match(l)}else{if(i.test(r)){g=r.match(i);e=16}else{if(m.test(r)){g=r.match(m);g.shift();g.push(1);return j.lang.array(g).map(function(o,n){return(n<3)?(parseInt(o,16)*16)+parseInt(o,16):parseFloat(o)})}}}}if(g){g.shift();if(!g[3]){g.push(1)}return j.lang.array(g).map(function(o,n){return(n<3)?parseInt(o,e):parseFloat(o)})}}return false},unparseColor:function(a,b){if(b){if(b=="hex"){return(a[0].toString(16).toUpperCase())+(a[1].toString(16).toUpperCase())+(a[2].toString(16).toUpperCase())}else{if(b=="hash"){return"#"+(a[0].toString(16).toUpperCase())+(a[1].toString(16).toUpperCase())+(a[2].toString(16).toUpperCase())}else{if(b=="rgb"){return"rgb("+a[0]+","+a[1]+","+a[2]+")"}else{if(b=="rgba"){return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"}else{if(b=="csv"){return a[0]+","+a[1]+","+a[2]+","+a[3]}}}}}}if(a[3]&&a[3]!==1){return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"}else{return"rgb("+a[0]+","+a[1]+","+a[2]+")"}},parseFontSize:function(b){var a=b.match(k("font-size"));if(a){return j.lang.string(a[a.length-1].split(":")[1]).trim()}return false}}})(wysihtml5);(function(i){var j=i.dom;function k(b){var a=0;if(b.parentNode){do{a+=b.offsetTop||0;b=b.offsetParent}while(b)}return a}function g(b,a){var d=0;while(a!==b){d++;a=a.parentNode;if(!a){throw new Error("not a descendant of ancestor!")}}return d}function h(e){if(e.canSurroundContents()){return}var d=e.commonAncestorContainer,b=g(d,e.startContainer),a=g(d,e.endContainer);while(!e.canSurroundContents()){if(b>a){e.setStartBefore(e.startContainer);b=g(d,e.startContainer)}else{e.setEndAfter(e.endContainer);a=g(d,e.endContainer)}}}i.Selection=Base.extend({constructor:function(d,b,a){window.rangy.init();this.editor=d;this.composer=d.composer;this.doc=this.composer.doc;this.contain=b;this.unselectableClass=a||false},getBookmark:function(){var a=this.getRange();if(a){h(a)}return a&&a.cloneRange()},setBookmark:function(a){if(!a){return}this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);b.setStartBefore(a);b.setEndBefore(a);return this.setSelection(b)},setAfter:function(a){var b=rangy.createRange(this.doc);b.setStartAfter(a);b.setEndAfter(a);return this.setSelection(b)},selectNode:function(u,e){var s=rangy.createRange(this.doc),f=u.nodeType===i.ELEMENT_NODE,b="canHaveHTML" in u?u.canHaveHTML:(u.nodeName!=="IMG"),q=f?u.innerHTML:u.data,t=(q===""||q===i.INVISIBLE_SPACE),d=j.getStyle("display").from(u),a=(d==="block"||d==="list-item");if(t&&f&&b&&!e){try{u.innerHTML=i.INVISIBLE_SPACE}catch(r){}}if(b){s.selectNodeContents(u)}else{s.selectNode(u)}if(b&&t&&f){s.collapse(a)}else{if(b&&t){s.setStartAfter(u);s.setEndAfter(u)}}this.setSelection(s)},getSelectedNode:function(b){var a,d;if(b&&this.doc.selection&&this.doc.selection.type==="Control"){d=this.doc.selection.createRange();if(d&&d.length){return d.item(0)}}a=this.getSelection(this.doc);if(a.focusNode===a.anchorNode){return a.focusNode}else{d=this.getRange(this.doc);return d?d.commonAncestorContainer:this.doc.body}},fixSelBorders:function(){var a=this.getRange();h(a);this.setSelection(a)},getSelectedOwnNodes:function(d){var b,n=this.getOwnRanges(),a=[];for(var e=0,f=n.length;e<f;e++){a.push(n[e].commonAncestorContainer||this.doc.body)}return a},findNodesInSelection:function(n){var f=this.getOwnRanges(),d=[],b;for(var a=0,e=f.length;a<e;a++){b=f[a].getNodes([1],function(l){return i.lang.array(n).contains(l.nodeName)});d=d.concat(b)}return d},containsUneditable:function(){var d=this.getOwnUneditables(),a=this.getSelection();for(var b=0,e=d.length;b<e;b++){if(a.containsNode(d[b])){return true}}return false},deleteContents:function(){var b=this.getOwnRanges();for(var a=b.length;a--;){b[a].deleteContents()}this.setSelection(b[0])},getPreviousNode:function(a,f){if(!a){var b=this.getSelection();a=b.anchorNode}if(a===this.contain){return false}var e=a.previousSibling,d;if(e===this.contain){return false}if(e&&e.nodeType!==3&&e.nodeType!==1){e=this.getPreviousNode(e,f)}else{if(e&&e.nodeType===3&&(/^\s*$/).test(e.textContent)){e=this.getPreviousNode(e,f)}else{if(f&&e&&e.nodeType===1&&!i.lang.array(["BR","HR","IMG"]).contains(e.nodeName)&&(/^[\s]*$/).test(e.innerHTML)){e=this.getPreviousNode(e,f)}else{if(!e&&a!==this.contain){d=a.parentNode;if(d!==this.contain){e=this.getPreviousNode(d,f)}}}}}return(e!==this.contain)?e:false},getSelectionParentsByTag:function(a){var f=this.getSelectedOwnNodes(),d,e=[];for(var b=0,n=f.length;b<n;b++){d=(f[b].nodeName&&f[b].nodeName==="LI")?f[b]:i.dom.getParentElement(f[b],{nodeName:["LI"]},false,this.contain);if(d){e.push(d)}}return(e.length)?e:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var b=this.getRange(),e=b.startContainer,a=b.startOffset,d=rangy.createRange(this.doc);d.selectNodeContents(e);d.setStart(e,a);return d}},caretIsLastInSelection:function(){var b=rangy.createRange(this.doc),e=this.getSelection(),d=this.getRangeToNodeEnd().cloneContents(),a=d.textContent;return(/^\s*$/).test(a)},caretIsFirstInSelection:function(){var a=rangy.createRange(this.doc),b=this.getSelection(),e=this.getRange(),d=e.startContainer;if(d.nodeType===i.TEXT_NODE){return this.isCollapsed()&&(d.nodeType===i.TEXT_NODE&&(/^\s*$/).test(d.data.substr(0,e.startOffset)))}else{a.selectNodeContents(this.getRange().commonAncestorContainer);a.collapse(true);return(this.isCollapsed()&&(a.startContainer===b.anchorNode||a.endContainer===b.anchorNode)&&a.startOffset===b.anchorOffset)}},caretIsInTheBeginnig:function(e){var d=this.getSelection(),b=d.anchorNode,a=d.anchorOffset;if(e){return(a===0&&(b.nodeName&&b.nodeName===e.toUpperCase()||i.dom.getParentElement(b.parentNode,{nodeName:e},1)))}else{return(a===0&&!this.getPreviousNode(b,true))}},caretIsBeforeUneditable:function(){var b=this.getSelection(),a=b.anchorNode,p=b.anchorOffset;if(p===0){var o=this.getPreviousNode(a,true);if(o){var e=this.getOwnUneditables();for(var d=0,f=e.length;d<f;d++){if(o===e[d]){return e[d]}}}}return false},executeAndRestoreRangy:function(a,b){var d=this.doc.defaultView||this.doc.parentWindow,f=rangy.saveSelection(d);if(!f){a()}else{try{a()}catch(e){setTimeout(function(){throw e},0)}}rangy.restoreSelection(f)},executeAndRestore:function(L,C){var G=this.doc.body,b=C&&G.scrollTop,B=C&&G.scrollLeft,M="_wysihtml5-temp-placeholder",K='<span class="'+M+'">'+i.INVISIBLE_SPACE+"</span>",D=this.getRange(true),H,e,F,a,A,N,E,I;if(!D){L(G,G);return}if(!D.collapsed){E=D.cloneRange();N=E.createContextualFragment(K);E.collapse(false);E.insertNode(N);E.detach()}A=D.createContextualFragment(K);D.insertNode(A);if(N){H=this.contain.querySelectorAll("."+M);D.setStartBefore(H[0]);D.setEndAfter(H[H.length-1])}this.setSelection(D);try{L(D.startContainer,D.endContainer)}catch(d){setTimeout(function(){throw d},0)}H=this.contain.querySelectorAll("."+M);if(H&&H.length){I=rangy.createRange(this.doc);F=H[0].nextSibling;if(H.length>1){a=H[H.length-1].previousSibling}if(a&&F){I.setStartBefore(F);I.setEndAfter(a)}else{e=this.doc.createTextNode(i.INVISIBLE_SPACE);j.insert(e).after(H[0]);I.setStartBefore(e);I.setEndAfter(e)}this.setSelection(I);for(var f=H.length;f--;){H[f].parentNode.removeChild(H[f])}}else{this.contain.focus()}if(C){G.scrollTop=b;G.scrollLeft=B}try{H.parentNode.removeChild(H)}catch(J){}},set:function(b,a){var d=rangy.createRange(this.doc);d.setStart(b,a||0);this.setSelection(d)},insertHTML:function(d){var f=rangy.createRange(this.doc),a=this.doc.createElement("DIV"),e=this.doc.createDocumentFragment(),b;a.innerHTML=d;b=a.lastChild;while(a.firstChild){e.appendChild(a.firstChild)}this.insertNode(e);if(b){this.setAfter(b)}},insertNode:function(a){var b=this.getRange();if(b){b.insertNode(a)}},surround:function(a){var n=this.getOwnRanges(),d,f=[];if(n.length==0){return f}for(var e=n.length;e--;){d=this.doc.createElement(a.nodeName);f.push(d);if(a.className){d.className=a.className}if(a.cssStyle){d.setAttribute("style",a.cssStyle)}try{n[e].surroundContents(d);this.selectNode(d)}catch(b){d.appendChild(n[e].extractContents());n[e].insertNode(d)}}return f},deblockAndSurround:function(a){var f=this.doc.createElement("div"),d=rangy.createRange(this.doc),e,m,b;f.className=a.className;this.composer.commands.exec("formatBlock",a.nodeName,a.className);e=this.contain.querySelectorAll("."+a.className);if(e[0]){e[0].parentNode.insertBefore(f,e[0]);d.setStartBefore(e[0]);d.setEndAfter(e[e.length-1]);m=d.extractContents();while(m.firstChild){b=m.firstChild;if(b.nodeType==1&&i.dom.hasClass(b,a.className)){while(b.firstChild){f.appendChild(b.firstChild)}if(b.nodeName!=="BR"){f.appendChild(this.doc.createElement("br"))}m.removeChild(b)}else{f.appendChild(b)}}}else{f=null}return f},scrollIntoView:function(){var a=this.doc,e=5,b=a.documentElement.scrollHeight>a.documentElement.offsetHeight,f=a._wysihtml5ScrollIntoViewElement=a._wysihtml5ScrollIntoViewElement||(function(){var m=a.createElement("span");m.innerHTML=i.INVISIBLE_SPACE;return m})(),d;if(b){this.insertNode(f);d=k(f);f.parentNode.removeChild(f);if(d>=(a.body.scrollTop+a.documentElement.offsetHeight-e)){a.body.scrollTop=d}}},selectLine:function(){if(i.browser.supportsSelectionModify()){this._selectLine_W3C()}else{if(this.doc.selection){this._selectLine_MSIE()}}},_selectLine_W3C:function(){var a=this.doc.defaultView,b=a.getSelection();b.modify("move","left","lineboundary");b.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e=this.doc.selection.createRange(),s=e.boundingTop,f=this.doc.body.scrollWidth,v,w,d,t,u;if(!e.moveToPoint){return}if(s===0){d=this.doc.createElement("span");this.insertNode(d);s=d.offsetTop;d.parentNode.removeChild(d)}s+=1;for(t=-10;t<f;t+=2){try{e.moveToPoint(t,s);break}catch(a){}}v=s;w=this.doc.selection.createRange();for(u=f;u>=0;u--){try{w.moveToPoint(u,v);break}catch(b){}}e.setEndPoint("EndToEnd",w);e.select()},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(d,a){var b=this.getRange();if(b){return b.getNodes([d],a)}else{return[]}},fixRangeOverflow:function(d){if(this.contain&&this.contain.firstChild&&d){var a=d.compareNode(this.contain);if(a!==2){if(a===1){d.setStartBefore(this.contain.firstChild)}if(a===0){d.setEndAfter(this.contain.lastChild)}if(a===3){d.setStartBefore(this.contain.firstChild);d.setEndAfter(this.contain.lastChild)}}else{if(this._detectInlineRangeProblems(d)){var b=d.endContainer.previousElementSibling;if(b){d.setEnd(b,this._endOffsetForNode(b))}}}}},_endOffsetForNode:function(a){var b=document.createRange();b.selectNodeContents(a);return b.endOffset},_detectInlineRangeProblems:function(a){var b=j.compareDocumentPosition(a.startContainer,a.endContainer);return(a.endOffset==0&&b&4)},getRange:function(a){var b=this.getSelection(),d=b&&b.rangeCount&&b.getRangeAt(0);if(a!==true){this.fixRangeOverflow(d)}return d},getOwnUneditables:function(){var a=j.query(this.contain,"."+this.unselectableClass),b=j.query(a,"."+this.unselectableClass);return i.lang.array(a).without(b)},getOwnRanges:function(){var s=[],u=this.getRange(),b;if(u){s.push(u)}if(this.unselectableClass&&this.contain&&u){var r=this.getOwnUneditables(),a;if(r.length>0){for(var d=0,f=r.length;d<f;d++){b=[];for(var e=0,t=s.length;e<t;e++){if(s[e]){switch(s[e].compareNode(r[d])){case 2:break;case 3:a=s[e].cloneRange();a.setEndBefore(r[d]);b.push(a);a=s[e].cloneRange();a.setStartAfter(r[d]);b.push(a);break;default:b.push(s[e])}}s=b}}}}return s},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(d){var a=this.doc.defaultView||this.doc.parentWindow,b=rangy.getSelection(a);return b.setSingleRange(d)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(a){var d=this.getRange(),e=d.commonAncestorContainer,b=d.startContainer,f=d.endContainer;if(e.nodeType===i.TEXT_NODE){e=e.parentNode}if(b.nodeType===i.TEXT_NODE&&!(/^\s*$/).test(b.data.substr(d.startOffset))){return false}if(f.nodeType===i.TEXT_NODE&&!(/^\s*$/).test(f.data.substr(d.endOffset))){return false}while(b&&b!==e){if(b.nodeType!==i.TEXT_NODE&&!i.dom.contains(e,b)){return false}if(i.dom.domNode(b).prev({ignoreBlankTexts:true})){return false}b=b.parentNode}while(f&&f!==e){if(f.nodeType!==i.TEXT_NODE&&!i.dom.contains(e,f)){return false}if(i.dom.domNode(f).next({ignoreBlankTexts:true})){return false}f=f.parentNode}return(i.lang.array(a).contains(e.nodeName))?e:false},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})})(wysihtml5);(function(I,P){var w="span";var O=/\s+/g;function Q(e,b,a){if(!e.className){return false}var d=e.className.match(a)||[];return d[d.length-1]===b}function N(d,b){if(!d.getAttribute||!d.getAttribute("style")){return false}var a=d.getAttribute("style").match(b);return(d.getAttribute("style").match(b))?true:false}function C(a,d,b){if(a.getAttribute("style")){x(a,b);if(a.getAttribute("style")&&!(/^\s*$/).test(a.getAttribute("style"))){a.setAttribute("style",d+";"+a.getAttribute("style"))}else{a.setAttribute("style",d)}}else{a.setAttribute("style",d)}}function H(d,b,a){if(d.className){E(d,a);d.className+=" "+b}else{d.className=b}}function E(a,b){if(a.className){a.className=a.className.replace(b,"")}}function x(b,a){var e,d=[];if(b.getAttribute("style")){e=b.getAttribute("style").split(";");for(var f=e.length;f--;){if(!e[f].match(a)&&!(/^\s*$/).test(e[f])){d.push(e[f])}}if(d.length){b.setAttribute("style",d.join(";"))}else{b.removeAttribute("style")}}}function K(g,i){var b=[],e=i.split(";"),a=g.getAttribute("style");if(a){a=a.replace(/\s/gi,"").toLowerCase();b.push(new RegExp("(^|\\s|;)"+i.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var f=e.length;f-->0;){if(!(/^\s*$/).test(e[f])){b.push(new RegExp("(^|\\s|;)"+e[f].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"))}}for(var h=0,d=b.length;h<d;h++){if(a.match(b[h])){return b[h]}}}return false}function G(d,b,e,a){if(e){return K(d,e)}else{if(a){return I.dom.hasClass(d,a)}else{return P.dom.arrayContains(b,d.tagName.toLowerCase())}}}function z(d,b,a,e){for(var f=d.length;f--;){if(!G(d[f],b,a,e)){return false}}return d.length?true:false}function J(e,a,b){var d=K(e,a);if(d){x(e,d);return"remove"}else{C(e,a,b);return"change"}}function A(a,b){return a.className.replace(O," ")==b.className.replace(O," ")}function L(a){var b=a.parentNode;while(a.firstChild){b.insertBefore(a.firstChild,a)}b.removeChild(a)}function M(f,b){if(f.attributes.length!=b.attributes.length){return false}for(var h=0,d=f.attributes.length,e,a,g;h<d;++h){e=f.attributes[h];g=e.name;if(g!="class"){a=b.attributes.getNamedItem(g);if(e.specified!=a.specified){return false}if(e.specified&&e.nodeValue!==a.nodeValue){return false}}}return true}function B(b,a){if(P.dom.isCharacterDataNode(b)){if(a==0){return !!b.previousSibling}else{if(a==b.length){return !!b.nextSibling}else{return true}}}return a>0&&a<b.childNodes.length}function D(b,g,e,d){var a;if(P.dom.isCharacterDataNode(g)){if(e==0){e=P.dom.getNodeIndex(g);g=g.parentNode}else{if(e==g.length){e=P.dom.getNodeIndex(g)+1;g=g.parentNode}else{a=P.dom.splitDataNode(g,e)}}}if(!a){if(!d||g!==d){a=g.cloneNode(false);if(a.id){a.removeAttribute("id")}var f;while((f=g.childNodes[e])){a.appendChild(f)}P.dom.insertAfter(a,g)}}return(g==b)?a:D(b,a.parentNode,P.dom.getNodeIndex(a),d)}function F(a){this.isElementMerge=(a.nodeType==I.ELEMENT_NODE);this.firstTextNode=this.isElementMerge?a.lastChild:a;this.textNodes=[this.firstTextNode]}F.prototype={doMerge:function(){var g=[],b,f,e;for(var a=0,d=this.textNodes.length;a<d;++a){b=this.textNodes[a];f=b.parentNode;g[a]=b.data;if(a){f.removeChild(b);if(!f.hasChildNodes()){f.parentNode.removeChild(f)}}}this.firstTextNode.data=e=g.join("");return e},getLength:function(){var a=this.textNodes.length,b=0;while(a--){b+=this.textNodes[a].length}return b},toString:function(){var d=[];for(var a=0,b=this.textNodes.length;a<b;++a){d[a]="'"+this.textNodes[a].data+"'"}return"[Merge("+d.join(",")+")]"}};function y(d,f,h,b,e,g,a){this.tagNames=d||[w];this.cssClass=f||((f===false)?false:"");this.similarClassRegExp=h;this.cssStyle=e||"";this.similarStyleRegExp=g;this.normalize=b;this.applyToAnyTagName=false;this.container=a}y.prototype={getAncestorWithClass:function(a){var b;while(a){b=this.cssClass?Q(a,this.cssClass,this.similarClassRegExp):(this.cssStyle!=="")?false:true;if(a.nodeType==I.ELEMENT_NODE&&a.getAttribute("contenteditable")!="false"&&P.dom.arrayContains(this.tagNames,a.tagName.toLowerCase())&&b){return a}a=a.parentNode}return false},getAncestorWithStyle:function(b){var a;while(b){a=this.cssStyle?N(b,this.similarStyleRegExp):false;if(b.nodeType==I.ELEMENT_NODE&&b.getAttribute("contenteditable")!="false"&&P.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())&&a){return b}b=b.parentNode}return false},getMatchingAncestor:function(a){var b=this.getAncestorWithClass(a),d=false;if(!b){b=this.getAncestorWithStyle(a);if(b){d="style"}}else{if(this.cssStyle){d="class"}}return{element:b,type:d}},postApply:function(k,p){var l=k[0],j=k[k.length-1];var f=[],i;var d=l,h=j;var n=0,g=j.length;var e,a;for(var b=0,o=k.length;b<o;++b){e=k[b];a=null;if(e&&e.parentNode){a=this.getAdjacentMergeableTextNode(e.parentNode,false)}if(a){if(!i){i=new F(a);f.push(i)}i.textNodes.push(e);if(e===l){d=i.firstTextNode;n=d.length}if(e===j){h=i.firstTextNode;g=i.getLength()}}else{i=null}}if(j&&j.parentNode){var m=this.getAdjacentMergeableTextNode(j.parentNode,true);if(m){if(!i){i=new F(j);f.push(i)}i.textNodes.push(m)}}if(f.length){for(b=0,o=f.length;b<o;++b){f[b].doMerge()}p.setStart(d,n);p.setEnd(h,g)}},getAdjacentMergeableTextNode:function(g,d){var b=(g.nodeType==I.TEXT_NODE);var a=b?g.parentNode:g;var f;var e=d?"nextSibling":"previousSibling";if(b){f=g[e];if(f&&f.nodeType==I.TEXT_NODE){return f}}else{f=a[e];if(f&&this.areElementsMergeable(g,f)){return f[d?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(a,b){return P.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&P.dom.arrayContains(this.tagNames,(b.tagName||"").toLowerCase())&&A(a,b)&&M(a,b)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);if(this.cssClass){b.className=this.cssClass}if(this.cssStyle){b.setAttribute("style",this.cssStyle)}return b},applyToTextNode:function(d){var a=d.parentNode;if(a.childNodes.length==1&&P.dom.arrayContains(this.tagNames,a.tagName.toLowerCase())){if(this.cssClass){H(a,this.cssClass,this.similarClassRegExp)}if(this.cssStyle){C(a,this.cssStyle,this.similarStyleRegExp)}}else{var b=this.createContainer(P.dom.getDocument(d));d.parentNode.insertBefore(b,d);b.appendChild(d)}},isRemovable:function(a){return P.dom.arrayContains(this.tagNames,a.tagName.toLowerCase())&&I.lang.string(a.className).trim()===""&&(!a.getAttribute("style")||I.lang.string(a.getAttribute("style")).trim()==="")},undoToTextNode:function(g,b,i,a){var e=(i)?false:true,h=i||a,f=false;if(!b.containsNode(h)){var d=b.cloneRange();d.selectNode(h);if(d.isPointInRange(b.endContainer,b.endOffset)&&B(b.endContainer,b.endOffset)){D(h,b.endContainer,b.endOffset,this.container);b.setEndAfter(h)}if(d.isPointInRange(b.startContainer,b.startOffset)&&B(b.startContainer,b.startOffset)){h=D(h,b.startContainer,b.startOffset,this.container)}}if(!e&&this.similarClassRegExp){E(h,this.similarClassRegExp)}if(e&&this.similarStyleRegExp){f=(J(h,this.cssStyle,this.similarStyleRegExp)==="change")}if(this.isRemovable(h)&&!f){L(h)}},applyToRange:function(i){var h;for(var b=i.length;b--;){h=i[b].getNodes([I.TEXT_NODE]);if(!h.length){try{var a=this.createContainer(i[b].endContainer.ownerDocument);i[b].surroundContents(a);this.selectNode(i[b],a);return}catch(g){}}i[b].splitBoundaries();h=i[b].getNodes([I.TEXT_NODE]);if(h.length){var e;for(var f=0,d=h.length;f<d;++f){e=h[f];if(!this.getMatchingAncestor(e).element){this.applyToTextNode(e)}}i[b].setStart(h[0],0);e=h[h.length-1];i[b].setEnd(e,e.length);if(this.normalize){this.postApply(h,i[b])}}}},undoToRange:function(b){var l,g,f,i,d;for(var k=b.length;k--;){l=b[k].getNodes([I.TEXT_NODE]);if(l.length){b[k].splitBoundaries();l=b[k].getNodes([I.TEXT_NODE])}else{var j=b[k].endContainer.ownerDocument,h=j.createTextNode(I.INVISIBLE_SPACE);b[k].insertNode(h);b[k].selectNode(h);l=[h]}for(var e=0,a=l.length;e<a;++e){if(b[k].isValid()){g=l[e];d=this.getMatchingAncestor(g);if(d.type==="style"){this.undoToTextNode(g,b[k],false,d.element)}else{if(d.element){this.undoToTextNode(g,b[k],d.element)}}}}if(a==1){this.selectNode(b[k],l[0])}else{b[k].setStart(l[0],0);g=l[l.length-1];b[k].setEnd(g,g.length);if(this.normalize){this.postApply(l,b[k])}}}},selectNode:function(b,a){var f=a.nodeType===I.ELEMENT_NODE,d="canHaveHTML" in a?a.canHaveHTML:true,h=f?a.innerHTML:a.data,e=(h===""||h===I.INVISIBLE_SPACE);if(e&&f&&d){try{a.innerHTML=I.INVISIBLE_SPACE}catch(g){}}b.selectNodeContents(a);if(e&&f){b.collapse(false)}else{if(e){b.setStartAfter(a);b.setEndAfter(a)}}},getTextSelectedByRange:function(b,d){var a=d.cloneRange();a.selectNodeContents(b);var f=a.intersection(d);var e=f?f.toString():"";a.detach();return e},isAppliedToRange:function(e){var j=[],k="full",f,i,b;for(var a=e.length;a--;){b=e[a].getNodes([I.TEXT_NODE]);if(!b.length){f=this.getMatchingAncestor(e[a].startContainer).element;return(f)?{elements:[f],coverage:k}:false}for(var g=0,d=b.length,h;g<d;++g){h=this.getTextSelectedByRange(b[g],e[a]);f=this.getMatchingAncestor(b[g]).element;if(f&&h!=""){j.push(f);if(I.dom.getTextNodes(f,true).length===1){k="full"}else{if(k==="full"){k="inline"}}}else{if(!f){k="partial"}}}}return(j.length)?{elements:j,coverage:k}:false},toggleRange:function(b){var d=this.isAppliedToRange(b),a;if(d){if(d.coverage==="full"){this.undoToRange(b)}else{if(d.coverage==="inline"){a=z(d.elements,this.tagNames,this.cssStyle,this.cssClass);this.undoToRange(b);if(!a){this.applyToRange(b)}}else{if(!z(d.elements,this.tagNames,this.cssStyle,this.cssClass)){this.undoToRange(b)}this.applyToRange(b)}}}else{this.applyToRange(b)}}};I.selection.HTMLApplier=y})(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(b){this.editor=b;this.composer=b.composer;this.doc=this.composer.doc},support:function(b){return wysihtml5.browser.supportsCommand(this.doc,b)},exec:function(l,o){var m=wysihtml5.commands[l],e=wysihtml5.lang.array(arguments).get(),k=m&&m.exec,j=null;this.editor.fire("beforecommand:composer");if(k){e.unshift(this.composer);j=k.apply(m,e)}else{try{j=this.doc.execCommand(l,false,o)}catch(n){}}this.editor.fire("aftercommand:composer");return j},state:function(k,i){var l=wysihtml5.commands[k],e=wysihtml5.lang.array(arguments).get(),j=l&&l.state;if(j){e.unshift(this.composer);return j.apply(l,e)}else{try{return this.doc.queryCommandState(k)}catch(m){return false}}},stateValue:function(i){var f=wysihtml5.commands[i],g=wysihtml5.lang.array(arguments).get(),h=f&&f.stateValue;if(h){g.unshift(this.composer);return h.apply(f,g)}else{return false}}});wysihtml5.commands.bold={exec:function(e,d){wysihtml5.commands.formatInline.execWithToggle(e,d,"b")},state:function(e,d){return wysihtml5.commands.formatInline.state(e,d,"b")}};(function(j){var m,h="A",k=j.dom;function i(A,f){var D=A.doc,G="_wysihtml5-temp-"+(+new Date()),B=/non-matching-class/g,a=0,y,z,b,E,d,e,F,C,g;j.commands.formatInline.exec(A,m,h,G,B,m,m,true,true);z=D.querySelectorAll(h+"."+G);y=z.length;for(;a<y;a++){b=z[a];b.removeAttribute("class");for(g in f){if(g!=="text"){b.setAttribute(g,f[g])}}}e=b;if(y===1){F=k.getTextContent(b);E=!!b.querySelector("*");d=F===""||F===j.INVISIBLE_SPACE;if(!E&&d){k.setTextContent(b,f.text||b.href);C=D.createTextNode(" ");A.selection.setAfter(b);k.insert(C).after(b);e=C}}A.selection.setAfter(e)}function l(a,p,e){var g;for(var f=p.length;f--;){g=p[f].attributes;for(var b=g.length;b--;){p[f].removeAttribute(g.item(b).name)}for(var d in e){if(e.hasOwnProperty(d)){p[f].setAttribute(d,e[d])}}}}j.commands.createLink={exec:function(e,a,b){var d=this.state(e,a);if(d){e.selection.executeAndRestore(function(){l(e,d,b)})}else{b=typeof(b)==="object"?b:{href:b};i(e,b)}},state:function(b,a){return j.commands.formatInline.state(b,a,"A")}}})(wysihtml5);(function(g){var e=g.dom;function f(n,a){var b=a.length,m=0,o,d,i;for(;m<b;m++){o=a[m];d=e.getParentElement(o,{nodeName:"code"});i=e.getTextContent(o);if(i.match(e.autoLink.URL_REG_EXP)&&!d){d=e.renameElement(o,"code")}else{e.replaceWithChildNodes(o)}}}g.commands.removeLink={exec:function(d,a){var b=this.state(d,a);if(b){d.selection.executeAndRestore(function(){f(d,b)})}},state:function(b,a){return g.commands.formatInline.state(b,a,"A")}}})(wysihtml5);(function(d){var e=/wysiwyg-font-size-[0-9a-z\-]+/g;d.commands.fontSize={exec:function(g,a,b){d.commands.formatInline.execWithToggle(g,a,"span","wysiwyg-font-size-"+b,e)},state:function(g,a,b){return d.commands.formatInline.state(g,a,"span","wysiwyg-font-size-"+b,e)}}})(wysihtml5);(function(d){var e=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;d.commands.fontSizeStyle={exec:function(g,a,b){b=(typeof(b)=="object")?b.size:b;if(!(/^\s*$/).test(b)){d.commands.formatInline.execWithToggle(g,a,"span",false,false,"font-size:"+b,e)}},state:function(g,a,b){return d.commands.formatInline.state(g,a,"span",false,false,"font-size",e)},stateValue:function(l,a){var m=this.state(l,a),b,k,j=false;if(m&&d.lang.object(m).isArray()){m=m[0]}if(m){b=m.getAttribute("style");if(b){return d.quirks.styleParser.parseFontSize(b)}}return false}}})(wysihtml5);(function(d){var e=/wysiwyg-color-[0-9a-z]+/g;d.commands.foreColor={exec:function(b,a,g){d.commands.formatInline.execWithToggle(b,a,"span","wysiwyg-color-"+g,e)},state:function(b,a,g){return d.commands.formatInline.state(b,a,"span","wysiwyg-color-"+g,e)}}})(wysihtml5);(function(d){var e=/(\s|^)color\s*:\s*[^;\s]+;?/gi;d.commands.foreColorStyle={exec:function(j,b,k){var i=d.quirks.styleParser.parseColor((typeof(k)=="object")?"color:"+k.color:"color:"+k,"color"),a;if(i){a="color: rgb("+i[0]+","+i[1]+","+i[2]+");";if(i[3]!==1){a+="color: rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+");"}d.commands.formatInline.execWithToggle(j,b,"span",false,false,a,e)}},state:function(b,a){return d.commands.formatInline.state(b,a,"span",false,false,"color",e)},stateValue:function(j,a,b){var k=this.state(j,a),i;if(k&&d.lang.object(k).isArray()){k=k[0]}if(k){i=k.getAttribute("style");if(i){if(i){val=d.quirks.styleParser.parseColor(i,"color");return d.quirks.styleParser.unparseColor(val,b)}}}return false}}})(wysihtml5);(function(d){var e=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;d.commands.bgColorStyle={exec:function(j,b,k){var i=d.quirks.styleParser.parseColor((typeof(k)=="object")?"background-color:"+k.color:"background-color:"+k,"background-color"),a;if(i){a="background-color: rgb("+i[0]+","+i[1]+","+i[2]+");";if(i[3]!==1){a+="background-color: rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+");"}d.commands.formatInline.execWithToggle(j,b,"span",false,false,a,e)}},state:function(b,a){return d.commands.formatInline.state(b,a,"span",false,false,"background-color",e)},stateValue:function(l,a,j){var m=this.state(l,a),k,b=false;if(m&&d.lang.object(m).isArray()){m=m[0]}if(m){k=m.getAttribute("style");if(k){b=d.quirks.styleParser.parseColor(k,"background-color");return d.quirks.styleParser.unparseColor(b,j)}}return false}}})(wysihtml5);(function(o){var x=o.dom,w=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];function s(d,b,a){if(d.className){A(d,a);d.className=o.lang.string(d.className+" "+b).trim()}else{d.className=b}}function u(b,a,d){q(b,d);if(b.getAttribute("style")){b.setAttribute("style",o.lang.string(b.getAttribute("style")+" "+a).trim())}else{b.setAttribute("style",a)}}function A(b,a){var d=a.test(b.className);b.className=b.className.replace(a,"");if(o.lang.string(b.className).trim()==""){b.removeAttribute("class")}return d}function q(a,d){var b=d.test(a.getAttribute("style"));a.setAttribute("style",(a.getAttribute("style")||"").replace(d,""));if(o.lang.string(a.getAttribute("style")||"").trim()==""){a.removeAttribute("style")}return b}function v(a){var b=a.lastChild;if(b&&t(b)){b.parentNode.removeChild(b)}}function t(a){return a.nodeName==="BR"}function r(d,g,b,a,e){var i=g.selection.getOwnRanges();for(var f=i.length;f--;){g.selection.getSelection().removeAllRanges();g.selection.setSelection(i[f]);if(e){var h=x.observe(d,"DOMNodeInserted",function(j){var l=j.target,k;if(l.nodeType!==o.ELEMENT_NODE){return}k=x.getStyle("display").from(l);if(k.substr(0,6)!=="inline"){l.className+=" "+e}})}d.execCommand(b,false,a);if(h){h.stop()}}}function z(e,f){if(e.selection.isCollapsed()){e.selection.selectLine()}var a=e.selection.surround(f);for(var b=0,d=a.length;b<d;b++){o.dom.lineBreaks(a[b]).remove();v(a[b])}}function p(a){return !!o.lang.string(a.className).trim()}function y(a){return !!o.lang.string(a.getAttribute("style")||"").trim()}o.commands.formatBlock={exec:function(g,b,m,F,a,l,e){var i=g.doc,d=this.state(g,b,m,F,a,l,e),n=g.config.useLineBreaks,h=n?"DIV":"P",j,f,k,E,G;m=typeof(m)==="string"?m.toUpperCase():m;if(d.length){g.selection.executeAndRestoreRangy(function(){for(var D=d.length;D--;){if(a){f=A(d[D],a)}if(e){E=q(d[D],e)}if((E||f)&&m===null&&d[D].nodeName!=h){return}var B=p(d[D]),C=y(d[D]);if(!B&&!C&&(n||m==="P")){o.dom.lineBreaks(d[D]).add();x.replaceWithChildNodes(d[D])}else{x.renameElement(d[D],m==="P"?"DIV":h)}}});return}if(m===null||o.lang.array(w).contains(m)){j=g.selection.findNodesInSelection(w).concat(g.selection.getSelectedOwnNodes());g.selection.executeAndRestoreRangy(function(){for(var B=j.length;B--;){G=x.getParentElement(j[B],{nodeName:w});if(G==g.element){G=null}if(G){if(m){G=x.renameElement(G,m)}if(F){s(G,F,a)}if(l){u(G,l,e)}k=true}}});if(k){return}}z(g,{nodeName:(m||h),className:F||null,cssStyle:l||null})},state:function(e,m,i,k,f,h,d){var b=e.selection.getSelectedOwnNodes(),j=[],g;i=typeof(i)==="string"?i.toUpperCase():i;for(var l=0,a=b.length;l<a;l++){g=x.getParentElement(b[l],{nodeName:i,className:k,classRegExp:f,cssStyle:h,styleRegExp:d});if(g&&o.lang.array(j).indexOf(g)==-1){j.push(g)}}if(j.length==0){return false}return j}}})(wysihtml5);wysihtml5.commands.formatCode={exec:function(i,l,m){var n=this.state(i),o,j,k;if(n){i.selection.executeAndRestore(function(){o=n.querySelector("code");wysihtml5.dom.replaceWithChildNodes(n);if(o){wysihtml5.dom.replaceWithChildNodes(o)}})}else{j=i.selection.getRange();k=j.extractContents();n=i.doc.createElement("pre");o=i.doc.createElement("code");if(m){o.className=m}n.appendChild(o);o.appendChild(k);j.insertNode(n);i.selection.selectNode(n)}},state:function(e){var d=e.selection.getSelectedNode();if(d&&d.nodeName&&d.nodeName=="PRE"&&d.firstChild&&d.firstChild.nodeName&&d.firstChild.nodeName=="CODE"){return d}else{return wysihtml5.dom.getParentElement(d,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(d,{nodeName:"PRE"})}}};(function(i){var k={strong:"b",em:"i",b:"strong",i:"em"},j={};function g(a){var b=k[a];return b?[a.toLowerCase(),b.toLowerCase()]:[a.toLowerCase()]}function h(e,d,b,a,n,o){var f=e;if(d){f+=":"+d}if(a){f+=":"+a}if(!j[f]){j[f]=new i.selection.HTMLApplier(g(e),d,b,true,a,n,o)}return j[f]}i.commands.formatInline={exec:function(w,r,t,d,a,b,v,u,s){var f=w.selection.createRange(),e=w.selection.getOwnRanges();if(!e||e.length==0){return false}w.selection.getSelection().removeAllRanges();h(t,d,a,b,v,w.element).toggleRange(e);if(!u){f.setStart(e[0].startContainer,e[0].startOffset);f.setEnd(e[e.length-1].endContainer,e[e.length-1].endOffset);w.selection.setSelection(f);w.selection.executeAndRestore(function(){if(!s){w.cleanUp()}},true,true)}else{if(!s){w.cleanUp()}}},execWithToggle:function(s,p,q,e,a,b,r){var f=this;if(this.state(s,p,q,e,a,b,r)&&s.selection.isCollapsed()&&!s.selection.caretIsLastInSelection()&&!s.selection.caretIsFirstInSelection()){var d=f.state(s,p,q,e,a)[0];s.selection.executeAndRestoreRangy(function(){var l=d.parentNode;s.selection.selectNode(d,true);i.commands.formatInline.exec(s,p,q,e,a,b,r,true,true)})}else{if(this.state(s,p,q,e,a,b,r)&&!s.selection.isCollapsed()){s.selection.executeAndRestoreRangy(function(){i.commands.formatInline.exec(s,p,q,e,a,b,r,true,true)})}else{i.commands.formatInline.exec(s,p,q,e,a,b,r)}}},state:function(w,t,u,r,a,f,v){var d=w.doc,e=k[u]||u,s,b;if(!i.dom.hasElementWithTagName(d,u)&&!i.dom.hasElementWithTagName(d,e)){return false}if(r&&!i.dom.hasElementWithClassName(d,r)){return false}s=w.selection.getOwnRanges();if(!s||s.length===0){return false}b=h(u,r,a,f,v,w.element).isAppliedToRange(s);return(b&&b.elements)?b.elements:false}}})(wysihtml5);(function(b){b.commands.insertBlockQuote={exec:function(k,i){var j=this.state(k,i),m=k.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]),l,a;k.selection.executeAndRestore(function(){if(j){if(k.config.useLineBreaks){b.dom.lineBreaks(j).add()}b.dom.unwrap(j)}else{if(k.selection.isCollapsed()){k.selection.selectLine()}if(m){var d=m.ownerDocument.createElement("blockquote");b.dom.insert(d).after(m);d.appendChild(m)}else{k.selection.surround({nodeName:"blockquote"})}}})},state:function(a,g){var h=a.selection.getSelectedNode(),i=b.dom.getParentElement(h,{nodeName:"BLOCKQUOTE"},false,a.element);return(i)?i:false}}})(wysihtml5);wysihtml5.commands.insertHTML={exec:function(f,g,e){if(f.commands.support(g)){f.doc.execCommand(g,false,e)}else{f.selection.insertHTML(e)}},state:function(){return false}};(function(d){var e="IMG";d.commands.insertImage={exec:function(q,a,n){n=typeof(n)==="object"?n:{src:n};var i=q.doc,m=this.state(q),b,o;if(m){q.selection.setBefore(m);o=m.parentNode;o.removeChild(m);d.dom.removeEmptyTextNodes(o);if(o.nodeName==="A"&&!o.firstChild){q.selection.setAfter(o);o.parentNode.removeChild(o)}d.quirks.redraw(q.element);return}m=i.createElement(e);for(var p in n){m.setAttribute(p==="className"?"class":p,n[p])}q.selection.insertNode(m);if(d.browser.hasProblemsSettingCaretAfterImg()){b=i.createTextNode(d.INVISIBLE_SPACE);q.selection.insertNode(b);q.selection.setAfter(b)}else{q.selection.setAfter(m)}},state:function(j){var b=j.doc,i,a,k;if(!d.dom.hasElementWithTagName(b,e)){return false}i=j.selection.getSelectedNode();if(!i){return false}if(i.nodeName===e){return i}if(i.nodeType!==d.ELEMENT_NODE){return false}a=j.selection.getText();a=d.lang.string(a).trim();if(a){return false}k=j.selection.getNodes(d.ELEMENT_NODE,function(f){return f.nodeName==="IMG"});if(k.length!==1){return false}return k[0]}}})(wysihtml5);(function(d){var e="<br>"+(d.browser.needsSpaceAfterLineBreak()?" ":"");d.commands.insertLineBreak={exec:function(b,a){if(b.commands.support(a)){b.doc.execCommand(a,false,null);if(!d.browser.autoScrollsToCaret()){b.selection.scrollIntoView()}}else{b.commands.exec("insertHTML",e)}},state:function(){return false}}})(wysihtml5);wysihtml5.commands.insertOrderedList={exec:function(e,d){wysihtml5.commands.insertList.exec(e,d,"OL")},state:function(e,d){return wysihtml5.commands.insertList.state(e,d,"OL")}};wysihtml5.commands.insertUnorderedList={exec:function(e,d){wysihtml5.commands.insertList.exec(e,d,"UL")},state:function(e,d){return wysihtml5.commands.insertList.state(e,d,"UL")}};wysihtml5.commands.insertList=(function(k){var m=function(b,d){if(b&&b.nodeName){if(typeof d==="string"){d=[d]}for(var a=d.length;a--;){if(b.nodeName===d[a]){return true}}}return false};var o=function(a,g,b){var d={el:null,other:false};if(a){var f=k.dom.getParentElement(a,{nodeName:"LI"}),e=(g==="UL")?"OL":"UL";if(m(a,g)){d.el=a}else{if(m(a,e)){d={el:a,other:true}}else{if(f){if(m(f.parentNode,g)){d.el=f.parentNode}else{if(m(f.parentNode,e)){d={el:f.parentNode,other:true}}}}}}}if(d.el&&!b.element.contains(d.el)){d.el=null}return d};var i=function(d,g,e){var f=(g==="UL")?"OL":"UL",a,b;e.selection.executeAndRestore(function(){var h=l(f,e);if(h.length){for(var s=h.length;s--;){k.dom.renameElement(h[s],g.toLowerCase())}}else{b=l(["OL","UL"],e);for(var r=b.length;r--;){k.dom.resolveList(b[r],e.config.useLineBreaks)}k.dom.resolveList(d,e.config.useLineBreaks)}})};var j=function(b,a,d){var e=(a==="UL")?"OL":"UL";d.selection.executeAndRestore(function(){var g=[b].concat(l(e,d));for(var f=g.length;f--;){k.dom.renameElement(g[f],a.toLowerCase())}})};var l=function(a,d){var f=d.selection.getOwnRanges(),e=[];for(var b=f.length;b--;){e=e.concat(f[b].getNodes([1],function(g){return m(g,a)}))}return e};var n=function(a,b){b.selection.executeAndRestoreRangy(function(){var e="_wysihtml5-temp-"+new Date().getTime(),f=b.selection.deblockAndSurround({nodeName:"div",className:e}),g,d;var h=/\uFEFF/g;f.innerHTML=f.innerHTML.replace(h,"");if(f){g=k.lang.array(["","<br>",k.INVISIBLE_SPACE]).contains(f.innerHTML);d=k.dom.convertToList(f,a.toLowerCase(),b.parent.config.uneditableContainerClassname);if(g){b.selection.selectNode(d.querySelector("li"),true)}}})};return{exec:function(f,h,g){var a=f.doc,b=(g==="OL")?"insertOrderedList":"insertUnorderedList",d=f.selection.getSelectedNode(),e=o(d,g,f);if(!e.el){if(f.commands.support(b)){a.execCommand(b,false,null)}else{n(g,f)}}else{if(e.other){j(e.el,g,f)}else{i(e.el,g,f)}}},state:function(f,b,a){var d=f.selection.getSelectedNode(),e=o(d,a,f);return(e.el&&!e.other)?e.el:false}}})(wysihtml5);wysihtml5.commands.italic={exec:function(e,d){wysihtml5.commands.formatInline.execWithToggle(e,d,"i")},state:function(e,d){return wysihtml5.commands.formatInline.state(e,d,"i")}};(function(g){var e="wysiwyg-text-align-center",f=/wysiwyg-text-align-[0-9a-z]+/g;g.commands.justifyCenter={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,e,f)}}})(wysihtml5);(function(g){var e="wysiwyg-text-align-left",f=/wysiwyg-text-align-[0-9a-z]+/g;g.commands.justifyLeft={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,e,f)}}})(wysihtml5);(function(g){var e="wysiwyg-text-align-right",f=/wysiwyg-text-align-[0-9a-z]+/g;g.commands.justifyRight={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,e,f)}}})(wysihtml5);(function(g){var e="wysiwyg-text-align-justify",f=/wysiwyg-text-align-[0-9a-z]+/g;g.commands.justifyFull={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,e,f)}}})(wysihtml5);(function(g){var e="text-align: right;",f=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;g.commands.alignRightStyle={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,null,null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,null,null,e,f)}}})(wysihtml5);(function(g){var e="text-align: left;",f=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;g.commands.alignLeftStyle={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,null,null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,null,null,e,f)}}})(wysihtml5);(function(g){var e="text-align: center;",f=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;g.commands.alignCenterStyle={exec:function(b,a){return g.commands.formatBlock.exec(b,"formatBlock",null,null,null,e,f)},state:function(b,a){return g.commands.formatBlock.state(b,"formatBlock",null,null,null,e,f)}}})(wysihtml5);wysihtml5.commands.redo={exec:function(b){return b.undoManager.redo()},state:function(b){return false}};wysihtml5.commands.underline={exec:function(e,d){wysihtml5.commands.formatInline.execWithToggle(e,d,"u")},state:function(e,d){return wysihtml5.commands.formatInline.state(e,d,"u")}};wysihtml5.commands.undo={exec:function(b){return b.undoManager.undo()},state:function(b){return false}};wysihtml5.commands.createTable={exec:function(h,j,l){var i,k,m;if(l&&l.cols&&l.rows&&parseInt(l.cols,10)>0&&parseInt(l.rows,10)>0){if(l.tableStyle){m='<table style="'+l.tableStyle+'">'}else{m="<table>"}m+="<tbody>";for(k=0;k<l.rows;k++){m+="<tr>";for(i=0;i<l.cols;i++){m+="<td>&nbsp;</td>"}m+="</tr>"}m+="</tbody></table>";h.commands.exec("insertHTML",m)}},state:function(e,d){return false}};wysihtml5.commands.mergeTableCells={exec:function(e,d){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){if(this.state(e,d)){wysihtml5.dom.table.unmergeCell(e.tableSelection.start)}else{wysihtml5.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end)}}},state:function(f,i){if(f.tableSelection){var h=f.tableSelection.start,g=f.tableSelection.end;if(h&&g&&h==g&&((wysihtml5.dom.getAttribute(h,"colspan")&&parseInt(wysihtml5.dom.getAttribute(h,"colspan"),10)>1)||(wysihtml5.dom.getAttribute(h,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(h,"rowspan"),10)>1))){return[h]}}return false}};wysihtml5.commands.addTableCells={exec:function(g,h,i){if(g.tableSelection&&g.tableSelection.start&&g.tableSelection.end){var f=wysihtml5.dom.table.orderSelectionEnds(g.tableSelection.start,g.tableSelection.end);if(i=="before"||i=="above"){wysihtml5.dom.table.addCells(f.start,i)}else{if(i=="after"||i=="below"){wysihtml5.dom.table.addCells(f.end,i)}}setTimeout(function(){g.tableSelection.select(f.start,f.end)},0)}},state:function(e,d){return false}};wysihtml5.commands.deleteTableCells={exec:function(o,k,l){if(o.tableSelection&&o.tableSelection.start&&o.tableSelection.end){var n=wysihtml5.dom.table.orderSelectionEnds(o.tableSelection.start,o.tableSelection.end),j=wysihtml5.dom.table.indexOf(n.start),i,m=o.tableSelection.table;wysihtml5.dom.table.removeCells(n.start,l);setTimeout(function(){i=wysihtml5.dom.table.findCell(m,j);if(!i){if(l=="row"){i=wysihtml5.dom.table.findCell(m,{row:j.row-1,col:j.col})}if(l=="column"){i=wysihtml5.dom.table.findCell(m,{row:j.row,col:j.col-1})}}if(i){o.tableSelection.select(i,i)}},0)}},state:function(e,d){return false}};wysihtml5.commands.indentList={exec:function(g,h,i){var f=g.selection.getSelectionParentsByTag("LI");if(f){return this.tryToPushLiLevel(f,g.selection)}return false},state:function(e,d){return false},tryToPushLiLevel:function(j,q){var k,o,l,m,n,p=false;q.executeAndRestoreRangy(function(){for(var a=j.length;a--;){m=j[a];k=(m.parentNode.nodeName==="OL")?"OL":"UL";o=m.ownerDocument.createElement(k);l=wysihtml5.dom.domNode(m).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]});n=(l)?l.querySelector("ul, ol"):null;if(l){if(n){n.appendChild(m)}else{o.appendChild(m);l.appendChild(o)}p=true}}});return p}};wysihtml5.commands.outdentList={exec:function(g,h,i){var f=g.selection.getSelectionParentsByTag("LI");if(f){return this.tryToPullLiLevel(f,g)}return false},state:function(e,d){return false},tryToPullLiLevel:function(n,w){var u,v,s,p,o,q,r,m=false,t=this;w.selection.executeAndRestoreRangy(function(){for(var b=n.length;b--;){q=n[b];if(q.parentNode){u=q.parentNode;if(u.tagName==="OL"||u.tagName==="UL"){m=true;v=wysihtml5.dom.getParentElement(u.parentNode,{nodeName:["OL","UL"]},false,w.element);s=wysihtml5.dom.getParentElement(u.parentNode,{nodeName:["LI"]},false,w.element);if(v&&s){if(q.nextSibling){r=t.getAfterList(u,q);q.appendChild(r)}v.insertBefore(q,s.nextSibling)}else{if(q.nextSibling){r=t.getAfterList(u,q);q.appendChild(r)}for(var a=q.childNodes.length;a--;){u.parentNode.insertBefore(q.childNodes[a],u.nextSibling)}u.parentNode.insertBefore(document.createElement("br"),u.nextSibling);q.parentNode.removeChild(q)}if(u.childNodes.length===0){u.parentNode.removeChild(u)}}}}});return m},getAfterList:function(f,h){var i=f.nodeName,g=document.createElement(i);while(h.nextSibling){g.appendChild(h.nextSibling)}return g}};(function(n){var s=90,p=89,o=8,x=46,y=25,q="data-wysihtml5-selection-node",w="data-wysihtml5-selection-offset",r='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"</span>",t='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"</span>",u=n.dom;function v(a){var b;while(b=a.querySelector("._wysihtml5-temp")){b.parentNode.removeChild(b)}}n.UndoManager=n.lang.Dispatcher.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var b=this,a=this.composer.sandbox.getDocument(),d;u.observe(this.element,"keydown",function(f){if(f.altKey||(!f.ctrlKey&&!f.metaKey)){return}var e=f.keyCode,h=e===s&&!f.shiftKey,g=(e===s&&f.shiftKey)||(e===p);if(h){b.undo();f.preventDefault()}else{if(g){b.redo();f.preventDefault()}}});u.observe(this.element,"keydown",function(f){var e=f.keyCode;if(e===d){return}d=e;if(e===o||e===x){b.transact()}});this.editor.on("newword:composer",function(){b.transact()}).on("beforecommand:composer",function(){b.transact()})},transact:function(){var g=this.historyStr[this.position-1],b=this.composer.getValue(false,false),d=this.element.offsetWidth>0&&this.element.offsetHeight>0,j,e,a,k,i;if(b===g){return}var f=this.historyStr.length=this.historyDom.length=this.position;if(f>y){this.historyStr.shift();this.historyDom.shift();this.position--}this.position++;if(d){j=this.composer.selection.getRange();e=(j&&j.startContainer)?j.startContainer:this.element;a=(j&&j.startOffset)?j.startOffset:0;if(e.nodeType===n.ELEMENT_NODE){k=e}else{k=e.parentNode;i=this.getChildNodeIndex(k,e)}k.setAttribute(w,a);if(typeof(i)!=="undefined"){k.setAttribute(q,i)}}var h=this.element.cloneNode(!!b);this.historyDom.push(h);this.historyStr.push(b);if(k){k.removeAttribute(w);k.removeAttribute(q)}},undo:function(){this.transact();if(!this.undoPossible()){return}this.set(this.historyDom[--this.position-1]);this.editor.fire("undo:composer")},redo:function(){if(!this.redoPossible()){return}this.set(this.historyDom[++this.position-1]);this.editor.fire("redo:composer")},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";var g=0,b=a.childNodes,e=a.childNodes.length;for(;g<e;g++){this.element.appendChild(b[g].cloneNode(true))}var d,f,h;if(a.hasAttribute(w)){d=a.getAttribute(w);h=a.getAttribute(q);f=this.element}else{f=this.element.querySelector("["+w+"]")||this.element;d=f.getAttribute(w);h=f.getAttribute(q);f.removeAttribute(w);f.removeAttribute(q)}if(h!==null){f=this.getChildNodeByIndex(f,+h)}this.composer.selection.set(f,d)},getChildNodeIndex:function(e,a){var f=0,b=e.childNodes,d=b.length;for(;f<d;f++){if(b[f]===a){return f}}},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})})(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(e,g,f){this.parent=e;this.element=g;this.config=f;if(!this.config.noTextarea){this._observeViewChange()}},_observeViewChange:function(){var b=this;this.parent.on("beforeload",function(){b.parent.on("change_view",function(a){if(a===b.name){b.parent.currentView=b;b.show();setTimeout(function(){b.focus()},0)}else{b.hide()}})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")===this.element){return}try{this.element.focus()}catch(b){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(g){var e=g.dom,f=g.browser;g.views.Composer=g.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(b,a,d){this.base(b,a,d);if(!this.config.noTextarea){this.textarea=this.parent.textarea}else{this.editableArea=a}if(this.config.contentEditableMode){this._initContentEditableArea()}else{this._initSandbox()}},clear:function(){this.element.innerHTML=f.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b,a){var d=this.isEmpty()?"":g.quirks.getCorrectInnerHTML(this.element);if(b!==false){d=this.parent.parse(d,(a===false)?false:true)}return d},setValue:function(d,a){if(a){d=this.parent.parse(d)}try{this.element.innerHTML=d}catch(b){this.element.innerText=d}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"";if(!this.config.noTextarea&&!this.textarea.element.disabled){this.disable();this.enable()}},hide:function(){this._displayStyle=e.getStyle("display").from(this.editableArea);if(this._displayStyle==="none"){this._displayStyle=null}this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(a){if(g.browser.doesAsyncFocus()&&this.hasPlaceholderSet()){this.clear()}this.base();var b=this.element.lastChild;if(a&&b&&this.selection){if(b.nodeName==="BR"){this.selection.setBefore(this.element.lastChild)}else{this.selection.setAfter(this.element.lastChild)}}},getTextContent:function(){return e.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==((this.config.noTextarea)?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return(/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i).test(a)||a===""||a==="<br>"||a==="<p></p>"||a==="<p><br></p>"||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;if(this.config.noTextarea){this.sandbox=new e.ContentEditableArea(function(){a._create()},{},this.editableArea)}else{this.sandbox=new e.ContentEditableArea(function(){a._create()});this.editableArea=this.sandbox.getContentEditable();e.insert(this.editableArea).after(this.textarea.element);this._createWysiwygFormField()}},_initSandbox:function(){var b=this;this.sandbox=new e.Sandbox(function(){b._create()},{stylesheets:this.config.stylesheets});this.editableArea=this.sandbox.getIframe();var a=this.textarea.element;e.insert(this.editableArea).after(a);this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden";a.name="_wysihtml5_mode";a.value=1;e.insert(a).after(this.textarea.element)}},_create:function(){var a=this;this.doc=this.sandbox.getDocument();this.element=(this.config.contentEditableMode)?this.sandbox.getContentEditable():this.doc.body;if(!this.config.noTextarea){this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(true,false)}else{this.cleanUp()}this.selection=new g.Selection(this.parent,this.element,this.config.uneditableContainerClassname);this.commands=new g.Commands(this.parent);if(!this.config.noTextarea){e.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element)}e.addClass(this.element,this.config.composerClassName);if(this.config.style&&!this.config.contentEditableMode){this.style()}this.observe();var b=this.config.name;if(b){e.addClass(this.element,b);if(!this.config.contentEditableMode){e.addClass(this.editableArea,b)}}this.enable();if(!this.config.noTextarea&&this.textarea.element.disabled){this.disable()}var d=typeof(this.config.placeholder)==="string"?this.config.placeholder:((this.config.noTextarea)?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"));if(d){e.simulatePlaceholder(this.parent,this,d)}this.commands.exec("styleWithCSS",false);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();this._initLineBreaking();if(!this.config.noTextarea&&(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&!f.isIos()){setTimeout(function(){a.focus(true)},100)}if(!f.clearsContentEditableCorrectly()){g.quirks.ensureProperClearing(this)}if(this.initSync&&this.config.sync){this.initSync()}if(!this.config.noTextarea){this.textarea.hide()}this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var b=this,l=f.canDisableAutoLinking(),k=f.doesAutoLinkingInContentEditable();if(l){this.commands.exec("autoUrlDetect",false)}if(!this.config.autoLink){return}if(!k||(k&&l)){this.parent.on("newword:composer",function(){if(e.getTextContent(b.element).match(e.autoLink.URL_REG_EXP)){b.selection.executeAndRestore(function(q,p){var j=b.element.querySelectorAll("."+b.config.uneditableContainerClassname),h=false;for(var i=j.length;i--;){if(g.dom.contains(j[i],p)){h=true}}if(!h){e.autoLink(p.parentNode,[b.config.uneditableContainerClassname])}})}});e.observe(this.element,"blur",function(){e.autoLink(b.element,[b.config.uneditableContainerClassname])})}var m=this.sandbox.getDocument().getElementsByTagName("a"),a=e.autoLink.URL_REG_EXP,d=function(i){var h=g.lang.string(e.getTextContent(i)).trim();if(h.substr(0,4)==="www."){h="http://"+h}return h};e.observe(this.element,"keydown",function(h){if(!m.length){return}var o=b.selection.getSelectedNode(h.target.ownerDocument),i=e.getParentElement(o,{nodeName:"A"},4),j;if(!i){return}j=d(i);setTimeout(function(){var n=d(i);if(n===j){return}if(n.match(a)){i.setAttribute("href",n)}},0)})},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",true);if(f.supportsEvent("resizeend")){var a=["width","height"],b=a.length,d=this.element;e.observe(d,"resizeend",function(o){var i=o.target||o.srcElement,p=i.style,q=0,n;if(i.nodeName!=="IMG"){return}for(;q<b;q++){n=a[q];if(p[n]){i.setAttribute(n,parseInt(p[n],10));p[n]=""}}g.quirks.redraw(d)})}},_initUndoManager:function(){this.undoManager=new g.UndoManager(this.parent)},_initLineBreaking:function(){var b=this,d=["LI","P","H1","H2","H3","H4","H5","H6"],i=["UL","OL","MENU"];function a(h){var k=e.getParentElement(h,{nodeName:["P","DIV"]},2);if(k&&e.contains(b.element,k)){b.selection.executeAndRestore(function(){if(b.config.useLineBreaks){e.replaceWithChildNodes(k)}else{if(k.nodeName!=="P"){e.renameElement(k,"p")}}})}}if(!this.config.useLineBreaks){e.observe(this.element,["focus","keydown"],function(){if(b.isEmpty()){var h=b.doc.createElement("P");b.element.innerHTML="";b.element.appendChild(h);if(!f.displaysCaretInEmptyContentEditableCorrectly()){h.innerHTML="<br>";b.selection.setBefore(h.firstChild)}else{b.selection.selectNode(h,true)}}})}e.observe(this.element,"keydown",function(m){var l=m.keyCode;if(m.shiftKey){return}if(l!==g.ENTER_KEY&&l!==g.BACKSPACE_KEY){return}var h=e.getParentElement(b.selection.getSelectedNode(),{nodeName:d},4);if(h){setTimeout(function(){var j=b.selection.getSelectedNode(),k;if(h.nodeName==="LI"){if(!j){return}k=e.getParentElement(j,{nodeName:i},2);if(!k){a(j)}}if(l===g.ENTER_KEY&&h.nodeName.match(/^H[1-6]$/)){a(j)}},0);return}if(b.config.useLineBreaks&&l===g.ENTER_KEY&&!g.browser.insertsLineBreaksOnReturn()){m.preventDefault();b.commands.exec("insertLineBreak")}})}})})(wysihtml5);(function(k){var s=k.dom,o=document,q=window,p=o.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],m=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],n=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",k.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"];var l=function(a){if(a.setActive){try{a.setActive()}catch(f){}}else{var g=a.style,e=o.documentElement.scrollTop||o.body.scrollTop,b=o.documentElement.scrollLeft||o.body.scrollLeft,d={position:g.position,top:g.top,left:g.left,WebkitUserSelect:g.WebkitUserSelect};s.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a);a.focus();s.setStyles(d).on(a);if(q.scrollTo){q.scrollTo(b,e)}}};k.views.Composer.prototype.style=function(){var f=this,g=o.querySelector(":focus"),e=this.textarea.element,a=e.hasAttribute("placeholder"),i=a&&e.getAttribute("placeholder"),d=e.style.display,h=e.disabled,b;this.focusStylesHost=p.cloneNode(false);this.blurStylesHost=p.cloneNode(false);this.disabledStylesHost=p.cloneNode(false);if(a){e.removeAttribute("placeholder")}if(e===g){e.blur()}e.disabled=false;e.style.display=b="none";if((e.getAttribute("rows")&&s.getStyle("height").from(e)==="auto")||(e.getAttribute("cols")&&s.getStyle("width").from(e)==="auto")){e.style.display=b=d}s.copyStyles(m).from(e).to(this.editableArea).andTo(this.blurStylesHost);s.copyStyles(r).from(e).to(this.element).andTo(this.blurStylesHost);s.insertCSS(n).into(this.element.ownerDocument);e.disabled=true;s.copyStyles(m).from(e).to(this.disabledStylesHost);s.copyStyles(r).from(e).to(this.disabledStylesHost);e.disabled=h;e.style.display=d;l(e);e.style.display=b;s.copyStyles(m).from(e).to(this.focusStylesHost);s.copyStyles(r).from(e).to(this.focusStylesHost);e.style.display=d;s.copyStyles(["display"]).from(e).to(this.editableArea);var j=k.lang.array(m).without(["display"]);if(g){g.focus()}else{e.blur()}if(a){e.setAttribute("placeholder",i)}this.parent.on("focus:composer",function(){s.copyStyles(j).from(f.focusStylesHost).to(f.editableArea);s.copyStyles(r).from(f.focusStylesHost).to(f.element)});this.parent.on("blur:composer",function(){s.copyStyles(j).from(f.blurStylesHost).to(f.editableArea);s.copyStyles(r).from(f.blurStylesHost).to(f.element)});this.parent.observe("disable:composer",function(){s.copyStyles(j).from(f.disabledStylesHost).to(f.editableArea);s.copyStyles(r).from(f.disabledStylesHost).to(f.element)});this.parent.observe("enable:composer",function(){s.copyStyles(j).from(f.blurStylesHost).to(f.editableArea);s.copyStyles(r).from(f.blurStylesHost).to(f.element)});return this}})(wysihtml5);(function(k){var m=k.dom,i=k.browser,j={"66":"bold","73":"italic","85":"underline"};var o=function(a,e,d){var f=a.getPreviousNode(e,true),b=a.getSelectedNode();if(b.nodeType!==1&&b.parentNode!==d){b=b.parentNode}if(f){if(b.nodeType==1){var g=b.firstChild;if(f.nodeType==1){while(b.firstChild){f.appendChild(b.firstChild)}}else{while(b.firstChild){e.parentNode.insertBefore(b.firstChild,e)}}if(b.parentNode){b.parentNode.removeChild(b)}a.setBefore(g)}else{if(f.nodeType==1){f.appendChild(b)}else{e.parentNode.insertBefore(b,e)}a.setBefore(b)}}};var l=function(g,a,b,d){if(a.isCollapsed()){if(a.caretIsInTheBeginnig("LI")){g.preventDefault();d.commands.exec("outdentList")}else{if(a.caretIsInTheBeginnig()){g.preventDefault()}else{if(a.caretIsFirstInSelection()&&a.getPreviousNode()&&a.getPreviousNode().nodeName&&(/^H\d$/gi).test(a.getPreviousNode().nodeName)){var f=a.getPreviousNode();g.preventDefault();if((/^\s*$/).test(f.textContent||f.innerText)){f.parentNode.removeChild(f)}else{var e=f.ownerDocument.createRange();e.selectNodeContents(f);e.collapse(false);a.setSelection(e)}}var h=a.caretIsBeforeUneditable();if(h){g.preventDefault();o(a,h,b)}}}}else{if(a.containsUneditable()){g.preventDefault();a.deleteContents()}}};var n=function(b,a){if(!b.selection.isCollapsed()){b.selection.deleteContents()}else{if(b.selection.caretIsInTheBeginnig("LI")){if(b.commands.exec("indentList")){return}}}b.commands.exec("insertHTML","&emsp;")};k.views.Composer.prototype.observe=function(){var d=this,r=this.getValue(false,false),h=(this.sandbox.getIframe)?this.sandbox.getIframe():this.sandbox.getContentEditable(),f=this.element,a=(i.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable)?f:this.sandbox.getWindow(),g=["drop","paste","beforepaste"],b=["drop","paste","mouseup","focus","keyup"];m.observe(h,"DOMNodeRemoved",function(){clearInterval(e);d.parent.fire("destroy:composer")});if(!i.supportsMutationEvents()){var e=setInterval(function(){if(!m.contains(document.documentElement,h)){clearInterval(e);d.parent.fire("destroy:composer")}},250)}m.observe(a,b,function(){setTimeout(function(){d.parent.fire("interaction").fire("interaction:composer")},0)});if(this.config.handleTables){if(!this.tableClickHandle&&this.doc.execCommand&&k.browser.supportsCommand(this.doc,"enableObjectResizing")&&k.browser.supportsCommand(this.doc,"enableInlineTableEditing")){if(this.sandbox.getIframe){this.tableClickHandle=m.observe(h,["focus","mouseup","mouseover"],function(){d.doc.execCommand("enableObjectResizing",false,"false");d.doc.execCommand("enableInlineTableEditing",false,"false");d.tableClickHandle.stop()})}else{setTimeout(function(){d.doc.execCommand("enableObjectResizing",false,"false");d.doc.execCommand("enableInlineTableEditing",false,"false")},0)}}this.tableSelection=k.quirks.tableCellsSelection(f,d.parent)}m.observe(a,"focus",function(p){d.parent.fire("focus",p).fire("focus:composer",p);setTimeout(function(){r=d.getValue(false,false)},0)});m.observe(a,"blur",function(q){if(r!==d.getValue(false,false)){var p=q;if(typeof Object.create=="function"){p=Object.create(q,{type:{value:"change"}})}d.parent.fire("change",p).fire("change:composer",p)}d.parent.fire("blur",q).fire("blur:composer",q)});m.observe(f,"dragenter",function(){d.parent.fire("unset_placeholder")});m.observe(f,g,function(p){d.parent.fire(p.type,p).fire(p.type+":composer",p)});if(this.config.copyedFromMarking){m.observe(f,"copy",function(p){if(p.clipboardData){p.clipboardData.setData("text/html",d.config.copyedFromMarking+d.selection.getHtml());p.preventDefault()}d.parent.fire(p.type,p).fire(p.type+":composer",p)})}m.observe(f,"keyup",function(q){var p=q.keyCode;if(p===k.SPACE_KEY||p===k.ENTER_KEY){d.parent.fire("newword:composer")}});this.parent.on("paste:composer",function(){setTimeout(function(){d.parent.fire("newword:composer")},0)});if(!i.canSelectImagesInContentEditable()){m.observe(f,"mousedown",function(w){var q=w.target;var p=f.querySelectorAll("img"),x=f.querySelectorAll("."+d.config.uneditableContainerClassname+" img"),y=k.lang.array(p).without(x);if(q.nodeName==="IMG"&&k.lang.array(y).contains(q)){d.selection.selectNode(q)}})}if(!i.canSelectImagesInContentEditable()){m.observe(f,"drop",function(p){setTimeout(function(){d.selection.getSelection().removeAllRanges()},0)})}if(i.hasHistoryIssue()&&i.supportsSelectionModify()){m.observe(f,"keydown",function(v){if(!v.metaKey&&!v.ctrlKey){return}var p=v.keyCode,q=f.ownerDocument.defaultView,w=q.getSelection();if(p===37||p===39){if(p===37){w.modify("extend","left","lineboundary");if(!v.shiftKey){w.collapseToStart()}}if(p===39){w.modify("extend","right","lineboundary");if(!v.shiftKey){w.collapseToEnd()}}v.preventDefault()}})}m.observe(f,"keydown",function(u){var q=u.keyCode,p=j[q];if((u.ctrlKey||u.metaKey)&&!u.altKey&&p){d.commands.exec(p);u.preventDefault()}if(q===8){l(u,d.selection,f,d)}else{if(d.config.handleTabKey&&q===9){u.preventDefault();n(d,f)}}});m.observe(f,"keydown",function(v){var p=d.selection.getSelectedNode(true),q=v.keyCode,w;if(p&&p.nodeName==="IMG"&&(q===k.BACKSPACE_KEY||q===k.DELETE_KEY)){w=p.parentNode;w.removeChild(p);if(w.nodeName==="A"&&!w.firstChild){w.parentNode.removeChild(w)}setTimeout(function(){k.quirks.redraw(f)},0);v.preventDefault()}});if(!this.config.contentEditableMode&&i.hasIframeFocusIssue()){m.observe(h,"focus",function(){setTimeout(function(){if(d.doc.querySelector(":focus")!==d.element){d.focus()}},0)});m.observe(this.element,"blur",function(){setTimeout(function(){d.selection.getSelection().removeAllRanges()},0)})}var s={IMG:"Image: ",A:"Link: "};m.observe(f,"mouseover",function(x){var w=x.target,p=w.nodeName,q;if(p!=="A"&&p!=="IMG"){return}var y=w.hasAttribute("title");if(!y){q=s[p]+(w.getAttribute("href")||w.getAttribute("src"));w.setAttribute("title",q)}})}})(wysihtml5);(function(d){var e=400;d.views.Synchronizer=Base.extend({constructor:function(a,g,b){this.editor=a;this.textarea=g;this.composer=b;this._observe()},fromComposerToTextarea:function(a){this.textarea.setValue(d.lang.string(this.composer.getValue(false,false)).trim(),a)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(false,false);if(b){this.composer.setValue(b,a)}else{this.composer.clear();this.editor.fire("set_placeholder")}},sync:function(a){if(this.editor.currentView.name==="textarea"){this.fromTextareaToComposer(a)}else{this.fromComposerToTextarea(a)}},_observe:function(){var k,i=this,j=this.textarea.element.form,a=function(){k=setInterval(function(){i.fromComposerToTextarea()},e)},b=function(){clearInterval(k);k=null};a();if(j){d.dom.observe(j,"submit",function(){i.sync(true)});d.dom.observe(j,"reset",function(){setTimeout(function(){i.fromTextareaToComposer()},0)})}this.editor.on("change_view",function(f){if(f==="composer"&&!k){i.fromTextareaToComposer(true);a()}else{if(f==="textarea"){i.fromComposerToTextarea(true);b()}}});this.editor.on("destroy:composer",b)}})})(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,g,f){this.base(e,g,f);this._observe()},clear:function(){this.element.value=""},getValue:function(d){var e=this.isEmpty()?"":this.element.value;if(d!==false){e=this.parent.parse(e)}return e},setValue:function(e,d){if(d){e=this.parent.parse(e)}this.element.value=e},cleanUp:function(){var b=this.parent.parse(this.element.value);this.element.value=b},hasPlaceholderSet:function(){var h=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),g=this.element.getAttribute("placeholder")||null,f=this.element.value,i=!f;return(h&&i)||(f===g)},isEmpty:function(){return !wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var i=this.element,h=this.parent,g={focusin:"focus",focusout:"blur"},f=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];h.on("beforeload",function(){wysihtml5.dom.observe(i,f,function(a){var b=g[a.type]||a.type;h.fire(b).fire(b+":textarea")});wysihtml5.dom.observe(i,["paste","drop"],function(){setTimeout(function(){h.fire("paste").fire("paste:textarea")},0)})})}});(function(g){var e;var f={name:e,style:true,toolbar:e,showToolbarAfterInit:true,autoLink:true,handleTables:true,handleTabKey:true,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:g.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:true,stylesheets:[],placeholderText:e,supportTouchDevices:true,cleanUp:true,contentEditableMode:false,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};g.Editor=g.lang.Dispatcher.extend({constructor:function(a,d){this.editableElement=typeof(a)==="string"?document.getElementById(a):a;this.config=g.lang.object({}).merge(f).merge(d).get();this._isCompatible=g.browser.supported();if(this.editableElement.nodeName.toLowerCase()!="textarea"){this.config.contentEditableMode=true;this.config.noTextarea=true}if(!this.config.noTextarea){this.textarea=new g.views.Textarea(this,this.editableElement,this.config);this.currentView=this.textarea}if(!this._isCompatible||(!this.config.supportTouchDevices&&g.browser.isTouchDevice())){var b=this;setTimeout(function(){b.fire("beforeload").fire("load")},0);return}g.dom.addClass(document.body,this.config.bodyClassName);this.composer=new g.views.Composer(this,this.editableElement,this.config);this.currentView=this.composer;if(typeof(this.config.parser)==="function"){this._initParser()}this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){if(!this.config.noTextarea){this.synchronizer=new g.views.Synchronizer(this,this.textarea,this.composer)}if(this.config.toolbar){this.toolbar=new g.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit)}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(b,a){return this.currentView.getValue(b,a)},setValue:function(b,a){this.fire("unset_placeholder");if(!b){return this.clear()}this.currentView.setValue(b,a);return this},cleanUp:function(){this.currentView.cleanUp()},focus:function(a){this.currentView.focus(a);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(d,a){var i=(this.config.contentEditableMode)?document:((this.composer)?this.composer.sandbox.getDocument():null);var b=this.config.parser(d,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:i,uneditableClass:this.config.uneditableContainerClassname,clearInternals:a});if(typeof(d)==="object"){g.quirks.redraw(d)}return b},_initParser:function(){var a=this,b,d;if(g.browser.supportsModenPaste()){this.on("paste:composer",function(i){i.preventDefault();b=g.dom.getPastedHtml(i);if(b){a._cleanAndPaste(b)}})}else{this.on("beforepaste:composer",function(i){i.preventDefault();g.dom.getPastedHtmlWithDiv(a.composer,function(h){if(h){a._cleanAndPaste(h)}})})}},_cleanAndPaste:function(a){var b=g.quirks.cleanPastedHTML(a,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents();this.composer.selection.insertHTML(b)}})})(wysihtml5);(function(j){var k=j.dom,i="wysihtml5-command-dialog-opened",l="input, select, textarea",h="[data-wysihtml5-dialog-field]",m="data-wysihtml5-dialog-field";j.toolbar.Dialog=j.lang.Dispatcher.extend({constructor:function(a,b){this.link=a;this.container=b},_observe:function(){if(this._observed){return}var b=this,a=function(p){var n=b._serialize();if(n==b.elementToChange){b.fire("edit",n)}else{b.fire("save",n)}b.hide();p.preventDefault();p.stopPropagation()};k.observe(b.link,"click",function(){if(k.hasClass(b.link,i)){setTimeout(function(){b.hide()},0)}});k.observe(this.container,"keydown",function(n){var p=n.keyCode;if(p===j.ENTER_KEY){a(n)}if(p===j.ESCAPE_KEY){b.fire("cancel");b.hide()}});k.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",a);k.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(n){b.fire("cancel");b.hide();n.preventDefault();n.stopPropagation()});var e=this.container.querySelectorAll(l),f=0,d=e.length,g=function(){clearInterval(b.interval)};for(;f<d;f++){k.observe(e[f],"change",g)}this._observed=true},_serialize:function(){var a=this.elementToChange||{},e=this.container.querySelectorAll(h),b=e.length,d=0;for(;d<b;d++){a[e[d].getAttribute(m)]=e[d].value}return a},_interpolate:function(r){var a,g,b,q=document.querySelector(":focus"),f=this.container.querySelectorAll(h),d=f.length,e=0;for(;e<d;e++){a=f[e];if(a===q){continue}if(r&&a.type==="hidden"){continue}g=a.getAttribute(m);b=(this.elementToChange&&typeof(this.elementToChange)!=="boolean")?(this.elementToChange.getAttribute(g)||""):a.defaultValue;a.value=b}},show:function(a){if(k.hasClass(this.link,i)){return}var d=this,e=this.container.querySelector(l);this.elementToChange=a;this._observe();this._interpolate();if(a){this.interval=setInterval(function(){d._interpolate(true)},500)}k.addClass(this.link,i);this.container.style.display="";this.fire("show");if(e&&!a){try{e.focus()}catch(b){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;k.removeClass(this.link,i);this.container.style.display="none";this.fire("hide")}})})(wysihtml5);(function(j){var k=j.dom;var l={position:"relative"};var m={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1};var h={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"};var i={"x-webkit-speech":"",speech:""};j.toolbar.Speech=function(e,d){var f=document.createElement("input");if(!j.browser.supportsSpeechApiOn(f)){d.style.display="none";return}var b=e.editor.textarea.element.getAttribute("lang");if(b){i.lang=b}var a=document.createElement("div");j.lang.object(m).merge({width:d.offsetWidth+"px",height:d.offsetHeight+"px"});k.insert(f).into(a);k.insert(a).into(d);k.setStyles(h).on(f);k.setAttributes(i).on(f);k.setStyles(m).on(a);k.setStyles(l).on(d);var g="onwebkitspeechchange" in f?"webkitspeechchange":"speechchange";k.observe(f,g,function(){e.execCommand("insertText",f.value);f.value=""});k.observe(f,"click",function(o){if(k.hasClass(d,"wysihtml5-command-disabled")){o.preventDefault()}o.stopPropagation()})}})(wysihtml5);(function(j){var i="wysihtml5-command-disabled",h="wysihtml5-commands-disabled",m="wysihtml5-command-active",l="wysihtml5-action-active",k=j.dom;j.toolbar.Toolbar=Base.extend({constructor:function(a,f,b){this.editor=a;this.container=typeof(f)==="string"?document.getElementById(f):f;this.composer=a.composer;this._getLinks("command");this._getLinks("action");this._observe();if(b){this.show()}if(a.config.classNameCommandDisabled!=null){i=a.config.classNameCommandDisabled}if(a.config.classNameCommandsDisabled!=null){h=a.config.classNameCommandsDisabled}if(a.config.classNameCommandActive!=null){m=a.config.classNameCommandActive}if(a.config.classNameActionActive!=null){l=a.config.classNameActionActive}var e=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),g=e.length,d=0;for(;d<g;d++){new j.toolbar.Speech(this,e[d])}},_getLinks:function(f){var a=this[f+"Links"]=j.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+f+"]")).get(),t=a.length,s=0,v=this[f+"Mapping"]={},e,b,u,d,g;for(;s<t;s++){e=a[s];u=e.getAttribute("data-wysihtml5-"+f);d=e.getAttribute("data-wysihtml5-"+f+"-value");b=this.container.querySelector("[data-wysihtml5-"+f+"-group='"+u+"']");g=this._getDialog(e,u);v[u+":"+d]={link:e,group:b,name:u,value:d,dialog:g,state:false}}},_getDialog:function(b,a){var d=this,e=this.container.querySelector("[data-wysihtml5-dialog='"+a+"']"),f,g;if(e){if(j.toolbar["Dialog_"+a]){f=new j.toolbar["Dialog_"+a](b,e)}else{f=new j.toolbar.Dialog(b,e)}f.on("show",function(){g=d.composer.selection.getBookmark();d.editor.fire("show:dialog",{command:a,dialogContainer:e,commandLink:b})});f.on("save",function(o){if(g){d.composer.selection.setBookmark(g)}d._execCommand(a,o);d.editor.fire("save:dialog",{command:a,dialogContainer:e,commandLink:b})});f.on("cancel",function(){d.editor.focus(false);d.editor.fire("cancel:dialog",{command:a,dialogContainer:e,commandLink:b})})}return f},execCommand:function(a,d){if(this.commandsDisabled){return}var b=this.commandMapping[a+":"+d];if(b&&b.dialog&&!b.state){b.dialog.show()}else{this._execCommand(a,d)}},_execCommand:function(a,b){this.editor.focus(false);this.composer.commands.exec(a,b);this._updateLinkStates()},execAction:function(a){var b=this.editor;if(a==="change_view"){if(b.textarea){if(b.currentView===b.textarea){b.fire("change_view","composer")}else{b.fire("change_view","textarea")}}}if(a=="showSource"){b.fire("showSource")}},_observe:function(){var g=this,b=this.editor,f=this.container,e=this.commandLinks.concat(this.actionLinks),a=e.length,d=0;for(;d<a;d++){if(e[d].nodeName==="A"){k.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[d])}else{k.setAttributes({unselectable:"on"}).on(e[d])}}k.delegate(f,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(n){n.preventDefault()});k.delegate(f,"[data-wysihtml5-command]","click",function(s){var t=this,r=t.getAttribute("data-wysihtml5-command"),n=t.getAttribute("data-wysihtml5-command-value");g.execCommand(r,n);s.preventDefault()});k.delegate(f,"[data-wysihtml5-action]","click",function(n){var p=this.getAttribute("data-wysihtml5-action");g.execAction(p);n.preventDefault()});b.on("interaction:composer",function(){g._updateLinkStates()});b.on("focus:composer",function(){g.bookmark=null});if(this.editor.config.handleTables){b.on("tableselect:composer",function(){g.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""});b.on("tableunselect:composer",function(){g.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})}b.on("change_view",function(n){if(b.textarea){setTimeout(function(){g.commandsDisabled=(n!=="composer");g._updateLinkStates();if(g.commandsDisabled){k.addClass(f,h)}else{k.removeClass(f,h)}},0)}})},_updateLinkStates:function(){var e=this.commandMapping,a=this.actionMapping,f,b,d,g;for(f in e){g=e[f];if(this.commandsDisabled){b=false;k.removeClass(g.link,m);if(g.group){k.removeClass(g.group,m)}if(g.dialog){g.dialog.hide()}}else{b=this.composer.commands.state(g.name,g.value);k.removeClass(g.link,i);if(g.group){k.removeClass(g.group,i)}}if(g.state===b){continue}g.state=b;if(b){k.addClass(g.link,m);if(g.group){k.addClass(g.group,m)}if(g.dialog){if(typeof(b)==="object"||j.lang.object(b).isArray()){if(!g.dialog.multiselect&&j.lang.object(b).isArray()){b=b.length===1?b[0]:true;g.state=b}g.dialog.show(b)}else{g.dialog.hide()}}}else{k.removeClass(g.link,m);if(g.group){k.removeClass(g.group,m)}if(g.dialog){g.dialog.hide()}}}for(f in a){d=a[f];if(d.name==="change_view"){d.state=this.editor.currentView===this.editor.textarea;if(d.state){k.addClass(d.link,l)}else{k.removeClass(d.link,l)}}}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(b){b.toolbar.Dialog_createTable=b.toolbar.Dialog.extend({show:function(a){this.base(a)}})})(wysihtml5);(function(h){var i=h.dom,g="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";h.toolbar.Dialog_foreColorStyle=h.toolbar.Dialog.extend({multiselect:true,_serialize:function(){var a={},e=this.container.querySelectorAll(g),b=e.length,d=0;for(;d<b;d++){a[e[d].getAttribute(f)]=e[d].value}return a},_interpolate:function(v){var d,a,x,e=document.querySelector(":focus"),s=this.container.querySelectorAll(g),w=s.length,t=0,r=(this.elementToChange)?((h.lang.object(this.elementToChange).isArray())?this.elementToChange[0]:this.elementToChange):null,b=(r)?r.getAttribute("style"):null,u=(b)?h.quirks.styleParser.parseColor(b,"color"):null;for(;t<w;t++){d=s[t];if(d===e){continue}if(v&&d.type==="hidden"){continue}if(d.getAttribute(f)==="color"){if(u){if(u[3]&&u[3]!=1){d.value="rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]+");"}else{d.value="rgb("+u[0]+","+u[1]+","+u[2]+");"}}else{d.value="rgb(0,0,0);"}}}}})})(wysihtml5);(function(h){var i=h.dom,g="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";h.toolbar.Dialog_fontSizeStyle=h.toolbar.Dialog.extend({multiselect:true,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(b){var a=document.querySelector(":focus"),e=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),l=(this.elementToChange)?((h.lang.object(this.elementToChange).isArray())?this.elementToChange[0]:this.elementToChange):null,d=(l)?l.getAttribute("style"):null,m=(d)?h.quirks.styleParser.parseFontSize(d):null;if(e&&e!==a&&m&&!(/^\s*$/).test(m)){e.value=m}}})})(wysihtml5);
/*!

 handlebars v1.3.0

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
var Handlebars=function(){var f=function(){function g(i){this.string=i}var h;return g.prototype.toString=function(){return""+this.string},h=g}(),m=function(l){function A(n){return G[n]||"&amp;"}function B(o,p){for(var n in p){Object.prototype.hasOwnProperty.call(p,n)&&(o[n]=p[n])}}function C(n){return n instanceof F?n.toString():n||0===n?(n=""+n,h.test(n)?n.replace(g,A):n):""}function D(n){return n||0===n?k(n)&&0===n.length?!0:!1:!0}var E={},F=l,G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},g=/[&<>"'`]/g,h=/[&<>"'`]/;E.extend=B;var i=Object.prototype.toString;E.toString=i;var j=function(n){return"function"==typeof n};j(/x/)&&(j=function(n){return"function"==typeof n&&"[object Function]"===i.call(n)});var j;E.isFunction=j;var k=Array.isArray||function(n){return n&&"object"==typeof n?"[object Array]"===i.call(n):!1};return E.isArray=k,E.escapeExpression=C,E.isEmpty=D,E}(f),a=function(){function h(s,j){var k;j&&j.firstLine&&(k=j.firstLine,s+=" - "+k+":"+j.firstColumn);for(var l=Error.prototype.constructor.call(this,s),r=0;r<g.length;r++){this[g[r]]=l[g[r]]}k&&(this.lineNumber=k,this.column=j.firstColumn)}var i,g=["description","fileName","lineNumber","message","name","number","stack"];return h.prototype=new Error,i=h}(),b=function(I,K){function M(r,s){this.helpers=r||{},this.partials=s||{},O(this)}function O(r){r.registerHelper("helperMissing",function(s){if(2===arguments.length){return void 0}throw new k("Missing helper: '"+s+"'")}),r.registerHelper("blockHelperMissing",function(t,v){var s=v.inverse||function(){},u=v.fn;return q(t)&&(t=t.call(this)),t===!0?u(this):t===!1||null==t?s(this):p(t)?t.length>0?r.helpers.each(t,v):s(this):u(t)}),r.registerHelper("each",function(x,y){var z,A=y.fn,s=y.inverse,t=0,u="";if(q(x)&&(x=x.call(this)),y.data&&(z=g(y.data)),x&&"object"==typeof x){if(p(x)){for(var v=x.length;v>t;t++){z&&(z.index=t,z.first=0===t,z.last=t===x.length-1),u+=A(x[t],{data:z})}}else{for(var w in x){x.hasOwnProperty(w)&&(z&&(z.key=w,z.index=t,z.first=0===t),u+=A(x[w],{data:z}),t++)}}}return 0===t&&(u=s(this)),u}),r.registerHelper("if",function(s,t){return q(s)&&(s=s.call(this)),!t.hash.includeZero&&!s||j.isEmpty(s)?t.inverse(this):t.fn(this)}),r.registerHelper("unless",function(s,t){return r.helpers["if"].call(this,s,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),r.registerHelper("with",function(s,t){return q(s)&&(s=s.call(this)),j.isEmpty(s)?void 0:t.fn(s)}),r.registerHelper("log",function(s,t){var u=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;r.log(u,s)})}function h(r,s){N.log(r,s)}var i={},j=I,k=K,l="1.3.0";i.VERSION=l;var n=4;i.COMPILER_REVISION=n;var o={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};i.REVISION_CHANGES=o;var p=j.isArray,q=j.isFunction,J=j.toString,L="[object Object]";i.HandlebarsEnvironment=M,M.prototype={constructor:M,logger:N,log:h,registerHelper:function(s,t,r){if(J.call(s)===L){if(r||t){throw new k("Arg not supported with multiple helpers")}j.extend(this.helpers,s)}else{r&&(t.not=r),this.helpers[s]=t}},registerPartial:function(r,s){J.call(r)===L?j.extend(this.partials,r):this.partials[r]=s}};var N={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(s,t){if(N.level<=s){var r=N.methodMap[s];"undefined"!=typeof console&&console[r]&&console[r].call(console,t)}}};i.logger=N,i.log=h;var g=function(r){var s={};return j.extend(s,r),s};return i.createFrame=g,i}(m,a),d=function(j,l,n){function C(o){var p=o&&o[0]||1,q=i;if(p!==q){if(q>p){var r=k[q],s=k[p];throw new h("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+s+").")}throw new h("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+").")}}function D(p,q){if(!q){throw new h("No environment passed to template")}var r=function(s,t,u,v,w,x){var y=q.VM.invokePartial.apply(this,arguments);if(null!=y){return y}if(q.compile){var z={helpers:v,partials:w,data:x};return w[t]=q.compile(s,{data:void 0!==x},q),w[t](u,z)}throw new h("The partial "+t+" could not be compiled when running in runtime-only mode")},o={escapeExpression:g.escapeExpression,invokePartial:r,programs:[],program:function(u,v,s){var t=this.programs[u];return s?t=F(u,v,s):t||(t=this.programs[u]=F(u,v)),t},merge:function(u,t){var s=u||t;return u&&t&&u!==t&&(s={},g.extend(s,t),g.extend(s,u)),s},programWithDepth:q.VM.programWithDepth,noop:q.VM.noop,compilerInfo:null};return function(u,v){v=v||{};var x,w,s=v.partial?v:q;v.partial||(x=v.helpers,w=v.partials);var t=p.call(o,s,u,x,w,v.data);return v.partial||q.VM.checkRevision(o.compilerInfo),t}}function E(o,p,q){var r=Array.prototype.slice.call(arguments,3),s=function(t,u){return u=u||{},p.apply(this,[t,u.data||q].concat(r))};return s.program=o,s.depth=r.length,s}function F(p,q,r){var o=function(s,t){return t=t||{},q(s,t.data||r)};return o.program=p,o.depth=0,o}function G(u,o,p,q,r,s){var t={partial:!0,helpers:q,partials:r,data:s};if(void 0===u){throw new h("The partial "+o+" could not be found")}return u instanceof Function?u(p,t):void 0}function H(){return""}var I={},g=j,h=l,i=n.COMPILER_REVISION,k=n.REVISION_CHANGES;return I.checkRevision=C,I.template=D,I.programWithDepth=E,I.program=F,I.invokePartial=G,I.noop=H,I}(m,a,b),e=function(l,A,B,C,D){var E,F=l,G=A,g=B,h=C,i=D,j=function(){var n=new F.HandlebarsEnvironment;return h.extend(n,F),n.SafeString=G,n.Exception=g,n.Utils=h,n.VM=i,n.template=function(o){return i.template(o,n)},n},k=j();return k.create=j,E=k}(b,f,a,m,d);return e}();this["wysihtml5"]=this["wysihtml5"]||{};this["wysihtml5"]["tpl"]=this["wysihtml5"]["tpl"]||{};this["wysihtml5"]["tpl"]["blockquote"]=Handlebars.template(function(w,q,x,r,s){this.compilerInfo=[4,">= 1.0.0"];x=this.merge(x,w.helpers);s=s||{};var u="",z,v="function",t=this.escapeExpression,o=this;function y(a,b){var e="",d;e+="btn-"+t(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===v?d.apply(a):d));return e}function A(a,b){return' \n      <span class="fa fa-quote-left"></span>\n    '}function p(a,b){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}u+='<li>\n  <a class="btn ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.size),{hash:{},inverse:o.noop,fn:o.program(1,y,s),data:s});if(z||z===0){u+=z}u+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.fa),{hash:{},inverse:o.program(5,p,s),fn:o.program(3,A,s),data:s});if(z||z===0){u+=z}u+="\n  </a>\n</li>\n";return u});this["wysihtml5"]["tpl"]["color"]=Handlebars.template(function(t,n,u,o,p){this.compilerInfo=[4,">= 1.0.0"];u=this.merge(u,t.helpers);p=p||{};var r="",w,s="function",q=this.escapeExpression,m=this;function v(b,d){var a="",e;a+="btn-"+q(((e=((e=((e=(b&&b.options)),e==null||e===false?e:e.toolbar)),e==null||e===false?e:e.size)),typeof e===s?e.apply(b):e));return a}r+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ';w=u["if"].call(n,((w=((w=(n&&n.options)),w==null||w===false?w:w.toolbar)),w==null||w===false?w:w.size),{hash:{},inverse:m.noop,fn:m.program(1,v,p),data:p});if(w||w===0){r+=w}r+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.black)),typeof w===s?w.apply(n):w))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.black)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.silver)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.gray)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.maroon)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.red)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.purple)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.green)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.olive)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.navy)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.blue)),typeof w===s?w.apply(n):w))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+q(((w=((w=((w=(n&&n.locale)),w==null||w===false?w:w.colours)),w==null||w===false?w:w.orange)),typeof w===s?w.apply(n):w))+"</a></li>\n  </ul>\n</li>\n";return r});this["wysihtml5"]["tpl"]["emphasis"]=Handlebars.template(function(u,o,v,p,q){this.compilerInfo=[4,">= 1.0.0"];v=this.merge(v,u.helpers);q=q||{};var s="",x,t="function",r=this.escapeExpression,n=this;function w(a,b){var e="",d;e+="btn-"+r(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===t?d.apply(a):d));return e}function y(a,b){var e="",d;e+='\n    <a class="btn ';d=v["if"].call(a,((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size),{hash:{},inverse:n.noop,fn:n.program(1,w,b),data:b});if(d||d===0){e+=d}e+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+r(((d=((d=((d=(a&&a.locale)),d==null||d===false?d:d.emphasis)),d==null||d===false?d:d.small)),typeof d===t?d.apply(a):d))+"</a>\n    ";return e}s+='<li>\n  <div class="btn-group">\n    <a class="btn ';x=v["if"].call(o,((x=((x=(o&&o.options)),x==null||x===false?x:x.toolbar)),x==null||x===false?x:x.size),{hash:{},inverse:n.noop,fn:n.program(1,w,q),data:q});if(x||x===0){s+=x}s+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+r(((x=((x=((x=(o&&o.locale)),x==null||x===false?x:x.emphasis)),x==null||x===false?x:x.bold)),typeof x===t?x.apply(o):x))+'</a>\n    <a class="btn ';x=v["if"].call(o,((x=((x=(o&&o.options)),x==null||x===false?x:x.toolbar)),x==null||x===false?x:x.size),{hash:{},inverse:n.noop,fn:n.program(1,w,q),data:q});if(x||x===0){s+=x}s+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+r(((x=((x=((x=(o&&o.locale)),x==null||x===false?x:x.emphasis)),x==null||x===false?x:x.italic)),typeof x===t?x.apply(o):x))+'</a>\n    <a class="btn ';x=v["if"].call(o,((x=((x=(o&&o.options)),x==null||x===false?x:x.toolbar)),x==null||x===false?x:x.size),{hash:{},inverse:n.noop,fn:n.program(1,w,q),data:q});if(x||x===0){s+=x}s+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+r(((x=((x=((x=(o&&o.locale)),x==null||x===false?x:x.emphasis)),x==null||x===false?x:x.underline)),typeof x===t?x.apply(o):x))+"</a>\n    ";x=v["if"].call(o,((x=((x=((x=(o&&o.options)),x==null||x===false?x:x.toolbar)),x==null||x===false?x:x.emphasis)),x==null||x===false?x:x.small),{hash:{},inverse:n.noop,fn:n.program(3,y,q),data:q});if(x||x===0){s+=x}s+="\n  </div>\n</li>\n";return s});this["wysihtml5"]["tpl"]["font-styles"]=Handlebars.template(function(w,q,x,r,s){this.compilerInfo=[4,">= 1.0.0"];x=this.merge(x,w.helpers);s=s||{};var u="",z,v="function",t=this.escapeExpression,o=this;function y(a,b){var e="",d;e+="btn-"+t(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===v?d.apply(a):d));return e}function A(a,b){return'\n      <span class="fa fa-font"></span>\n    '}function p(a,b){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}u+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.size),{hash:{},inverse:o.noop,fn:o.program(1,y,s),data:s});if(z||z===0){u+=z}u+='" data-toggle="dropdown">\n    ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.fa),{hash:{},inverse:o.program(5,p,s),fn:o.program(3,A,s),data:s});if(z||z===0){u+=z}u+='\n    <span class="current-font">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.normal)),typeof z===v?z.apply(q):z))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.normal)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h1)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h2)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h3)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h4)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h5)),typeof z===v?z.apply(q):z))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.font_styles)),z==null||z===false?z:z.h6)),typeof z===v?z.apply(q):z))+"</a></li>\n  </ul>\n</li>\n";return u});this["wysihtml5"]["tpl"]["html"]=Handlebars.template(function(w,q,x,r,s){this.compilerInfo=[4,">= 1.0.0"];x=this.merge(x,w.helpers);s=s||{};var u="",z,v="function",t=this.escapeExpression,o=this;function y(a,b){var e="",d;e+="btn-"+t(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===v?d.apply(a):d));return e}function A(a,b){return'\n        <span class="fa fa-pencil"></span>\n      '}function p(a,b){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}u+='<li>\n  <div class="btn-group">\n    <a class="btn ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.size),{hash:{},inverse:o.noop,fn:o.program(1,y,s),data:s});if(z||z===0){u+=z}u+=' btn-default" data-wysihtml5-action="change_view" title="'+t(((z=((z=((z=(q&&q.locale)),z==null||z===false?z:z.html)),z==null||z===false?z:z.edit)),typeof z===v?z.apply(q):z))+'" tabindex="-1">\n      ';z=x["if"].call(q,((z=((z=(q&&q.options)),z==null||z===false?z:z.toolbar)),z==null||z===false?z:z.fa),{hash:{},inverse:o.program(5,p,s),fn:o.program(3,A,s),data:s});if(z||z===0){u+=z}u+="\n    </a>\n  </div>\n</li>\n";return u});this["wysihtml5"]["tpl"]["image"]=Handlebars.template(function(y,s,z,t,u){this.compilerInfo=[4,">= 1.0.0"];z=this.merge(z,y.helpers);u=u||{};var w="",B,x="function",v=this.escapeExpression,p=this;function A(a,b){return"modal-sm"}function C(a,b){var e="",d;e+="btn-"+v(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===x?d.apply(a):d));return e}function q(a,b){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function r(a,b){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}w+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.smallmodals),{hash:{},inverse:p.noop,fn:p.program(1,A,u),data:u});if(B||B===0){w+=B}w+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.image)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.image)),B==null||B===false?B:B.cancel)),typeof B===x?B.apply(s):B))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.image)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.size),{hash:{},inverse:p.noop,fn:p.program(3,C,u),data:u});if(B||B===0){w+=B}w+=' btn-default" data-wysihtml5-command="insertImage" title="'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.image)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'" tabindex="-1">\n    ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.fa),{hash:{},inverse:p.program(7,r,u),fn:p.program(5,q,u),data:u});if(B||B===0){w+=B}w+="\n  </a>\n</li>\n";return w});this["wysihtml5"]["tpl"]["link"]=Handlebars.template(function(y,s,z,t,u){this.compilerInfo=[4,">= 1.0.0"];z=this.merge(z,y.helpers);u=u||{};var w="",B,x="function",v=this.escapeExpression,p=this;function A(a,b){return"modal-sm"}function C(a,b){var e="",d;e+="btn-"+v(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===x?d.apply(a):d));return e}function q(a,b){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function r(a,b){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}w+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.smallmodals),{hash:{},inverse:p.noop,fn:p.program(1,A,u),data:u});if(B||B===0){w+=B}w+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.link)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.link)),B==null||B===false?B:B.target)),typeof B===x?B.apply(s):B))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.link)),B==null||B===false?B:B.cancel)),typeof B===x?B.apply(s):B))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.link)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.size),{hash:{},inverse:p.noop,fn:p.program(3,C,u),data:u});if(B||B===0){w+=B}w+=' btn-default" data-wysihtml5-command="createLink" title="'+v(((B=((B=((B=(s&&s.locale)),B==null||B===false?B:B.link)),B==null||B===false?B:B.insert)),typeof B===x?B.apply(s):B))+'" tabindex="-1">\n    ';B=z["if"].call(s,((B=((B=(s&&s.options)),B==null||B===false?B:B.toolbar)),B==null||B===false?B:B.fa),{hash:{},inverse:p.program(7,r,u),fn:p.program(5,q,u),data:u});if(B||B===0){w+=B}w+="\n  </a>\n</li>\n";return w});this["wysihtml5"]["tpl"]["lists"]=Handlebars.template(function(J,z,B,F,u){this.compilerInfo=[4,">= 1.0.0"];B=this.merge(B,J.helpers);u=u||{};var A="",I,L="function",M=this.escapeExpression,C=this;function D(a,b){var e="",d;e+="btn-"+M(((d=((d=((d=(a&&a.options)),d==null||d===false?d:d.toolbar)),d==null||d===false?d:d.size)),typeof d===L?d.apply(a):d));return e}function E(a,b){return'\n      <span class="fa fa-list-ul"></span>\n    '}function G(a,b){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function H(a,b){return'\n      <span class="fa fa-list-ol"></span>\n    '}function K(a,b){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function v(a,b){return'\n      <span class="fa fa-outdent"></span>\n    '}function w(a,b){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function x(a,b){return'\n      <span class="fa fa-indent"></span>\n    '}function y(a,b){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}A+='<li>\n  <div class="btn-group">\n    <a class="btn ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.size),{hash:{},inverse:C.noop,fn:C.program(1,D,u),data:u});if(I||I===0){A+=I}A+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+M(((I=((I=((I=(z&&z.locale)),I==null||I===false?I:I.lists)),I==null||I===false?I:I.unordered)),typeof I===L?I.apply(z):I))+'" tabindex="-1">\n    ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.fa),{hash:{},inverse:C.program(5,G,u),fn:C.program(3,E,u),data:u});if(I||I===0){A+=I}A+='\n    </a>\n    <a class="btn ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.size),{hash:{},inverse:C.noop,fn:C.program(1,D,u),data:u});if(I||I===0){A+=I}A+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+M(((I=((I=((I=(z&&z.locale)),I==null||I===false?I:I.lists)),I==null||I===false?I:I.ordered)),typeof I===L?I.apply(z):I))+'" tabindex="-1">\n    ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.fa),{hash:{},inverse:C.program(9,K,u),fn:C.program(7,H,u),data:u});if(I||I===0){A+=I}A+='\n    </a>\n    <a class="btn ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.size),{hash:{},inverse:C.noop,fn:C.program(1,D,u),data:u});if(I||I===0){A+=I}A+=' btn-default" data-wysihtml5-command="Outdent" title="'+M(((I=((I=((I=(z&&z.locale)),I==null||I===false?I:I.lists)),I==null||I===false?I:I.outdent)),typeof I===L?I.apply(z):I))+'" tabindex="-1">\n    ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.fa),{hash:{},inverse:C.program(13,w,u),fn:C.program(11,v,u),data:u});if(I||I===0){A+=I}A+='\n    </a>\n    <a class="btn ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.size),{hash:{},inverse:C.noop,fn:C.program(1,D,u),data:u});if(I||I===0){A+=I}A+=' btn-default" data-wysihtml5-command="Indent" title="'+M(((I=((I=((I=(z&&z.locale)),I==null||I===false?I:I.lists)),I==null||I===false?I:I.indent)),typeof I===L?I.apply(z):I))+'" tabindex="-1">\n    ';I=B["if"].call(z,((I=((I=(z&&z.options)),I==null||I===false?I:I.toolbar)),I==null||I===false?I:I.fa),{hash:{},inverse:C.program(17,y,u),fn:C.program(15,x,u),data:u});if(I||I===0){A+=I}A+="\n    </a>\n  </div>\n</li>\n";return A});(function(b){if(typeof define==="function"&&define.amd){define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],b)}else{b(jQuery,wysihtml5)}}(function(e,g){var f=function(d,a){var l=function(j,i,h){if(a.tpl[j]){return a.tpl[j]({locale:i,options:h})}};var b=function(k,i){this.el=k;var j=d.extend(true,{},n,i);for(var h in j.customTemplates){if(j.customTemplates.hasOwnProperty(h)){a.tpl[h]=j.customTemplates[h]}}this.toolbar=this.createToolbar(k,j);this.editor=this.createEditor(j)};b.prototype={constructor:b,createEditor:function(h){h=h||{};h=d.extend(true,{},h);h.toolbar=this.toolbar[0];this.initializeEditor(this.el[0],h)},initializeEditor:function(j,h){var k=new a.Editor(this.el[0],h);k.on("beforeload",this.syncBootstrapDialogEvents);k.on("beforeload",this.loadParserRules);if(k.composer.editableArea.contentDocument){this.addMoreShortcuts(k,k.composer.editableArea.contentDocument.body||k.composer.editableArea.contentDocument,h.shortcuts)}else{this.addMoreShortcuts(k,k.composer.editableArea,h.shortcuts)}if(h&&h.events){for(var i in h.events){if(h.events.hasOwnProperty(i)){k.on(i,h.events[i])}}}return k},loadParserRules:function(){if(d.type(this.config.parserRules)==="string"){d.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(i,j,h){console.log(h)},success:function(h){this.config.parserRules=h;console.log("parserrules loaded")}})}if(this.config.pasteParserRulesets&&d.type(this.config.pasteParserRulesets)==="string"){d.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(i,j,h){console.log(h)},success:function(h){this.config.pasteParserRulesets=h}})}},syncBootstrapDialogEvents:function(){var h=this;d.map(this.toolbar.commandMapping,function(i){return[i]}).filter(function(i){return i.dialog}).map(function(i){return i.dialog}).forEach(function(i){i.on("show",function(){d(this.container).modal("show")});i.on("hide",function(){d(this.container).modal("hide");setTimeout(h.composer.focus,0)});d(i.container).on("shown.bs.modal",function(){d(this).find("input, select, textarea").first().focus()})});this.on("change_view",function(){d(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(s,u){var h=this;var k=d("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});var i=u.locale||n.locale||"en";if(!o.hasOwnProperty(i)){console.debug("Locale '"+i+"' not found. Available locales are: "+Object.keys(o)+". Falling back to 'en'.");i="en"}var j=d.extend(true,{},o.en,o[i]);for(var t in u.toolbar){if(u.toolbar[t]){k.append(l(t,j,u))}}k.find('a[data-wysihtml5-command="formatBlock"]').click(function(p){var q=p.delegateTarget||p.target||p.srcElement,y=d(q),x=y.data("wysihtml5-display-format-name"),r=y.data("wysihtml5-format-name")||y.html();if(x===undefined||x==="true"){h.toolbar.find(".current-font").text(r)}});k.find('a[data-wysihtml5-command="foreColor"]').click(function(p){var q=p.target||p.srcElement;var r=d(q);h.toolbar.find(".current-color").text(r.html())});this.el.before(k);return k},addMoreShortcuts:function(j,h,i){a.dom.observe(h,"keydown",function(t){var s=t.keyCode,k=i[s];if((t.ctrlKey||t.metaKey||t.altKey)&&k&&a.commands[k]){var u=j.toolbar.commandMapping[k+":null"];if(u&&u.dialog&&!u.state){u.dialog.show()}else{a.commands[k].exec(j.composer,k)}t.preventDefault()}})}};var m={resetDefaults:function(){d.fn.wysihtml5.defaultOptions=d.extend(true,{},d.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(h){return this.each(function(){var i=d(this);i.data("wysihtml5",new b(i,h))})},shallowExtend:function(i){var h=d.extend({},d.fn.wysihtml5.defaultOptions,i||{},d(this).data());var j=this;return m.bypassDefaults.apply(j,[h])},deepExtend:function(i){var h=d.extend(true,{},d.fn.wysihtml5.defaultOptions,i||{});var j=this;return m.bypassDefaults.apply(j,[h])},init:function(i){var h=this;return m.shallowExtend.apply(h,[i])}};d.fn.wysihtml5=function(h){if(m[h]){return m[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return m.init.apply(this,arguments)}else{d.error("Method "+h+" does not exist on jQuery.wysihtml5")}}};d.fn.wysihtml5.Constructor=b;var n=d.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":true,color:false,emphasis:{small:true},blockquote:true,lists:true,html:false,link:true,image:true,smallmodals:false},useLineBreaks:false,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{"83":"small","75":"createLink"}};if(typeof d.fn.wysihtml5.defaultOptionsCache==="undefined"){d.fn.wysihtml5.defaultOptionsCache=d.extend(true,{},d.fn.wysihtml5.defaultOptions)}var o=d.fn.wysihtml5.locale={}};f(e,g)}));(function(b){b.commands.small={exec:function(a,e){return b.commands.formatInline.exec(a,e,"small")},state:function(a,e){return b.commands.formatInline.state(a,e,"small")}}})(wysihtml5);(function(b){if(typeof define==="function"&&define.amd){define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],b)}else{b(jQuery)}}(function(b){b.fn.wysihtml5.locale.en=b.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}));