angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(B){var A=B.get("$document"),z=B.get("$interval"),y=B.get("$timeout"),x=B.get("$window"),w=B.get("$parse"),v=angular.bind,u=angular.extend,t=angular.element,s=(angular.isDefined,"undefined"!=typeof x.ontouchstart),r="transform",q=x.requestAnimationFrame||x.webkitRequestAnimationFrame,p=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;["webkit","moz","o","ms"].every(function(b){var f=b+"Transform",e=A.find("body").eq(0);return"undefined"!=typeof e[0].style[f]?(r=f,!1):!0});var o={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,useObserver:!0,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,preventKeyEvents:!0,updateOnResize:!0,kineticTau:325,spyMargin:1};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(aq,ak,aj){var ai,ah,ag,af,ae,ad=u({},o,aq.$eval(aj.ngScrollable)),ac=t(ak.children()[0]),ab={window:t(x),el:ac,content:t(ac.children()[0]),barX:t(ac.children()[1]),barY:t(ac.children()[2]),sliderX:t(t(ac.children()[1]).children()[0]),sliderY:t(t(ac.children()[2]).children()[0])},n=!1,m=!1,aY=0,aX=0,aW=0,aV=0,aS=0,aR=0,aQ=0,aP=0,aN=0,aL=0,aK=null,aJ=null,aI=null,aH=null,aG=!1,aE=!1,aD=!1,aC={},aB=1,aA=0,az=0,ay=0,ax=0,aw=0,av=0,au=0,a6=0,ar=function(C){return C.toFixed(3)+"px"},a1=function(D,C,E){return Math.max(C,Math.min(D,E))},aF=function(){var a=aq.$root?aq.$root.$$phase:aq.$$phase;"$apply"!==a&&"$digest"!==a&&aq.$digest()},al=function(){var C=aY-3;n||ad.scrollXAlways?(aQ=Math.max(ad.minSliderLength,parseInt(C*C/aW,10)),aP=parseInt(aR*(C-aQ)/(aW-C),10),aP>=C-aQ?aP=C-aQ:0>aP&&(aP=0),ab.sliderX[0].style[r]="translate3d("+ar(aP)+",0,0)",ab.sliderX[0].style.width=ar(aQ)):(aQ=aP=0,ab.sliderX[0].style[r]="translate3d(0,0,0)",ab.sliderX[0].style.width="0")},h=function(){var C=aX-3;m||ad.scrollYAlways?(aN=Math.max(ad.minSliderLength,parseInt(C*C/aV,10)),aL=parseInt(aS*(C-aN)/(aV-C),10),aL>=C-aN?aL=C-aN:0>aL&&(aL=0),ab.sliderY[0].style[r]="translate3d(0,"+ar(aL)+",0)",ab.sliderY[0].style.height=ar(aN)):(aL=aN=0,ab.sliderY[0].style[r]="translate3d(0,0,0)",ab.sliderY[0].style.height="0")},c=function(){var D=ad.scrollXAlways,C={left:0,width:ar(aY),display:n||D?"inherit":"none"};switch(ad.scrollX){case"bottom":C.bottom=0,ab.content[n||D?"addClass":"removeClass"]("scrollable-bottom"),ab.barX[n||D?"addClass":"removeClass"]("scrollable-bottom");break;case"top":C.top=0,ab.content[n||D?"addClass":"removeClass"]("scrollable-top"),ab.barX[n||D?"addClass":"removeClass"]("scrollable-top")}ab.barX.css(C),ab.sliderX[0].style.display=n||D?"inherit":"none"},a9=function(){var D=ad.scrollYAlways,C={top:0,height:ar(aX),display:m||D?"inherit":"none"};switch(ad.scrollY){case"right":C.right=0,ab.content[m||D?"addClass":"removeClass"]("scrollable-right"),ab.barY[m||D?"addClass":"removeClass"]("scrollable-right");break;case"left":C.left=0,ab.content[m||D?"addClass":"removeClass"]("scrollable-left"),ab.barY[m||D?"addClass":"removeClass"]("scrollable-left")}ab.barY.css(C),ab.sliderY[0].style.display=m||D?"inherit":"none"},a2=function(){var a=!1;aC.spyX&&(aC.spyX(aq,parseInt(aR,10)),a=!0),aC.spyY&&(aC.spyY(aq,parseInt(aS,10)),a=!0),a&&aF()},aM=function(a,E){var D=aS,C=aR;aS=a1(E,0,aV-aX),aR=a1(a,0,aW-aY),ab.content[0].style[r]="translate3d("+ar(-aR)+","+ar(-aS)+",0)",aq.$applyAsync(a2),aX*ad.spyMargin>aS&&D>=aX*ad.spyMargin&&aq.$broadcast("scrollable.spytop",aS,ad.id),aS>aV-aX*(ad.spyMargin+1)&&aV-aX*(ad.spyMargin+1)>=D&&aq.$broadcast("scrollable.spybottom",aS,ad.id),aY*ad.spyMargin>aR&&C>=aY*ad.spyMargin&&aq.$broadcast("scrollable.spyleft",aR,ad.id),aR>aW-aY*(ad.spyMargin+1)&&aW-aY*(ad.spyMargin+1)>=C&&aq.$broadcast("scrollable.spyright",aR,ad.id)},am=function(C){n&&(aM(C,aS),al())},i=function(C){m&&(aM(aR,C),h())},d=function(a,C){aY=ad.usePadding?ab.el[0].clientWidth:ab.el[0].offsetWidth,aX=ad.usePadding?ab.el[0].clientHeight:ab.el[0].offsetHeight,aW=ab.content[0].scrollWidth,aV=ab.content[0].scrollHeight,aB=parseFloat(ab.window[0].getComputedStyle(ab.el[0],null).getPropertyValue("font-size")),"none"!==ad.scrollX&&aW>aY+ad.scrollXSlackSpace?n=!0:(am(0),n=!1),"none"!==ad.scrollY&&aV>aX+ad.scrollYSlackSpace?m=!0:(i(0),m=!1),c(),a9(),al(),h(),aR+aP+aQ>aW&&am(aP),aS+aL+aN>aV&&i(aL),C||aq.$broadcast("scrollable.dimensions",aY,aX,aW,aV,ad.id)},bc=function(D,C){return D.stopPropagation(),C&&D.preventDefault(),!1},a4=function(C){return C=C.originalEvent||C,C.targetTouches&&C.targetTouches.length>=1?C.targetTouches[0].pageY:C.pageY},aT=function(C){return C=C.originalEvent||C,C.targetTouches&&C.targetTouches.length>=1?C.targetTouches[0].pageX:C.pageX},ao=function(){var D,C,F,E;D=Date.now(),C=D-af,af=D,F=aR-ay,ay=aR,E=1000*F/(1+C),aA=0.8*E+0.2*aA,F=aS-au,au=aS,E=1000*F/(1+C),aw=0.8*E+0.2*aw},k=function(){var D,C;az&&(D=Date.now()-af,C=-az*Math.exp(-D/ad.kineticTau),C>0.5||-0.5>C?(am(ax+C),q(k)):am(ax))},f=function(){var D,C;av&&(D=Date.now()-af,C=-av*Math.exp(-D/ad.kineticTau),C>0.5||-0.5>C?(i(a6+C),q(f)):i(a6))},be=function(C){return aJ=aT(C),aK=aR,aG=!0,aA=az=0,ay=aR,A.on("mousemove",a7),A.on("mouseup",aZ),s&&!ae&&(ae=z(ao,50)),ab.el.addClass("active"),s||bc(C,!0)},a7=function(D){if(aG){var C=aT(D)-aJ,E=s?-C:parseInt(C*(aW-aY)/(aY-aQ),10);return q(v(null,am,aK+E)),bc(D,!0)}},aZ=function(C){return aG&&(A.off("mousemove",a7),A.off("mouseup",aZ),aG=!1,ab.el.removeClass("active"),aK=aJ=null),ae&&(z.cancel(ae),ae=null),(aA>10||-10>aA)&&(az=0.8*aA,ax=Math.round(aR+az),af=Date.now(),q(k)),s||bc(C,!0)},at=function(C){return aH=a4(C),aI=aS,aE=!0,aw=av=0,au=aS,A.on("mousemove",l),A.on("mouseup",g),s&&!ae&&(ae=z(ao,50)),ab.el.addClass("active"),s||bc(C,!0)},l=function(D){if(aE){var C=a4(D)-aH,E=s?-C:parseInt(C*(aV-aX)/(aX-aN),10);return q(v(null,i,aI+E)),s||bc(D,!0)}},g=function(C){return aE&&(A.off("mousemove",l),A.off("mouseup",g),aE=!1,ab.el.removeClass("active"),aI=aH=null),ae&&(z.cancel(ae),ae=null),(aw>10||-10>aw)&&(av=0.8*aw,a6=Math.round(aS+av),af=Date.now(),q(f)),s||bc(C,!0)},b=function(D){var C=parseInt(aQ/2,10),G=D.clientX-ab.barX[0].getBoundingClientRect().left-C,F=aY-aQ,E=a1(G/F,0,1);q(v(null,am,(aW-aY)*E))},a8=function(D){var C=parseInt(aN/2,10),G=D.clientY-ab.barY[0].getBoundingClientRect().top-C,F=aX-aN,E=a1(G/F,0,1);q(v(null,i,(aV-aX)*E))},a0=function(){aD=!0},bb=function(){aD=!1},a3=function(C){var F=0,E=0,D=30;if(!(!aD||A[0].activeElement.isContentEditable||"INPUT"===A[0].activeElement.nodeName||C.altKey||C.ctrlKey||C.metaKey)){switch(C.which){case 37:F=-D;break;case 38:E=D;break;case 39:F=D;break;case 40:E=-D;break;case 33:E=aX;break;case 32:case 34:E=-aX;break;case 35:m&&!n?E=-aV:F=aX;break;case 36:m&&!n?E=aV:F=-aX;break;default:return}q(v(null,i,aS-E)),q(v(null,am,aR+F)),ad.preventKeyEvents&&C.preventDefault()}},aO=function(D){var C=D.explicitOriginalTarget||D.target;if(!C){return !1}if(C.isContentEditable){return C.scrollHeight>C.clientHeight+C.clientTop+10}for(;C;){if(C.className&&"string"==typeof C.className&&C.className.indexOf("scrollable-ignore")>-1){return !0}C=C.parentNode}return !1},an=function(){var C=Date.now()-ag;500>C?ah=y(an,500-C):(ab.el.removeClass("active"),ah=null)},j=function(C){return 0>=aR+C||aR+C>=aW-aY},e=function(C){return 0>=aS+C||aS+C>=aV-aX},bd=function(D){if(D=D.originalEvent||D,!aO(D)){var C=D.deltaMode?aB:1,H=D.deltaX*C*ad.wheelSpeed,G=D.deltaY*C*ad.wheelSpeed,F=!0;if(D.shiftKey){var E=G;G=H,H=E}ag=Date.now(),ah||(ab.el.addClass("active"),ah=y(an,500)),ad.useBothWheelAxes?m&&!n?G?(q(v(null,i,aS+G)),F=!e(G)):(q(v(null,i,aS+H)),F=!e(H)):n&&!m&&(H?(q(v(null,am,aR+H)),F=!j(H)):(q(v(null,am,aR+G)),F=!j(G))):(q(v(null,i,aS+G)),q(v(null,am,aR+H)),m&&(F=!e(0))),F&&bc(D,!0)}},a5=function(D){var C=ab.el[0].scrollTop,E=ab.el[0].scrollLeft;C&&q(v(null,i,aS+C+2)),E&&q(v(null,am,aR+E+2)),ab.el[0].scrollTop=ab.el[0].scrollLeft=0,bc(D,!0)},aU=function(){if(ad.useObserver&&p){var C={childList:!0,subtree:!0};ai=new p(function(){q(d)}),ai.observe(ab.content[0],C)}ad.updateOnResize&&ab.window.on("resize",d),"none"!==ad.scrollX&&(ab.sliderX.on("click",bc),ab.barX.on("click",b),ab.sliderX.on("mousedown",be),s&&(ab.el.on("touchstart",be),ab.el.on("touchmove",a7),ab.el.on("touchend",aZ))),"none"!==ad.scrollY&&(ab.sliderY.on("click",bc),ab.barY.on("click",a8),ab.sliderY.on("mousedown",at),s&&(ab.el.on("touchstart",at),ab.el.on("touchmove",l),ab.el.on("touchend",g))),ab.el.on("wheel",bd),ab.el.on("scroll",a5),ad.useKeyboard&&(ab.el.on("mouseenter",a0),ab.el.on("mouseleave",bb),A.on("keydown",a3))},ap=function(){ai&&(ai.disconnect(),ai=null),ad.updateOnResize&&ab.window.off("resize",d),ab.sliderX.off("click",bc),ab.barX.off("click",b),ab.sliderY.off("click",bc),ab.barY.off("click",a8),s&&(ab.el.off("touchstart",be),ab.el.off("touchmove",a7),ab.el.off("touchend",aZ),ab.el.off("touchstart",at),ab.el.off("touchmove",l),ab.el.off("touchend",g)),ab.sliderX.off("mousedown",be),A.off("mousemove",a7),A.off("mouseup",aZ),ab.sliderY.off("mousedown",at),A.off("mousemove",l),A.off("mouseup",g),ad.useKeyboard&&(ab.el.off("mouseenter",a0),ab.el.off("mouseleave",bb),A.off("keydown",a3)),ab.el.off("wheel",bd),ab.el.off("scroll",a5)};aq.$on("content.reload",function(D,C){ap(),y(function(){ab.el=t(ak.children()[0]),ab.content=t(ab.el.children()[0]),aU(),d(D,C)})}),aq.$on("content.changed",function(D,C,E){C=C||100,y(function(){d(D,E)},C),D.preventDefault()}),aq.$on("scrollable.scroll.left",function(){aq.$applyAsync(function(){am(0)})}),aq.$on("scrollable.scroll.right",function(){aq.$applyAsync(function(){am(aW)})}),aq.$on("scrollable.scroll.top",function(){aq.$applyAsync(function(){i(0)})}),aq.$on("scrollable.scroll.bottom",function(){aq.$applyAsync(function(){i(aV)})}),aq.$on("$destroy",function(){y.cancel(ah),ap()}),aU(),d(),angular.forEach(["spyX","spyY"],function(a){aj[a]&&(aC[a]=w(aj[a]).assign,aq.$watch(aj[a],function(C){switch(C=C||0,a){case"spyX":am(C);break;case"spyY":i(C)}}))})}}}]);