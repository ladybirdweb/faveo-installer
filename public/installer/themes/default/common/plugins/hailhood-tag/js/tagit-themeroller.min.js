(function(a){a.fn.autoGrowInput=function(b){b=a.extend({maxWidth:1000,minWidth:0,comfortZone:70},b);this.filter("input:text").each(function(){var f=b.minWidth||a(this).width(),g="",d=a(this),e=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:d.css("fontSize"),fontFamily:d.css("fontFamily"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),whiteSpace:"nowrap"}),c=function(){if(g===(g=d.val())){return}var m=g.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e.html(m);var j=e.width(),l=(j+b.comfortZone)>=f?j+b.comfortZone:f,i=d.width(),h=(l<i&&l>=f)||(l>f&&l<b.maxWidth);if(h){var k=d.attr("style");d.css("cssText","width: "+l+"px !important;"+k)}};e.insertAfter(d);a(this).bind("keyup keydown blur update",c)});return this}}(jQuery));(function(a){a.widget("custom.catcomplete",a.ui.autocomplete,{_renderMenu:function(d,c){var e=this,b="";a.each(c,function(f,g){if(g.category&&g.category!==b){d.append("<li class='ui-autocomplete-category'>"+g.category+"</li>");b=g.category}e._renderItem(d,g).data("ui-autocomplete-item",g)})}});a.widget("ui.tagit",{options:{tagSource:[],triggerKeys:["enter","space","comma","tab","semicolon"],seperatorKeys:["comma","semicolon"],initialTags:[],defaultType:"none",minLength:1,autocompleteMinLength:1,select:false,allowNewTags:true,caseSensitive:false,sortable:false,editable:false,highlightOnExistColor:"#0F0",placeholder:"Enter tags...",inputWidth:150,emptySearch:true,tagsChanged:function(){},maxTags:undefined,blurOnPaste:true,allowDuplicates:false},_splitAt:/\ |,/g,_existingAtIndex:0,_keys:{backspace:[8],enter:[13],space:[32],comma:[44,188],tab:[9],semicolon:[59,186]},_sortable:{sorting:-1},_idEditing:false,_create:function(){var d=this;this.tagsArray=[];this.timer=null;this.element.addClass("tagit ui-widget ui-widget-content");this.element.children("li").each(function(){var i=a(this);var j=i.attr("tagValue")||a(this).data("value");d.options.initialTags.push({label:i.text(),value:(j||i.text())})});var c=[];var f=function(i,j){if(a.inArray(i,d.options.seperatorKeys)!==-1){c.push(j)}};d._splitAt=null;f("space",/\ /);f("semicolon",/;/);f("comma",/,/);var b=a.map(c,function(i){return i.source}).join("|");d._splitAt=new RegExp(b,"g");this.element.html('<li class="tagit-new" style="width:'+d.options.inputWidth+'px"><input class="tagit-input" type="text" placeholder="'+d.options.placeholder+'" /></li>');this.input=this.element.find(".tagit-input");this.input.autoGrowInput();a(this.element).click(function(k){if(a(k.target).hasClass("tagit-close")){var j=a(k.target).parent();var i=d.tagsArray[j.index()];i.element.remove();d._popTag(i)}else{if(!d._isEditing){d.input.focus()}if(d.options.emptySearch&&a(k.target).hasClass("tagit-input")&&d.input.val()===""&&d.input.catcomplete!=undefined){d.input.catcomplete("search")}if(d.options.editable&&a(k.target).hasClass("tagit-label")){d._edit(k.target)}}});var g=this.options.select;var h=this.options.minLength;this.options.appendTo=this.element;this.options.source=this.options.tagSource;this.options.select=function(i,j){d.input.data("autoCompleteTag",true);clearTimeout(d.timer);if(d.options.maxTags!==undefined&&d.tagsArray.length===d.options.maxTags){d.input.val("")}else{if(j.item.label===undefined){d._addTag({label:j.item.value})}else{d._addTag({label:j.item.label,value:j.item.value,type:j.item.category})}}return false};this.options.focus=function(i,j){if(j.item.label!==undefined&&/^key/.test(i.originalEvent.type)){d.input.val(j.item.label);d.input.data("value",j.item.value);return false}};this.options.autoFocus=!this.options.allowNewTags;this.options.minLength=this.options.autocompleteMinLength;this.input.catcomplete(this.options);this.options.minLength=h;this.options.select=g;d.isKeyEventProcessed=false;this.input.keyup(function(){d.isKeyEventProcessed=false});this.input.keydown(function(i){d._processKeyEvent(i)});this.input.keypress(function(i){d._processKeyEvent(i)});this.input.bind("paste",function(){if(d.options.blurOnPaste){var i=a(this);d.timer=setTimeout(function(){i.blur()},0)}});this.input.blur(function(){d.currentLabel=a(this).val();d.currentValue=a(this).data("value");if(d.options.allowNewTags){d.timer=setTimeout(function(){d._addTag({label:d.currentLabel,value:d.currentValue,type:d.options.defaultType});d.currentValue="";d.currentLabel=""},400)}a(this).val("").removeData("value");return false});if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(this.options.select){this.select=a('<select class="tagit-hiddenSelect" name="'+(this.element.attr("name")||this.element.data("name"))+'" multiple="multiple"></select>');this.element.after(this.select)}this._initialTags();if(d.options.sortable!==false){var e={items:".tagit-choice",containment:"parent",opacity:0.6,tolerance:"pointer",start:function(i,j){d._sortable.tag=a(j.item);d._sortable.origIndex=d._sortable.tag.index()},update:function(j){d._sortable.newIndex=d._sortable.tag.index();d._moveTag(d._sortable.origIndex,d._sortable.newIndex);if(d.options.tagsChanged){var i=d.tagsArray[d._sortable.newIndex];d.options.tagsChanged(i.value,"moved",i.element)}}};if(d.options.sortable==="handle"){e.handle="a.ui-icon";e.cursor="move"}d.element.sortable(e)}},_processKeyEvent:function(b){if(this.isKeyEventProcessed){return}var c=b.which||b.keyCode||b.charCode;var d=this.element.children(".tagit-choice:last");this.isKeyEventProcessed=true;if(c===this._keys.backspace[0]){return this._backspace(d)}if(this._isInitKey(c)&&!(this._isTabKey(c)&&this.value===""&&!this.input.data("autoCompleteTag"))){b.preventDefault();this.input.data("autoCompleteTag",false);if(!this.options.allowNewTags||(this.options.maxTags!==undefined&&this.tagsArray.length===this.options.maxTags)){this.input.val("")}else{if(this.options.allowNewTags&&this.input.val().length>=this.options.minLength){this._addTag({label:this.input.val(),type:this.options.defaultType})}}}if(this.options.maxLength!==undefined&&this.input.val().length>this.options.maxLength){b.preventDefault();this.input.val(this.input.val().substring(0,this.options.maxLength))}if(d.hasClass("selected")){d.removeClass("selected")}this.lastKey=c},_postEdit:function(c,d,b){var e=a.proxy(function(){d.remove();a(c).removeClass("hidden");a(c).parent().removeClass("edited");this._isEditing=false},this);return function(){var g=a(c).parent().index();var k=this.tagsArray[g];var j=d.val();if(this._splitAt&&j.search(this._splitAt)>0){j=j.split(this._splitAt)[0]}if(j===b){e()}else{if(this._addTag({label:j})){k.element.remove();this._popTag(k);var i=this.tagsArray.length-1;if(i!==g){var h=this.tagsArray[i];h.element.insertBefore(this.tagsArray[g].element);this._moveTag(this.tagsArray.length-1,g);if(this.options.tagsChanged){var f=this.tagsArray[g];this.options.tagsChanged(f.value,"moved",f.element)}}e()}}}},_edit:function(c){this._isEditing=true;var b=a(c).text();var d=a("<input>");d.val(b);a(c).parent().addClass("edited");d.addClass("tagit-edit");d.css("width",a(c).outerWidth());a(c).addClass("hidden");d.blur(a.proxy(this._postEdit(c,d,b),this));d.keypress(a.proxy(function(f){var g=f.which||f.keyCode||f.charCode;if(this._isInitKey(g)){d.blur()}},this));a(c).before(d);d[0].select()},_popSelect:function(b){a("option:eq("+b.index+")",this.select).remove();this.select.change()},_addSelect:function(b){this.select.append('<option selected="selected" value="'+b.value+'">'+b.label+"</option>");this.select.change()},_popTag:function(b){if(b===undefined){b=this.tagsArray.pop()}else{this.tagsArray.splice(b.index,1)}var c;for(c=0;c<this.tagsArray.length;c++){this.tagsArray[c].index=c}if(this.options.select){this._popSelect(b)}if(this.options.tagsChanged){this.options.tagsChanged(b?(b.value||b.label):null,"popped",b)}return},_addTag:function(f){if(f.label===undefined){f.label=f.value}if(f.label===parseInt(f.label,10)){f.label=f.label.toString()}this.input.catcomplete("close").val("");if(this._splitAt&&f.label.search(this._splitAt)>0){var c=f.label.split(this._splitAt);var e;for(e=0;e<c.length;e++){this._addTag({label:c[e],value:f.value})}return}f.label=f.label.replace(/,+$/,"").trim();if(f.label===""){return false}f.label=f.label.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var d=this._exists(f.label,f.value);if(d!==false&&!this.options.allowDuplicates){this._highlightExisting(d);return false}var b=this.tag(f.label,f.value,f.type);b.element=a('<li class="tagit-choice ui-widget-content ui-state-default"'+(f.type!==undefined?" tagit-type-"+f.type+'"':'"')+(f.value!==undefined?' tagValue="'+f.value+'"':"")+">"+(this.options.sortable==="handle"?'<a class="ui-icon ui-icon-grip-dotted-vertical" style="float:left"></a>':"")+'<div class="tagit-label">'+f.label+'</div><a class="tagit-close ui-state-error-text">x</a></li>');b.element.insertBefore(this.input.parent());this.tagsArray.push(b);this.input.val("");if(this.options.select){this._addSelect(b)}if(this.options.tagsChanged){this.options.tagsChanged(b.label,"added",b.element)}return true},_exists:function(b,d){if(this.tagsArray.length===0){return false}b=this._lowerIfCaseInsensitive(b);d=this._lowerIfCaseInsensitive(d);var c;for(c=0;c<this.tagsArray.length;c++){if(this._lowerIfCaseInsensitive(this.tagsArray[c].label)===b){if(d!==undefined){if(this._lowerIfCaseInsensitive(this.tagsArray[c].value)===d){return c}}else{return c}}}return false},_highlightExisting:function(c){if(this.options.highlightOnExistColor===undefined){return}var b=this.tagsArray[c];b.element.stop();var d=b.element.css("color");b.element.animate({color:this.options.highlightOnExistColor},100).animate({color:d},800,null,function(){b.element.attr("style","")})},_isInitKey:function(d){var c="";var b;for(b in this._keys){if(this._keys.hasOwnProperty(b)){if(a.inArray(d,this._keys[b])!==-1){c=b}}}if(a.inArray(c,this.options.triggerKeys)!==-1){return true}return false},_isTabKey:function(b){var c=this._keys.tab;return a.inArray(b,c)>-1},_removeTag:function(){this._popTag();this.element.children(".tagit-choice:last").remove()},_backspace:function(b){if(this.input.val()===""){if(this.lastKey===this._keys.backspace[0]){this._popTag();b.remove();this.lastKey=null}else{b.removeClass("ui-state-default").addClass("selected ui-state-error");this.lastKey=this._keys.backspace[0]}}return true},_initialTags:function(){var c=this;var b;if(this.options.tagsChanged){b=this.options.tagsChanged}this.options.tagsChanged=null;if(this.options.initialTags.length!==0){a(this.options.initialTags).each(function(e,d){if(typeof d==="object"){c._addTag({label:d.label,value:d.value,type:d.type})}else{c._addTag({label:d})}})}this.options.tagsChanged=b;this.options.tagsChanged(null,"tagsInited",null)},_lowerIfCaseInsensitive:function(b){if(b===undefined||typeof b!==typeof"a"){return b}if(this.options.caseSensitive){return b}return b.toLowerCase()},_moveTag:function(d,b){this.tagsArray.splice(b,0,this.tagsArray.splice(d,1)[0]);var c;for(c=0;c<this.tagsArray.length;c++){this.tagsArray[c].index=c}if(this.options.select){if(d<b){a("option:eq("+d+")",this.select).insertAfter(a("option:eq("+b+")",this.select))}else{a("option:eq("+d+")",this.select).insertBefore(a("option:eq("+b+")",this.select))}}},tags:function(){return this.tagsArray},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);clearTimeout(this.timer);this.tagsArray=[]},reset:function(){this.element.find(".tagit-choice").remove();this.tagsArray=[];if(this.options.select){this.select.children().remove();this.select.change()}this._initialTags();if(this.options.tagsChanged){this.options.tagsChanged(null,"reset",null)}},fill:function(b){if(b!==undefined){this.options.initialTags=b}this.reset()},add:function(b,c){if(typeof b==="object"){return this._addTag({label:b.label,value:b.value})}return this._addTag({label:b,value:c})},autocomplete:function(){return this.input.data("autocomplete")},tag:function(c,f,e,d){var b=this;return{label:c,value:(f===undefined?c:f),type:e,element:d,index:b.tagsArray.length}},remove:function(c,e){if(this.tagsArray.length===0){return false}c=this._lowerIfCaseInsensitive(c);e=this._lowerIfCaseInsensitive(e);var d;for(d=0;d<this.tagsArray.length;d++){if(this._lowerIfCaseInsensitive(this.tagsArray[d].value)===e||this._lowerIfCaseInsensitive(this.tagsArray[d].label)===c){break}}if(d>=0&&d<this.tagsArray.length){var b=this.tagsArray[d];b.element.remove();this._popTag(b);return true}return false}})}(jQuery));